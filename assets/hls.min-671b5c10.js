import{g as Fn,c as Mn}from"./commonjsHelpers-725317a4.js";function Nn(Mt,Er){for(var Nt=0;Nt<Er.length;Nt++){const _t=Er[Nt];if(typeof _t!="string"&&!Array.isArray(_t)){for(const mt in _t)if(mt!=="default"&&!(mt in Mt)){const $t=Object.getOwnPropertyDescriptor(_t,mt);$t&&Object.defineProperty(Mt,mt,$t.get?$t:{enumerable:!0,get:()=>_t[mt]})}}}return Object.freeze(Object.defineProperty(Mt,Symbol.toStringTag,{value:"Module"}))}var yr={},Un={get exports(){return yr},set exports(Mt){yr=Mt}};(function(Mt,Er){typeof window<"u"&&function(Nt,_t){Mt.exports=_t()}(Mn,()=>(()=>{var Nt={21:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{default:()=>Q});var he=function(){function B(U,ee){this.subtle=void 0,this.aesIV=void 0,this.subtle=U,this.aesIV=ee}return B.prototype.decrypt=function(U,ee){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},ee,U)},B}(),$=function(){function B(U,ee){this.subtle=void 0,this.key=void 0,this.subtle=U,this.key=ee}return B.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},B}(),F=H(145),f=function(){function B(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var U=B.prototype;return U.uint8ArrayToUint32Array_=function(ee){for(var oe=new DataView(ee),le=new Uint32Array(4),ie=0;ie<4;ie++)le[ie]=oe.getUint32(4*ie);return le},U.initTable=function(){var ee=this.sBox,oe=this.invSBox,le=this.subMix,ie=le[0],te=le[1],Z=le[2],ve=le[3],ce=this.invSubMix,me=ce[0],P=ce[1],p=ce[2],A=ce[3],S=new Uint32Array(256),G=0,ne=0,se=0;for(se=0;se<256;se++)S[se]=se<128?se<<1:se<<1^283;for(se=0;se<256;se++){var k=ne^ne<<1^ne<<2^ne<<3^ne<<4;k=k>>>8^255&k^99,ee[G]=k,oe[k]=G;var N=S[G],M=S[N],V=S[M],_=257*S[k]^16843008*k;ie[G]=_<<24|_>>>8,te[G]=_<<16|_>>>16,Z[G]=_<<8|_>>>24,ve[G]=_,_=16843009*V^65537*M^257*N^16843008*G,me[k]=_<<24|_>>>8,P[k]=_<<16|_>>>16,p[k]=_<<8|_>>>24,A[k]=_,G?(G=N^S[S[S[V^N]]],ne^=S[S[ne]]):G=ne=1}},U.expandKey=function(ee){for(var oe=this.uint8ArrayToUint32Array_(ee),le=!0,ie=0;ie<oe.length&&le;)le=oe[ie]===this.key[ie],ie++;if(!le){this.key=oe;var te=this.keySize=oe.length;if(te!==4&&te!==6&&te!==8)throw new Error("Invalid aes key size="+te);var Z,ve,ce,me,P=this.ksRows=4*(te+6+1),p=this.keySchedule=new Uint32Array(P),A=this.invKeySchedule=new Uint32Array(P),S=this.sBox,G=this.rcon,ne=this.invSubMix,se=ne[0],k=ne[1],N=ne[2],M=ne[3];for(Z=0;Z<P;Z++)Z<te?ce=p[Z]=oe[Z]:(me=ce,Z%te==0?(me=S[(me=me<<8|me>>>24)>>>24]<<24|S[me>>>16&255]<<16|S[me>>>8&255]<<8|S[255&me],me^=G[Z/te|0]<<24):te>6&&Z%te==4&&(me=S[me>>>24]<<24|S[me>>>16&255]<<16|S[me>>>8&255]<<8|S[255&me]),p[Z]=ce=(p[Z-te]^me)>>>0);for(ve=0;ve<P;ve++)Z=P-ve,me=3&ve?p[Z]:p[Z-4],A[ve]=ve<4||Z<=4?me:se[S[me>>>24]]^k[S[me>>>16&255]]^N[S[me>>>8&255]]^M[S[255&me]],A[ve]=A[ve]>>>0}},U.networkToHostOrderSwap=function(ee){return ee<<24|(65280&ee)<<8|(16711680&ee)>>8|ee>>>24},U.decrypt=function(ee,oe,le){for(var ie,te,Z,ve,ce,me,P,p,A,S,G,ne,se,k,N=this.keySize+6,M=this.invKeySchedule,V=this.invSBox,_=this.invSubMix,ge=_[0],pe=_[1],Te=_[2],ke=_[3],J=this.uint8ArrayToUint32Array_(le),De=J[0],Re=J[1],Ke=J[2],Ie=J[3],we=new Int32Array(ee),Me=new Int32Array(we.length),Pe=this.networkToHostOrderSwap;oe<we.length;){for(A=Pe(we[oe]),S=Pe(we[oe+1]),G=Pe(we[oe+2]),ne=Pe(we[oe+3]),ce=A^M[0],me=ne^M[1],P=G^M[2],p=S^M[3],se=4,k=1;k<N;k++)ie=ge[ce>>>24]^pe[me>>16&255]^Te[P>>8&255]^ke[255&p]^M[se],te=ge[me>>>24]^pe[P>>16&255]^Te[p>>8&255]^ke[255&ce]^M[se+1],Z=ge[P>>>24]^pe[p>>16&255]^Te[ce>>8&255]^ke[255&me]^M[se+2],ve=ge[p>>>24]^pe[ce>>16&255]^Te[me>>8&255]^ke[255&P]^M[se+3],ce=ie,me=te,P=Z,p=ve,se+=4;ie=V[ce>>>24]<<24^V[me>>16&255]<<16^V[P>>8&255]<<8^V[255&p]^M[se],te=V[me>>>24]<<24^V[P>>16&255]<<16^V[p>>8&255]<<8^V[255&ce]^M[se+1],Z=V[P>>>24]<<24^V[p>>16&255]<<16^V[ce>>8&255]<<8^V[255&me]^M[se+2],ve=V[p>>>24]<<24^V[ce>>16&255]<<16^V[me>>8&255]<<8^V[255&P]^M[se+3],Me[oe]=Pe(ie^De),Me[oe+1]=Pe(ve^Re),Me[oe+2]=Pe(Z^Ke),Me[oe+3]=Pe(te^Ie),De=A,Re=S,Ke=G,Ie=ne,oe+=4}return Me.buffer},B}(),C=H(93),b=H(63),Q=function(){function B(ee,oe,le){var ie=(le===void 0?{}:le).removePKCS7Padding,te=ie===void 0||ie;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=ee,this.config=oe,this.removePKCS7Padding=te,te)try{var Z=self.crypto;Z&&(this.subtle=Z.subtle||Z.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var U=B.prototype;return U.destroy=function(){this.observer=null},U.isSync=function(){return this.config.enableSoftwareAES},U.flush=function(){var ee=this.currentResult;if(ee){var oe,le,ie,te=new Uint8Array(ee);return this.reset(),this.removePKCS7Padding?(ie=(le=(oe=te).byteLength)&&new DataView(oe.buffer).getUint8(le-1))?(0,F.sliceUint8)(oe,0,le-ie):oe:te}this.reset()},U.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},U.decrypt=function(ee,oe,le,ie){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(ee),oe,le);var te=this.flush();te&&ie(te.buffer)}else this.webCryptoDecrypt(new Uint8Array(ee),oe,le).then(ie)},U.softwareDecrypt=function(ee,oe,le){var ie=this.currentIV,te=this.currentResult,Z=this.remainderData;this.logOnce("JS AES decrypt"),Z&&(ee=(0,b.appendUint8Array)(Z,ee),this.remainderData=null);var ve=this.getValidChunk(ee);if(!ve.length)return null;ie&&(le=ie);var ce=this.softwareDecrypter;ce||(ce=this.softwareDecrypter=new f),ce.expandKey(oe);var me=te;return this.currentResult=ce.decrypt(ve.buffer,0,le),this.currentIV=(0,F.sliceUint8)(ve,-16).buffer,me||null},U.webCryptoDecrypt=function(ee,oe,le){var ie=this,te=this.subtle;return this.key===oe&&this.fastAesKey||(this.key=oe,this.fastAesKey=new $(te,oe)),this.fastAesKey.expandKey().then(function(Z){return te?new he(te,le).decrypt(ee.buffer,Z):Promise.reject(new Error("web crypto not initialized"))}).catch(function(Z){return ie.onWebCryptoError(Z,ee,oe,le)})},U.onWebCryptoError=function(ee,oe,le,ie){return C.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",ee),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(oe,le,ie)},U.getValidChunk=function(ee){var oe=ee,le=ee.length-ee.length%16;return le!==ee.length&&(oe=(0,F.sliceUint8)(ee,0,le),this.remainderData=(0,F.sliceUint8)(ee,le)),oe},U.logOnce=function(ee){this.logEnabled&&(C.logger.log("[decrypter.ts]: "+ee),this.logEnabled=!1)},B}()},181:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{canParse:()=>b,decodeFrame:()=>oe,getID3Data:()=>f,getID3Frames:()=>ee,getTimeStamp:()=>Q,isFooter:()=>F,isHeader:()=>$,isTimeStampFrame:()=>B,testables:()=>ce,utf8ArrayToStr:()=>ve});var he,$=function(P,p){return p+10<=P.length&&P[p]===73&&P[p+1]===68&&P[p+2]===51&&P[p+3]<255&&P[p+4]<255&&P[p+6]<128&&P[p+7]<128&&P[p+8]<128&&P[p+9]<128},F=function(P,p){return p+10<=P.length&&P[p]===51&&P[p+1]===68&&P[p+2]===73&&P[p+3]<255&&P[p+4]<255&&P[p+6]<128&&P[p+7]<128&&P[p+8]<128&&P[p+9]<128},f=function(P,p){for(var A=p,S=0;$(P,p);)S+=10,S+=C(P,p+6),F(P,p+10)&&(S+=10),p+=S;if(S>0)return P.subarray(A,A+S)},C=function(P,p){var A=0;return A=(127&P[p])<<21,A|=(127&P[p+1])<<14,(A|=(127&P[p+2])<<7)|127&P[p+3]},b=function(P,p){return $(P,p)&&C(P,p+6)+10<=P.length-p},Q=function(P){for(var p=ee(P),A=0;A<p.length;A++){var S=p[A];if(B(S))return Z(S)}},B=function(P){return P&&P.key==="PRIV"&&P.info==="com.apple.streaming.transportStreamTimestamp"},U=function(P){var p=String.fromCharCode(P[0],P[1],P[2],P[3]),A=C(P,4);return{type:p,size:A,data:P.subarray(10,10+A)}},ee=function(P){for(var p=0,A=[];$(P,p);){for(var S=C(P,p+6),G=(p+=10)+S;p+8<G;){var ne=U(P.subarray(p)),se=oe(ne);se&&A.push(se),p+=ne.size+10}F(P,p)&&(p+=10)}return A},oe=function(P){return P.type==="PRIV"?le(P):P.type[0]==="W"?te(P):ie(P)},le=function(P){if(!(P.size<2)){var p=ve(P.data,!0),A=new Uint8Array(P.data.subarray(p.length+1));return{key:P.type,info:p,data:A.buffer}}},ie=function(P){if(!(P.size<2)){if(P.type==="TXXX"){var p=1,A=ve(P.data.subarray(p),!0);p+=A.length+1;var S=ve(P.data.subarray(p));return{key:P.type,info:A,data:S}}var G=ve(P.data.subarray(1));return{key:P.type,data:G}}},te=function(P){if(P.type==="WXXX"){if(P.size<2)return;var p=1,A=ve(P.data.subarray(p),!0);p+=A.length+1;var S=ve(P.data.subarray(p));return{key:P.type,info:A,data:S}}var G=ve(P.data);return{key:P.type,data:G}},Z=function(P){if(P.data.byteLength===8){var p=new Uint8Array(P.data),A=1&p[3],S=(p[4]<<23)+(p[5]<<15)+(p[6]<<7)+p[7];return S/=45,A&&(S+=4772185884e-2),Math.round(S)}},ve=function(P,p){p===void 0&&(p=!1);var A=me();if(A){var S=A.decode(P);if(p){var G=S.indexOf("\0");return G!==-1?S.substring(0,G):S}return S.replace(/\0/g,"")}for(var ne,se,k,N=P.length,M="",V=0;V<N;){if((ne=P[V++])===0&&p)return M;if(ne!==0&&ne!==3)switch(ne>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:M+=String.fromCharCode(ne);break;case 12:case 13:se=P[V++],M+=String.fromCharCode((31&ne)<<6|63&se);break;case 14:se=P[V++],k=P[V++],M+=String.fromCharCode((15&ne)<<12|(63&se)<<6|(63&k)<<0)}}return M},ce={decodeTextFrame:ie};function me(){return he||self.TextDecoder===void 0||(he=new self.TextDecoder("utf-8")),he}},182:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{default:()=>C});var he=H(544),$=H(851),F=H(93),f=H(729);function C(U){var ee=new f.EventEmitter,oe=function(le,ie){U.postMessage({event:le,data:ie})};ee.on($.Events.FRAG_DECRYPTED,oe),ee.on($.Events.ERROR,oe),U.addEventListener("message",function(le){var ie=le.data;switch(ie.cmd){case"init":var te=JSON.parse(ie.config);U.transmuxer=new he.default(ee,ie.typeSupported,te,ie.vendor,ie.id),(0,F.enableLogs)(te.debug,ie.id),function(){var me=function(p){F.logger[p]=function(A){oe("workerLog",{logType:p,message:A})}};for(var P in F.logger)me(P)}(),oe("init",null);break;case"configure":U.transmuxer.configure(ie.config);break;case"demux":var Z=U.transmuxer.push(ie.data,ie.decryptdata,ie.chunkMeta,ie.state);(0,he.isPromise)(Z)?Z.then(function(me){b(U,me)}):b(U,Z);break;case"flush":var ve=ie.chunkMeta,ce=U.transmuxer.flush(ve);(0,he.isPromise)(ce)?ce.then(function(me){B(U,me,ve)}):B(U,ce,ve)}})}function b(U,ee){if(!((oe=ee.remuxResult).audio||oe.video||oe.text||oe.id3||oe.initSegment))return!1;var oe,le=[],ie=ee.remuxResult,te=ie.audio,Z=ie.video;return te&&Q(le,te),Z&&Q(le,Z),U.postMessage({event:"transmuxComplete",data:ee},le),!0}function Q(U,ee){ee.data1&&U.push(ee.data1.buffer),ee.data2&&U.push(ee.data2.buffer)}function B(U,ee,oe){ee.reduce(function(le,ie){return b(U,ie)||le},!1)||U.postMessage({event:"transmuxComplete",data:ee[0]}),U.postMessage({event:"flush",data:oe})}},544:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{TransmuxConfig:()=>St,TransmuxState:()=>bt,default:()=>Et,isPromise:()=>Tt});var he=H(851),$=H(973),F=H(21),f=H(965),C=H(181),b=H(856);function Q(w,L){return w===void 0&&(w=""),L===void 0&&(L=9e4),{type:w,id:-1,pid:-1,inputTimeScale:L,sequenceNumber:-1,samples:[],dropped:0}}var B=H(63),U=H(145),ee=function(){function w(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var L=w.prototype;return L.resetInitSegment=function(g,T,E,R){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},L.resetTimeStamp=function(g){this.initPTS=g,this.resetContiguity()},L.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},L.canParse=function(g,T){return!1},L.appendFrame=function(g,T,E){},L.demux=function(g,T){this.cachedData&&(g=(0,B.appendUint8Array)(this.cachedData,g),this.cachedData=null);var E,R=C.getID3Data(g,0),O=R?R.length:0,x=this._audioTrack,Y=this._id3Track,ae=R?C.getTimeStamp(R):void 0,z=g.length;for((this.basePTS===null||this.frameIndex===0&&(0,f.isFiniteNumber)(ae))&&(this.basePTS=oe(ae,T,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),R&&R.length>0&&Y.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:R,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});O<z;){if(this.canParse(g,O)){var de=this.appendFrame(x,g,O);de?(this.frameIndex++,this.lastPTS=de.sample.pts,E=O+=de.length):O=z}else C.canParse(g,O)?(R=C.getID3Data(g,O),Y.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:R,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),E=O+=R.length):O++;if(O===z&&E!==z){var Se=(0,U.sliceUint8)(g,E);this.cachedData?this.cachedData=(0,B.appendUint8Array)(this.cachedData,Se):this.cachedData=Se}}return{audioTrack:x,videoTrack:Q(),id3Track:Y,textTrack:Q()}},L.demuxSampleAes=function(g,T,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},L.flush=function(g){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),{audioTrack:this._audioTrack,videoTrack:Q(),id3Track:this._id3Track,textTrack:Q()}},L.destroy=function(){},w}(),oe=function(w,L,g){return(0,f.isFiniteNumber)(w)?90*w:9e4*L+(g||0)};const le=ee;var ie=H(93);function te(w,L){return w[L]===255&&(246&w[L+1])==240}function Z(w,L){return 1&w[L+1]?7:9}function ve(w,L){return(3&w[L+3])<<11|w[L+4]<<3|(224&w[L+5])>>>5}function ce(w,L){return L+1<w.length&&te(w,L)}function me(w,L){if(ce(w,L)){var g=Z(w,L);if(L+g>=w.length)return!1;var T=ve(w,L);if(T<=g)return!1;var E=L+T;return E===w.length||ce(w,E)}return!1}function P(w,L,g,T,E){if(!w.samplerate){var R=function(O,x,Y,ae){var z,de,Se,ye,be=navigator.userAgent.toLowerCase(),Oe=ae,He=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];z=1+((192&x[Y+2])>>>6);var Le=(60&x[Y+2])>>>2;if(!(Le>He.length-1))return Se=(1&x[Y+2])<<2,Se|=(192&x[Y+3])>>>6,ie.logger.log("manifest codec:"+ae+", ADTS type:"+z+", samplingIndex:"+Le),/firefox/i.test(be)?Le>=6?(z=5,ye=new Array(4),de=Le-3):(z=2,ye=new Array(2),de=Le):be.indexOf("android")!==-1?(z=2,ye=new Array(2),de=Le):(z=5,ye=new Array(4),ae&&(ae.indexOf("mp4a.40.29")!==-1||ae.indexOf("mp4a.40.5")!==-1)||!ae&&Le>=6?de=Le-3:((ae&&ae.indexOf("mp4a.40.2")!==-1&&(Le>=6&&Se===1||/vivaldi/i.test(be))||!ae&&Se===1)&&(z=2,ye=new Array(2)),de=Le)),ye[0]=z<<3,ye[0]|=(14&Le)>>1,ye[1]|=(1&Le)<<7,ye[1]|=Se<<3,z===5&&(ye[1]|=(14&de)>>1,ye[2]=(1&de)<<7,ye[2]|=8,ye[3]=0),{config:ye,samplerate:He[Le],channelCount:Se,codec:"mp4a.40."+z,manifestCodec:Oe};O.trigger(he.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+Le})}(L,g,T,E);if(!R)return;w.config=R.config,w.samplerate=R.samplerate,w.channelCount=R.channelCount,w.codec=R.codec,w.manifestCodec=R.manifestCodec,ie.logger.log("parsed codec:"+w.codec+", rate:"+R.samplerate+", channels:"+R.channelCount)}}function p(w){return 9216e4/w}function A(w,L,g,T,E){var R,O=T+E*p(w.samplerate),x=function(be,Oe){var He=Z(be,Oe);if(Oe+He<=be.length){var Le=ve(be,Oe)-He;if(Le>0)return{headerLength:He,frameLength:Le}}}(L,g);if(x){var Y=x.frameLength,ae=x.headerLength,z=ae+Y,de=Math.max(0,g+z-L.length);de?(R=new Uint8Array(z-ae)).set(L.subarray(g+ae,L.length),0):R=L.subarray(g+ae,g+z);var Se={unit:R,pts:O};return de||w.samples.push(Se),{sample:Se,length:z,missing:de}}var ye=L.length-g;return(R=new Uint8Array(ye)).set(L.subarray(g,L.length),0),{sample:{unit:R,pts:O},length:ye,missing:-1}}function S(w,L){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,T){return g.__proto__=T,g},S(w,L)}const G=function(w){var L,g;function T(R,O){var x;return(x=w.call(this)||this).observer=void 0,x.config=void 0,x.observer=R,x.config=O,x}g=w,(L=T).prototype=Object.create(g.prototype),L.prototype.constructor=L,S(L,g);var E=T.prototype;return E.resetInitSegment=function(R,O,x,Y){w.prototype.resetInitSegment.call(this,R,O,x,Y),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:O,duration:Y,inputTimeScale:9e4,dropped:0}},T.probe=function(R){if(!R)return!1;for(var O=(C.getID3Data(R,0)||[]).length,x=R.length;O<x;O++)if(me(R,O))return ie.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(R,O){return function(x,Y){return function(ae,z){return z+5<ae.length}(x,Y)&&te(x,Y)&&ve(x,Y)<=x.length-Y}(R,O)},E.appendFrame=function(R,O,x){P(R,this.observer,O,x,R.manifestCodec);var Y=A(R,O,x,this.basePTS,this.frameIndex);if(Y&&Y.missing===0)return Y},T}(le);var ne=/\/emsg[-/]ID3/i;const se=function(){function w(g,T){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=T}var L=w.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(g,T,E,R){var O=(0,B.parseInitSegment)(g),x=this.videoTrack=Q("video",1),Y=this.audioTrack=Q("audio",1),ae=this.txtTrack=Q("text",1);if(this.id3Track=Q("id3",1),this.timeOffset=0,O.video){var z=O.video,de=z.id,Se=z.timescale,ye=z.codec;x.id=de,x.timescale=ae.timescale=Se,x.codec=ye}if(O.audio){var be=O.audio,Oe=be.id,He=be.timescale,Le=be.codec;Y.id=Oe,Y.timescale=He,Y.codec=Le}ae.id=B.RemuxerTrackIdConfig.text,x.sampleDuration=0,x.duration=Y.duration=R},L.resetContiguity=function(){},w.probe=function(g){return g=g.length>16384?g.subarray(0,16384):g,(0,B.findBox)(g,["moof"]).length>0},L.demux=function(g,T){this.timeOffset=T;var E=g,R=this.videoTrack,O=this.txtTrack;if(this.config.progressive){this.remainderData&&(E=(0,B.appendUint8Array)(this.remainderData,g));var x=(0,B.segmentValidRange)(E);this.remainderData=x.remainder,R.samples=x.valid||new Uint8Array}else R.samples=E;var Y=this.extractID3Track(R,T);return O.samples=(0,B.parseSamples)(T,R),{videoTrack:R,audioTrack:this.audioTrack,id3Track:Y,textTrack:this.txtTrack}},L.flush=function(){var g=this.timeOffset,T=this.videoTrack,E=this.txtTrack;T.samples=this.remainderData||new Uint8Array,this.remainderData=null;var R=this.extractID3Track(T,this.timeOffset);return E.samples=(0,B.parseSamples)(g,T),{videoTrack:T,audioTrack:Q(),id3Track:R,textTrack:Q()}},L.extractID3Track=function(g,T){var E=this.id3Track;if(g.samples.length){var R=(0,B.findBox)(g.samples,["emsg"]);R&&R.forEach(function(O){var x=(0,B.parseEmsg)(O);if(ne.test(x.schemeIdUri)){var Y=(0,f.isFiniteNumber)(x.presentationTime)?x.presentationTime/x.timeScale:T+x.presentationTimeDelta/x.timeScale,ae=x.eventDuration===4294967295?Number.POSITIVE_INFINITY:x.eventDuration/x.timeScale;ae<=.001&&(ae=Number.POSITIVE_INFINITY);var z=x.payload;E.samples.push({data:z,len:z.byteLength,dts:Y,pts:Y,type:b.MetadataSchema.emsg,duration:ae})}})}return E},L.demuxSampleAes=function(g,T,E){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},w}();var k=null,N=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],M=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],V=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function ge(w,L,g,T,E){if(!(g+24>L.length)){var R=pe(L,g);if(R&&g+R.frameLength<=L.length){var O=T+E*(9e4*R.samplesPerFrame/R.sampleRate),x={unit:L.subarray(g,g+R.frameLength),pts:O,dts:O};return w.config=[],w.channelCount=R.channelCount,w.samplerate=R.sampleRate,w.samples.push(x),{sample:x,length:R.frameLength,missing:0}}}}function pe(w,L){var g=w[L+1]>>3&3,T=w[L+1]>>1&3,E=w[L+2]>>4&15,R=w[L+2]>>2&3;if(g!==1&&E!==0&&E!==15&&R!==3){var O=w[L+2]>>1&1,x=w[L+3]>>6,Y=1e3*N[14*(g===3?3-T:T===3?3:4)+E-1],ae=M[3*(g===3?0:g===2?1:2)+R],z=x===3?1:2,de=V[g][T],Se=_[T],ye=8*de*Se,be=Math.floor(de*Y/ae+O)*Se;if(k===null){var Oe=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);k=Oe?parseInt(Oe[1]):0}return k&&k<=87&&T===2&&Y>=224e3&&x===0&&(w[L+3]=128|w[L+3]),{sampleRate:ae,channelCount:z,frameLength:be,samplesPerFrame:ye}}}function Te(w,L){return w[L]===255&&(224&w[L+1])==224&&(6&w[L+1])!=0}function ke(w,L){return L+1<w.length&&Te(w,L)}function J(w,L){if(L+1<w.length&&Te(w,L)){var g=pe(w,L),T=4;g!=null&&g.frameLength&&(T=g.frameLength);var E=L+T;return E===w.length||ke(w,E)}return!1}const De=function(){function w(g){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=g,this.bytesAvailable=g.byteLength,this.word=0,this.bitsAvailable=0}var L=w.prototype;return L.loadWord=function(){var g=this.data,T=this.bytesAvailable,E=g.byteLength-T,R=new Uint8Array(4),O=Math.min(4,T);if(O===0)throw new Error("no bytes available");R.set(g.subarray(E,E+O)),this.word=new DataView(R.buffer).getUint32(0),this.bitsAvailable=8*O,this.bytesAvailable-=O},L.skipBits=function(g){var T;this.bitsAvailable>g?(this.word<<=g,this.bitsAvailable-=g):(g-=this.bitsAvailable,g-=(T=g>>3)>>3,this.bytesAvailable-=T,this.loadWord(),this.word<<=g,this.bitsAvailable-=g)},L.readBits=function(g){var T=Math.min(this.bitsAvailable,g),E=this.word>>>32-T;return g>32&&ie.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=T,this.bitsAvailable>0?this.word<<=T:this.bytesAvailable>0&&this.loadWord(),(T=g-T)>0&&this.bitsAvailable?E<<T|this.readBits(T):E},L.skipLZ=function(){var g;for(g=0;g<this.bitsAvailable;++g)if(this.word&2147483648>>>g)return this.word<<=g,this.bitsAvailable-=g,g;return this.loadWord(),g+this.skipLZ()},L.skipUEG=function(){this.skipBits(1+this.skipLZ())},L.skipEG=function(){this.skipBits(1+this.skipLZ())},L.readUEG=function(){var g=this.skipLZ();return this.readBits(g+1)-1},L.readEG=function(){var g=this.readUEG();return 1&g?1+g>>>1:-1*(g>>>1)},L.readBoolean=function(){return this.readBits(1)===1},L.readUByte=function(){return this.readBits(8)},L.readUShort=function(){return this.readBits(16)},L.readUInt=function(){return this.readBits(32)},L.skipScalingList=function(g){for(var T=8,E=8,R=0;R<g;R++)E!==0&&(E=(T+this.readEG()+256)%256),T=E===0?T:E},L.readSPS=function(){var g,T,E,R=0,O=0,x=0,Y=0,ae=this.readUByte.bind(this),z=this.readBits.bind(this),de=this.readUEG.bind(this),Se=this.readBoolean.bind(this),ye=this.skipBits.bind(this),be=this.skipEG.bind(this),Oe=this.skipUEG.bind(this),He=this.skipScalingList.bind(this);ae();var Le=ae();if(z(5),ye(3),ae(),Oe(),Le===100||Le===110||Le===122||Le===244||Le===44||Le===83||Le===86||Le===118||Le===128){var ze=de();if(ze===3&&ye(1),Oe(),Oe(),ye(1),Se())for(T=ze!==3?8:12,E=0;E<T;E++)Se()&&He(E<6?16:64)}Oe();var dt=de();if(dt===0)de();else if(dt===1)for(ye(1),be(),be(),g=de(),E=0;E<g;E++)be();Oe(),ye(1);var nt=de(),et=de(),gt=z(1);gt===0&&ye(1),ye(1),Se()&&(R=de(),O=de(),x=de(),Y=de());var xe=[1,1];if(Se()&&Se())switch(ae()){case 1:xe=[1,1];break;case 2:xe=[12,11];break;case 3:xe=[10,11];break;case 4:xe=[16,11];break;case 5:xe=[40,33];break;case 6:xe=[24,11];break;case 7:xe=[20,11];break;case 8:xe=[32,11];break;case 9:xe=[80,33];break;case 10:xe=[18,11];break;case 11:xe=[15,11];break;case 12:xe=[64,33];break;case 13:xe=[160,99];break;case 14:xe=[4,3];break;case 15:xe=[3,2];break;case 16:xe=[2,1];break;case 255:xe=[ae()<<8|ae(),ae()<<8|ae()]}return{width:Math.ceil(16*(nt+1)-2*R-2*O),height:(2-gt)*(et+1)*16-(gt?2:4)*(x+Y),pixelRatio:xe}},L.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},w}(),Re=function(){function w(g,T,E){this.keyData=void 0,this.decrypter=void 0,this.keyData=E,this.decrypter=new F.default(g,T,{removePKCS7Padding:!1})}var L=w.prototype;return L.decryptBuffer=function(g,T){this.decrypter.decrypt(g,this.keyData.key.buffer,this.keyData.iv.buffer,T)},L.decryptAacSample=function(g,T,E,R){var O=g[T].unit;if(!(O.length<=16)){var x=O.subarray(16,O.length-O.length%16),Y=x.buffer.slice(x.byteOffset,x.byteOffset+x.length),ae=this;this.decryptBuffer(Y,function(z){var de=new Uint8Array(z);O.set(de,16),R||ae.decryptAacSamples(g,T+1,E)})}},L.decryptAacSamples=function(g,T,E){for(;;T++){if(T>=g.length)return void E();if(!(g[T].unit.length<32)){var R=this.decrypter.isSync();if(this.decryptAacSample(g,T,E,R),!R)return}}},L.getAvcEncryptedData=function(g){for(var T=16*Math.floor((g.length-48)/160)+16,E=new Int8Array(T),R=0,O=32;O<g.length-16;O+=160,R+=16)E.set(g.subarray(O,O+16),R);return E},L.getAvcDecryptedUnit=function(g,T){for(var E=new Uint8Array(T),R=0,O=32;O<g.length-16;O+=160,R+=16)g.set(E.subarray(R,R+16),O);return g},L.decryptAvcSample=function(g,T,E,R,O,x){var Y=(0,B.discardEPB)(O.data),ae=this.getAvcEncryptedData(Y),z=this;this.decryptBuffer(ae.buffer,function(de){O.data=z.getAvcDecryptedUnit(Y,de),x||z.decryptAvcSamples(g,T,E+1,R)})},L.decryptAvcSamples=function(g,T,E,R){if(g instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,E=0){if(T>=g.length)return void R();for(var O=g[T].units;!(E>=O.length);E++){var x=O[E];if(!(x.data.length<=48||x.type!==1&&x.type!==5)){var Y=this.decrypter.isSync();if(this.decryptAvcSample(g,T,E,R,x,Y),!Y)return}}}},w}();function Ke(){return Ke=Object.assign?Object.assign.bind():function(w){for(var L=1;L<arguments.length;L++){var g=arguments[L];for(var T in g)Object.prototype.hasOwnProperty.call(g,T)&&(w[T]=g[T])}return w},Ke.apply(this,arguments)}var Ie=188;function we(w,L,g,T){return{key:w,frame:!1,pts:L,dts:g,units:[],debug:T,length:0}}function Me(w,L){return(31&w[L+10])<<8|w[L+11]}function Pe(w,L,g,T){var E={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},R=L+3+((15&w[L+1])<<8|w[L+2])-4;for(L+=12+((15&w[L+10])<<8|w[L+11]);L<R;){var O=(31&w[L+1])<<8|w[L+2];switch(w[L]){case 207:if(!T){ie.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:E.audio===-1&&(E.audio=O);break;case 21:E.id3===-1&&(E.id3=O);break;case 219:if(!T){ie.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:E.avc===-1&&(E.avc=O);break;case 3:case 4:g.mpeg!==!0&&g.mp3!==!0?ie.logger.log("MPEG audio found, not supported in this browser"):E.audio===-1&&(E.audio=O,E.segmentCodec="mp3");break;case 36:ie.logger.warn("Unsupported HEVC stream type found")}L+=5+((15&w[L+3])<<8|w[L+4])}return E}function Ye(w){var L,g,T,E,R,O=0,x=w.data;if(!w||w.size===0)return null;for(;x[0].length<19&&x.length>1;){var Y=new Uint8Array(x[0].length+x[1].length);Y.set(x[0]),Y.set(x[1],x[0].length),x[0]=Y,x.splice(1,1)}if(((L=x[0])[0]<<16)+(L[1]<<8)+L[2]===1){if((g=(L[4]<<8)+L[5])&&g>w.size-6)return null;var ae=L[7];192&ae&&(E=536870912*(14&L[9])+4194304*(255&L[10])+16384*(254&L[11])+128*(255&L[12])+(254&L[13])/2,64&ae?E-(R=536870912*(14&L[14])+4194304*(255&L[15])+16384*(254&L[16])+128*(255&L[17])+(254&L[18])/2)>54e5&&(ie.logger.warn(Math.round((E-R)/9e4)+"s delta between PTS and DTS, align them"),E=R):R=E);var z=(T=L[8])+9;if(w.size<=z)return null;w.size-=z;for(var de=new Uint8Array(w.size),Se=0,ye=x.length;Se<ye;Se++){var be=(L=x[Se]).byteLength;if(z){if(z>be){z-=be;continue}L=L.subarray(z),be-=z,z=0}de.set(L,O),O+=be}return g&&(g-=T+3),{data:de,pts:E,dts:R,len:g}}return null}function Ve(w,L){if(w.units.length&&w.frame){if(w.pts===void 0){var g=L.samples,T=g.length;if(!T)return void L.dropped++;var E=g[T-1];w.pts=E.pts,w.dts=E.dts}L.samples.push(w)}w.debug.length&&ie.logger.log(w.pts+"/"+w.dts+":"+w.debug)}const Fe=function(){function w(g,T,E){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=g,this.config=T,this.typeSupported=E}w.probe=function(g){var T=w.syncOffset(g);return T>0&&ie.logger.warn("MPEG2-TS detected but first sync word found @ offset "+T),T!==-1},w.syncOffset=function(g){for(var T=Math.min(940,g.length-376)+1,E=0;E<T;){if(g[E]===71&&g[E+Ie]===71)return E;E++}return-1},w.createTrack=function(g,T){return{container:g==="video"||g==="audio"?"video/mp2t":void 0,type:g,id:B.RemuxerTrackIdConfig[g],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:g==="audio"?T:void 0}};var L=w.prototype;return L.resetInitSegment=function(g,T,E,R){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=w.createTrack("video"),this._audioTrack=w.createTrack("audio",R),this._id3Track=w.createTrack("id3"),this._txtTrack=w.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=T,this.videoCodec=E,this._duration=R},L.resetTimeStamp=function(){},L.resetContiguity=function(){var g=this._audioTrack,T=this._avcTrack,E=this._id3Track;g&&(g.pesData=null),T&&(T.pesData=null),E&&(E.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},L.demux=function(g,T,E,R){var O;E===void 0&&(E=!1),R===void 0&&(R=!1),E||(this.sampleAes=null);var x=this._avcTrack,Y=this._audioTrack,ae=this._id3Track,z=this._txtTrack,de=x.pid,Se=x.pesData,ye=Y.pid,be=ae.pid,Oe=Y.pesData,He=ae.pesData,Le=null,ze=this.pmtParsed,dt=this._pmtId,nt=g.length;if(this.remainderData&&(nt=(g=(0,B.appendUint8Array)(this.remainderData,g)).length,this.remainderData=null),nt<Ie&&!R)return this.remainderData=g,{audioTrack:Y,videoTrack:x,id3Track:ae,textTrack:z};var et=Math.max(0,w.syncOffset(g));(nt-=(nt-et)%Ie)<g.byteLength&&!R&&(this.remainderData=new Uint8Array(g.buffer,nt,g.buffer.byteLength-nt));for(var gt=0,xe=et;xe<nt;xe+=Ie)if(g[xe]===71){var ct=!!(64&g[xe+1]),Ct=((31&g[xe+1])<<8)+g[xe+2],ut=void 0;if((48&g[xe+3])>>4>1){if((ut=xe+5+g[xe+4])===xe+Ie)continue}else ut=xe+4;switch(Ct){case de:ct&&(Se&&(O=Ye(Se))&&this.parseAVCPES(x,z,O,!1),Se={data:[],size:0}),Se&&(Se.data.push(g.subarray(ut,xe+Ie)),Se.size+=xe+Ie-ut);break;case ye:if(ct){if(Oe&&(O=Ye(Oe)))switch(Y.segmentCodec){case"aac":this.parseAACPES(Y,O);break;case"mp3":this.parseMPEGPES(Y,O)}Oe={data:[],size:0}}Oe&&(Oe.data.push(g.subarray(ut,xe+Ie)),Oe.size+=xe+Ie-ut);break;case be:ct&&(He&&(O=Ye(He))&&this.parseID3PES(ae,O),He={data:[],size:0}),He&&(He.data.push(g.subarray(ut,xe+Ie)),He.size+=xe+Ie-ut);break;case 0:ct&&(ut+=g[ut]+1),dt=this._pmtId=Me(g,ut);break;case dt:ct&&(ut+=g[ut]+1);var Lt=Pe(g,ut,this.typeSupported,E);(de=Lt.avc)>0&&(x.pid=de),(ye=Lt.audio)>0&&(Y.pid=ye,Y.segmentCodec=Lt.segmentCodec),(be=Lt.id3)>0&&(ae.pid=be),Le===null||ze||(ie.logger.log("unknown PID '"+Le+"' in TS found"),Le=null,xe=et-188),ze=this.pmtParsed=!0;break;case 17:case 8191:break;default:Le=Ct}}else gt++;gt>0&&this.observer.emit(he.Events.ERROR,he.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+gt+" TS packet/s that do not start with 0x47"}),x.pesData=Se,Y.pesData=Oe,ae.pesData=He;var pt={audioTrack:Y,videoTrack:x,id3Track:ae,textTrack:z};return R&&this.extractRemainingSamples(pt),pt},L.flush=function(){var g,T=this.remainderData;return this.remainderData=null,g=T?this.demux(T,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(g),this.sampleAes?this.decrypt(g,this.sampleAes):g},L.extractRemainingSamples=function(g){var T,E=g.audioTrack,R=g.videoTrack,O=g.id3Track,x=g.textTrack,Y=R.pesData,ae=E.pesData,z=O.pesData;if(Y&&(T=Ye(Y))?(this.parseAVCPES(R,x,T,!0),R.pesData=null):R.pesData=Y,ae&&(T=Ye(ae))){switch(E.segmentCodec){case"aac":this.parseAACPES(E,T);break;case"mp3":this.parseMPEGPES(E,T)}E.pesData=null}else ae!=null&&ae.size&&ie.logger.log("last AAC PES packet truncated,might overlap between fragments"),E.pesData=ae;z&&(T=Ye(z))?(this.parseID3PES(O,T),O.pesData=null):O.pesData=z},L.demuxSampleAes=function(g,T,E){var R=this.demux(g,E,!0,!this.config.progressive),O=this.sampleAes=new Re(this.observer,this.config,T);return this.decrypt(R,O)},L.decrypt=function(g,T){return new Promise(function(E){var R=g.audioTrack,O=g.videoTrack;R.samples&&R.segmentCodec==="aac"?T.decryptAacSamples(R.samples,0,function(){O.samples?T.decryptAvcSamples(O.samples,0,0,function(){E(g)}):E(g)}):O.samples&&T.decryptAvcSamples(O.samples,0,0,function(){E(g)})})},L.destroy=function(){this._duration=0},L.parseAVCPES=function(g,T,E,R){var O,x=this,Y=this.parseAVCNALu(g,E.data),ae=this.avcSample,z=!1;E.data=null,ae&&Y.length&&!g.audFound&&(Ve(ae,g),ae=this.avcSample=we(!1,E.pts,E.dts,"")),Y.forEach(function(de){switch(de.type){case 1:O=!0,ae||(ae=x.avcSample=we(!0,E.pts,E.dts,"")),ae.frame=!0;var Se=de.data;if(z&&Se.length>4){var ye=new De(Se).readSliceType();ye!==2&&ye!==4&&ye!==7&&ye!==9||(ae.key=!0)}break;case 5:O=!0,ae||(ae=x.avcSample=we(!0,E.pts,E.dts,"")),ae.key=!0,ae.frame=!0;break;case 6:O=!0,(0,B.parseSEIMessageFromNALu)(de.data,1,E.pts,T.samples);break;case 7:if(O=!0,z=!0,!g.sps){var be=new De(de.data).readSPS();g.width=be.width,g.height=be.height,g.pixelRatio=be.pixelRatio,g.sps=[de.data],g.duration=x._duration;for(var Oe=de.data.subarray(1,4),He="avc1.",Le=0;Le<3;Le++){var ze=Oe[Le].toString(16);ze.length<2&&(ze="0"+ze),He+=ze}g.codec=He}break;case 8:O=!0,g.pps||(g.pps=[de.data]);break;case 9:O=!1,g.audFound=!0,ae&&Ve(ae,g),ae=x.avcSample=we(!1,E.pts,E.dts,"");break;case 12:O=!0;break;default:O=!1,ae&&(ae.debug+="unknown NAL "+de.type+" ")}ae&&O&&ae.units.push(de)}),R&&ae&&(Ve(ae,g),this.avcSample=null)},L.getLastNalUnit=function(g){var T,E,R=this.avcSample;if(R&&R.units.length!==0||(R=g[g.length-1]),(T=R)!==null&&T!==void 0&&T.units){var O=R.units;E=O[O.length-1]}return E},L.parseAVCNALu=function(g,T){var E,R,O=T.byteLength,x=g.naluState||0,Y=x,ae=[],z=0,de=-1,Se=0;for(x===-1&&(de=0,Se=31&T[0],x=0,z=1);z<O;)if(E=T[z++],x)if(x!==1)if(E)if(E===1){if(de>=0){var ye={data:T.subarray(de,z-x-1),type:Se};ae.push(ye)}else{var be=this.getLastNalUnit(g.samples);if(be&&(Y&&z<=4-Y&&be.state&&(be.data=be.data.subarray(0,be.data.byteLength-Y)),(R=z-x-1)>0)){var Oe=new Uint8Array(be.data.byteLength+R);Oe.set(be.data,0),Oe.set(T.subarray(0,R),be.data.byteLength),be.data=Oe,be.state=0}}z<O?(de=z,Se=31&T[z],x=0):x=-1}else x=0;else x=3;else x=E?0:2;else x=E?0:1;if(de>=0&&x>=0){var He={data:T.subarray(de,O),type:Se,state:x};ae.push(He)}if(ae.length===0){var Le=this.getLastNalUnit(g.samples);if(Le){var ze=new Uint8Array(Le.data.byteLength+T.byteLength);ze.set(Le.data,0),ze.set(T,Le.data.byteLength),Le.data=ze}}return g.naluState=x,ae},L.parseAACPES=function(g,T){var E,R,O,x,Y,ae=0,z=this.aacOverFlow,de=T.data;if(z){this.aacOverFlow=null;var Se=z.missing,ye=z.sample.unit.byteLength;if(Se===-1){var be=new Uint8Array(ye+de.byteLength);be.set(z.sample.unit,0),be.set(de,ye),de=be}else{var Oe=ye-Se;z.sample.unit.set(de.subarray(0,Se),Oe),g.samples.push(z.sample),ae=z.missing}}for(E=ae,R=de.length;E<R-1&&!ce(de,E);E++);if(E===ae||(E<R-1?(O="AAC PES did not start with ADTS header,offset:"+E,x=!1):(O="no ADTS header found in AAC PES",x=!0),ie.logger.warn("parsing error:"+O),this.observer.emit(he.Events.ERROR,he.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:x,reason:O}),!x)){if(P(g,this.observer,de,E,this.audioCodec),T.pts!==void 0)Y=T.pts;else{if(!z)return void ie.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var He=p(g.samplerate);Y=z.sample.pts+He}for(var Le,ze=0;E<R;){if(E+=(Le=A(g,de,E,Y,ze)).length,Le.missing){this.aacOverFlow=Le;break}for(ze++;E<R-1&&!ce(de,E);E++);}}},L.parseMPEGPES=function(g,T){var E=T.data,R=E.length,O=0,x=0,Y=T.pts;if(Y!==void 0)for(;x<R;)if(ke(E,x)){var ae=ge(g,E,x,Y,O);if(!ae)break;x+=ae.length,O++}else x++;else ie.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},L.parseID3PES=function(g,T){if(T.pts!==void 0){var E=Ke({},T,{type:this._avcTrack?b.MetadataSchema.emsg:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});g.samples.push(E)}else ie.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},w}();function Je(w,L){return Je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,T){return g.__proto__=T,g},Je(w,L)}const $e=function(w){var L,g;function T(){return w.apply(this,arguments)||this}g=w,(L=T).prototype=Object.create(g.prototype),L.prototype.constructor=L,Je(L,g);var E=T.prototype;return E.resetInitSegment=function(R,O,x,Y){w.prototype.resetInitSegment.call(this,R,O,x,Y),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:O,duration:Y,inputTimeScale:9e4,dropped:0}},T.probe=function(R){if(!R)return!1;for(var O=(C.getID3Data(R,0)||[]).length,x=R.length;O<x;O++)if(J(R,O))return ie.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(R,O){return function(x,Y){return Te(x,Y)&&4<=x.length-Y}(R,O)},E.appendFrame=function(R,O,x){if(this.basePTS!==null)return ge(R,O,x,this.basePTS,this.frameIndex)},T}(le);var ot=H(524),rt=H(923);function Ze(w,L){var g=w==null?void 0:w.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||L===rt.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const ht=function(){function w(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var L=w.prototype;return L.destroy=function(){},L.resetTimeStamp=function(g){this.initPTS=g,this.lastEndTime=null},L.resetNextTimestamp=function(){this.lastEndTime=null},L.resetInitSegment=function(g,T,E){this.audioCodec=T,this.videoCodec=E,this.generateInitSegment(g),this.emitInitSegment=!0},L.generateInitSegment=function(g){var T=this.audioCodec,E=this.videoCodec;if(!g||!g.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var R=this.initData=(0,B.parseInitSegment)(g);T||(T=Ze(R.audio,rt.ElementaryStreamTypes.AUDIO)),E||(E=Ze(R.video,rt.ElementaryStreamTypes.VIDEO));var O={};R.audio&&R.video?O.audiovideo={container:"video/mp4",codec:T+","+E,initSegment:g,id:"main"}:R.audio?O.audio={container:"audio/mp4",codec:T,initSegment:g,id:"audio"}:R.video?O.video={container:"video/mp4",codec:E,initSegment:g,id:"main"}:ie.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=O},L.remux=function(g,T,E,R,O){var x,Y=this.initPTS,ae=this.lastEndTime,z={audio:void 0,video:void 0,text:R,id3:E,initSegment:void 0};(0,f.isFiniteNumber)(ae)||(ae=this.lastEndTime=O||0);var de=T.samples;if(!de||!de.length)return z;var Se={initPTS:void 0,timescale:1},ye=this.initData;if(ye&&ye.length||(this.generateInitSegment(de),ye=this.initData),!ye||!ye.length)return ie.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),z;this.emitInitSegment&&(Se.tracks=this.initTracks,this.emitInitSegment=!1);var be=(0,B.getStartDTS)(ye,de);(0,f.isFiniteNumber)(Y)||(this.initPTS=Se.initPTS=Y=be-O);var Oe=(0,B.getDuration)(de,ye),He=g?be-Y:ae,Le=He+Oe;(0,B.offsetStartDTS)(ye,de,Y),Oe>0?this.lastEndTime=Le:(ie.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var ze=!!ye.audio,dt=!!ye.video,nt="";ze&&(nt+="audio"),dt&&(nt+="video");var et={data1:de,startPTS:He,startDTS:He,endPTS:Le,endDTS:Le,type:nt,hasAudio:ze,hasVideo:dt,nb:1,dropped:0};z.audio=et.type==="audio"?et:void 0,z.video=et.type!=="audio"?et:void 0,z.initSegment=Se;var gt=(x=this.initPTS)!=null?x:0;return z.id3=(0,ot.flushTextTrackMetadataCueSamples)(E,O,gt,gt),R.samples.length&&(z.text=(0,ot.flushTextTrackUserdataCueSamples)(R,O,gt)),z},w}();var it;try{it=self.performance.now.bind(self.performance)}catch{ie.logger.debug("Unable to use Performance API on this environment"),it=self.Date.now}var lt=[{demux:Fe,remux:ot.default},{demux:se,remux:ht},{demux:G,remux:ot.default},{demux:$e,remux:ot.default}],Et=function(){function w(g,T,E,R,O){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=g,this.typeSupported=T,this.config=E,this.vendor=R,this.id=O}var L=w.prototype;return L.configure=function(g){this.transmuxConfig=g,this.decrypter&&this.decrypter.reset()},L.push=function(g,T,E,R){var O=this,x=E.transmuxing;x.executeStart=it();var Y=new Uint8Array(g),ae=this.config,z=this.currentTransmuxState,de=this.transmuxConfig;R&&(this.currentTransmuxState=R);var Se=R||z,ye=Se.contiguous,be=Se.discontinuity,Oe=Se.trackSwitch,He=Se.accurateTimeOffset,Le=Se.timeOffset,ze=Se.initSegmentChange,dt=de.audioCodec,nt=de.videoCodec,et=de.defaultInitPts,gt=de.duration,xe=de.initSegmentData;(be||Oe||ze)&&this.resetInitSegment(xe,dt,nt,gt),(be||ze)&&this.resetInitialTimestamp(et),ye||this.resetContiguity();var ct=function(Ut,It){var lr=null;return Ut.byteLength>0&&It!=null&&It.key!=null&&It.iv!==null&&It.method!=null&&(lr=It),lr}(Y,T);if(ct&&ct.method==="AES-128"){var Ct=this.getDecrypter();if(!ae.enableSoftwareAES)return this.decryptionPromise=Ct.webCryptoDecrypt(Y,ct.key.buffer,ct.iv.buffer).then(function(Ut){var It=O.push(Ut,null,E);return O.decryptionPromise=null,It}),this.decryptionPromise;var ut=Ct.softwareDecrypt(Y,ct.key.buffer,ct.iv.buffer);if(!ut)return x.executeEnd=it(),ft(E);Y=new Uint8Array(ut)}this.needsProbing(Y,be,Oe)&&this.configureTransmuxer(Y,de);var Lt=this.transmux(Y,ct,Le,He,E),pt=this.currentTransmuxState;return pt.contiguous=!0,pt.discontinuity=!1,pt.trackSwitch=!1,x.executeEnd=it(),Lt},L.flush=function(g){var T=this,E=g.transmuxing;E.executeStart=it();var R=this.decrypter,O=this.currentTransmuxState,x=this.decryptionPromise;if(x)return x.then(function(){return T.flush(g)});var Y=[],ae=O.timeOffset;if(R){var z=R.flush();z&&Y.push(this.push(z,null,g))}var de=this.demuxer,Se=this.remuxer;if(!de||!Se)return this.observer.emit(he.Events.ERROR,he.Events.ERROR,{type:$.ErrorTypes.MEDIA_ERROR,details:$.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),E.executeEnd=it(),[ft(g)];var ye=de.flush(ae);return Tt(ye)?ye.then(function(be){return T.flushRemux(Y,be,g),Y}):(this.flushRemux(Y,ye,g),Y)},L.flushRemux=function(g,T,E){var R=T.audioTrack,O=T.videoTrack,x=T.id3Track,Y=T.textTrack,ae=this.currentTransmuxState,z=ae.accurateTimeOffset,de=ae.timeOffset;ie.logger.log("[transmuxer.ts]: Flushed fragment "+E.sn+(E.part>-1?" p: "+E.part:"")+" of level "+E.level);var Se=this.remuxer.remux(R,O,x,Y,de,z,!0,this.id);g.push({remuxResult:Se,chunkMeta:E}),E.transmuxing.executeEnd=it()},L.resetInitialTimestamp=function(g){var T=this.demuxer,E=this.remuxer;T&&E&&(T.resetTimeStamp(g),E.resetTimeStamp(g))},L.resetContiguity=function(){var g=this.demuxer,T=this.remuxer;g&&T&&(g.resetContiguity(),T.resetNextTimestamp())},L.resetInitSegment=function(g,T,E,R){var O=this.demuxer,x=this.remuxer;O&&x&&(O.resetInitSegment(g,T,E,R),x.resetInitSegment(g,T,E))},L.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},L.transmux=function(g,T,E,R,O){return T&&T.method==="SAMPLE-AES"?this.transmuxSampleAes(g,T,E,R,O):this.transmuxUnencrypted(g,E,R,O)},L.transmuxUnencrypted=function(g,T,E,R){var O=this.demuxer.demux(g,T,!1,!this.config.progressive),x=O.audioTrack,Y=O.videoTrack,ae=O.id3Track,z=O.textTrack;return{remuxResult:this.remuxer.remux(x,Y,ae,z,T,E,!1,this.id),chunkMeta:R}},L.transmuxSampleAes=function(g,T,E,R,O){var x=this;return this.demuxer.demuxSampleAes(g,T,E).then(function(Y){return{remuxResult:x.remuxer.remux(Y.audioTrack,Y.videoTrack,Y.id3Track,Y.textTrack,E,R,!1,x.id),chunkMeta:O}})},L.configureTransmuxer=function(g,T){for(var E,R=this.config,O=this.observer,x=this.typeSupported,Y=this.vendor,ae=T.audioCodec,z=T.defaultInitPts,de=T.duration,Se=T.initSegmentData,ye=T.videoCodec,be=0,Oe=lt.length;be<Oe;be++)if(lt[be].demux.probe(g)){E=lt[be];break}E||(ie.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),E={demux:se,remux:ht});var He=this.demuxer,Le=this.remuxer,ze=E.remux,dt=E.demux;Le&&Le instanceof ze||(this.remuxer=new ze(O,R,x,Y)),He&&He instanceof dt||(this.demuxer=new dt(O,R,x),this.probe=dt.probe),this.resetInitSegment(Se,ae,ye,de),this.resetInitialTimestamp(z)},L.needsProbing=function(g,T,E){return!this.demuxer||!this.remuxer||T||E},L.getDecrypter=function(){var g=this.decrypter;return g||(g=this.decrypter=new F.default(this.observer,this.config)),g},w}(),ft=function(w){return{remuxResult:{},chunkMeta:w}};function Tt(w){return"then"in w&&w.then instanceof Function}var St=function(w,L,g,T,E){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=w,this.videoCodec=L,this.initSegmentData=g,this.duration=T,this.defaultInitPts=E},bt=function(w,L,g,T,E,R){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=w,this.contiguous=L,this.accurateTimeOffset=g,this.trackSwitch=T,this.timeOffset=E,this.initSegmentChange=R}},973:(je,Ee,H)=>{var he,$;H.r(Ee),H.d(Ee,{ErrorDetails:()=>$,ErrorTypes:()=>he}),function(F){F.NETWORK_ERROR="networkError",F.MEDIA_ERROR="mediaError",F.KEY_SYSTEM_ERROR="keySystemError",F.MUX_ERROR="muxError",F.OTHER_ERROR="otherError"}(he||(he={})),function(F){F.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",F.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",F.KEY_SYSTEM_NO_SESSION="keySystemNoSession",F.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",F.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",F.MANIFEST_LOAD_ERROR="manifestLoadError",F.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",F.MANIFEST_PARSING_ERROR="manifestParsingError",F.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",F.LEVEL_EMPTY_ERROR="levelEmptyError",F.LEVEL_LOAD_ERROR="levelLoadError",F.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",F.LEVEL_SWITCH_ERROR="levelSwitchError",F.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",F.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",F.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",F.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",F.FRAG_LOAD_ERROR="fragLoadError",F.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",F.FRAG_DECRYPT_ERROR="fragDecryptError",F.FRAG_PARSING_ERROR="fragParsingError",F.REMUX_ALLOC_ERROR="remuxAllocError",F.KEY_LOAD_ERROR="keyLoadError",F.KEY_LOAD_TIMEOUT="keyLoadTimeOut",F.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",F.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",F.BUFFER_APPEND_ERROR="bufferAppendError",F.BUFFER_APPENDING_ERROR="bufferAppendingError",F.BUFFER_STALLED_ERROR="bufferStalledError",F.BUFFER_FULL_ERROR="bufferFullError",F.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",F.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",F.INTERNAL_EXCEPTION="internalException",F.INTERNAL_ABORTED="aborted",F.UNKNOWN="unknown"}($||($={}))},851:(je,Ee,H)=>{var he;H.r(Ee),H.d(Ee,{Events:()=>he}),function($){$.MEDIA_ATTACHING="hlsMediaAttaching",$.MEDIA_ATTACHED="hlsMediaAttached",$.MEDIA_DETACHING="hlsMediaDetaching",$.MEDIA_DETACHED="hlsMediaDetached",$.BUFFER_RESET="hlsBufferReset",$.BUFFER_CODECS="hlsBufferCodecs",$.BUFFER_CREATED="hlsBufferCreated",$.BUFFER_APPENDING="hlsBufferAppending",$.BUFFER_APPENDED="hlsBufferAppended",$.BUFFER_EOS="hlsBufferEos",$.BUFFER_FLUSHING="hlsBufferFlushing",$.BUFFER_FLUSHED="hlsBufferFlushed",$.MANIFEST_LOADING="hlsManifestLoading",$.MANIFEST_LOADED="hlsManifestLoaded",$.MANIFEST_PARSED="hlsManifestParsed",$.LEVEL_SWITCHING="hlsLevelSwitching",$.LEVEL_SWITCHED="hlsLevelSwitched",$.LEVEL_LOADING="hlsLevelLoading",$.LEVEL_LOADED="hlsLevelLoaded",$.LEVEL_UPDATED="hlsLevelUpdated",$.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",$.LEVELS_UPDATED="hlsLevelsUpdated",$.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",$.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",$.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",$.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",$.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",$.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",$.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",$.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",$.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",$.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",$.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",$.CUES_PARSED="hlsCuesParsed",$.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",$.INIT_PTS_FOUND="hlsInitPtsFound",$.FRAG_LOADING="hlsFragLoading",$.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",$.FRAG_LOADED="hlsFragLoaded",$.FRAG_DECRYPTED="hlsFragDecrypted",$.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",$.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",$.FRAG_PARSING_METADATA="hlsFragParsingMetadata",$.FRAG_PARSED="hlsFragParsed",$.FRAG_BUFFERED="hlsFragBuffered",$.FRAG_CHANGED="hlsFragChanged",$.FPS_DROP="hlsFpsDrop",$.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",$.ERROR="hlsError",$.DESTROYING="hlsDestroying",$.KEY_LOADING="hlsKeyLoading",$.KEY_LOADED="hlsKeyLoaded",$.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",$.BACK_BUFFER_REACHED="hlsBackBufferReached"}(he||(he={}))},817:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{default:()=>Pi});var he,$=H(945),F=H(965),f=H(851),C=H(973),b=H(93),Q=H(63),B=/^(\d+)x(\d+)$/,U=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,ee=function(){function h(e){for(var t in typeof e=="string"&&(e=h.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var l=h.prototype;return l.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},l.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},l.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},l.decimalFloatingPoint=function(e){return parseFloat(this[e])},l.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},l.enumeratedString=function(e){return this[e]},l.bool=function(e){return this[e]==="YES"},l.decimalResolution=function(e){var t=B.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},h.parseAttrList=function(e){var t,i={};for(U.lastIndex=0;(t=U.exec(e))!==null;){var n=t[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},h}();function oe(){return oe=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},oe.apply(this,arguments)}function le(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}(function(h){h.ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN"})(he||(he={}));var ie=function(){function h(t,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){var n=i.attr;for(var s in n)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==n[s]){b.logger.warn('DATERANGE tag attribute: "'+s+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=s;break}t=oe(new ee({}),n,t)}if(this.attr=t,this._startDate=new Date(t[he.START_DATE]),he.END_DATE in this.attr){var r=new Date(this.attr[he.END_DATE]);(0,F.isFiniteNumber)(r.getTime())&&(this._endDate=r)}}var l,e;return l=h,(e=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return t!==null?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(he.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(he.DURATION);if((0,F.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return he.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(he.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(he.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,F.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&le(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}(),te=H(923);function Z(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}var ve=function(){function h(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}var l,e;return h.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var i=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!i,this.advanced=this.endSN>t.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},l=h,(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,F.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!==null&&t!==void 0&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&Z(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}(),ce=H(960),me={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function P(h,l){return MediaSource.isTypeSupported((l||"video")+'/mp4;codecs="'+h+'"')}var p=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,A=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),G=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ne=/\.(mp4|m4s|m4v|m4a)$/i,se=function(){function h(){}return h.findGroup=function(l,e){for(var t=0;t<l.length;t++){var i=l[t];if(i.id===e)return i}},h.convertAVC1ToAVCOTI=function(l){var e=l.split(".");if(e.length>2){var t=e.shift()+".";return(t+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return l},h.resolve=function(l,e){return $.buildAbsoluteURL(e,l,{alwaysNormalize:!0})},h.parseMasterPlaylist=function(l,e){var t,i=[],n=[],s={},r=!1;for(p.lastIndex=0;(t=p.exec(l))!=null;)if(t[1]){var a,o=new ee(t[1]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:h.resolve(t[2],e)},d=o.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),k((o.CODECS||"").split(/[ ,]+/).filter(function(v){return v}),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=h.convertAVC1ToAVCOTI(u.videoCodec)),(a=u.unknownCodecs)!==null&&a!==void 0&&a.length||n.push(u),i.push(u)}else if(t[3]){var c=new ee(t[3]);c["DATA-ID"]&&(r=!0,s[c["DATA-ID"]]=c)}return{levels:n.length>0&&n.length<i.length?n:i,sessionData:r?s:null}},h.parseMasterPlaylistMedia=function(l,e,t,i){var n;i===void 0&&(i=[]);var s=[],r=0;for(A.lastIndex=0;(n=A.exec(l))!==null;){var a=new ee(n[1]);if(a.TYPE===t){var o={attrs:a,bitrate:0,id:r++,groupId:a["GROUP-ID"],instreamId:a["INSTREAM-ID"],name:a.NAME||a.LANGUAGE||"",type:t,default:a.bool("DEFAULT"),autoselect:a.bool("AUTOSELECT"),forced:a.bool("FORCED"),lang:a.LANGUAGE,url:a.URI?h.resolve(a.URI,e):""};if(i.length){var u=h.findGroup(i,o.groupId)||i[0];N(o,u,"audioCodec"),N(o,u,"textCodec")}s.push(o)}}return s},h.parseLevelPlaylist=function(l,e,t,i,n){var s,r,a,o=new ve(e),u=o.fragments,d=null,c=0,v=0,m=0,y=0,I=null,D=new te.Fragment(i,e),W=-1,q=!1;for(S.lastIndex=0,o.m3u8=l;(s=S.exec(l))!==null;){q&&(q=!1,(D=new te.Fragment(i,e)).start=m,D.sn=c,D.cc=y,D.level=t,d&&(D.initSegment=d,D.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var K=s[1];if(K){D.duration=parseFloat(K);var X=(" "+s[2]).slice(1);D.title=X||null,D.tagList.push(X?["INF",K,X]:["INF",K])}else if(s[3])(0,F.isFiniteNumber)(D.duration)&&(D.start=m,a&&(D.levelkey=a),D.sn=c,D.level=t,D.cc=y,D.urlId=n,u.push(D),D.relurl=(" "+s[3]).slice(1),M(D,I),I=D,m+=D.duration,c++,v=0,q=!0);else if(s[4]){var re=(" "+s[4]).slice(1);I?D.setByteRange(re,I):D.setByteRange(re)}else if(s[5])D.rawProgramDateTime=(" "+s[5]).slice(1),D.tagList.push(["PROGRAM-DATE-TIME",D.rawProgramDateTime]),W===-1&&(W=u.length);else{if(!(s=s[0].match(G))){b.logger.warn("No matches on slow regex match for level playlist!");continue}for(r=1;r<s.length&&s[r]===void 0;r++);var j=(" "+s[r]).slice(1),fe=(" "+s[r+1]).slice(1),ue=s[r+2]?(" "+s[r+2]).slice(1):"";switch(j){case"PLAYLIST-TYPE":o.type=fe.toUpperCase();break;case"MEDIA-SEQUENCE":c=o.startSN=parseInt(fe);break;case"SKIP":var Ae=new ee(fe),_e=Ae.decimalInteger("SKIPPED-SEGMENTS");if((0,F.isFiniteNumber)(_e)){o.skippedSegments=_e;for(var Be=_e;Be--;)u.unshift(null);c+=_e}var Xe=Ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");Xe&&(o.recentlyRemovedDateranges=Xe.split("	"));break;case"TARGETDURATION":o.targetduration=parseFloat(fe);break;case"VERSION":o.version=parseInt(fe);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(fe||ue)&&D.tagList.push(ue?[fe,ue]:[fe]);break;case"DISCONTINUITY":y++,D.tagList.push(["DIS"]);break;case"GAP":D.tagList.push([j]);break;case"BITRATE":D.tagList.push([j,fe]);break;case"DATERANGE":var Ne=new ee(fe),Ge=new ie(Ne,o.dateRanges[Ne.ID]);Ge.isValid||o.skippedSegments?o.dateRanges[Ge.id]=Ge:b.logger.warn('Ignoring invalid DATERANGE tag: "'+fe+'"'),D.tagList.push(["EXT-X-DATERANGE",fe]);break;case"DISCONTINUITY-SEQUENCE":y=parseInt(fe);break;case"KEY":var Qe,at=new ee(fe),vt=at.enumeratedString("METHOD"),tt=at.URI,st=at.hexadecimalInteger("IV"),Dt=at.enumeratedString("KEYFORMATVERSIONS"),tr=at.enumeratedString("KEYID"),Ce=(Qe=at.enumeratedString("KEYFORMAT"))!=null?Qe:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Ce)>-1){b.logger.warn("Keyformat "+Ce+" is not supported from the manifest");continue}if(Ce!=="identity")continue;vt&&(a=ce.LevelKey.fromURL(e,tt),tt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(vt)>=0&&(a.method=vt,a.keyFormat=Ce,tr&&(a.keyID=tr),Dt&&(a.keyFormatVersions=Dt),a.iv=st));break;case"START":var Ue=new ee(fe).decimalFloatingPoint("TIME-OFFSET");(0,F.isFiniteNumber)(Ue)&&(o.startTimeOffset=Ue);break;case"MAP":var rr=new ee(fe);if(D.duration){var Pt=new te.Fragment(i,e);V(Pt,rr,t,a),d=Pt,D.initSegment=d,d.rawProgramDateTime&&!D.rawProgramDateTime&&(D.rawProgramDateTime=d.rawProgramDateTime)}else V(D,rr,t,a),d=D,q=!0;break;case"SERVER-CONTROL":var At=new ee(fe);o.canBlockReload=At.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=At.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&At.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=At.optionalFloat("PART-HOLD-BACK",0),o.holdBack=At.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ir=new ee(fe);o.partTarget=ir.decimalFloatingPoint("PART-TARGET");break;case"PART":var kt=o.partList;kt||(kt=o.partList=[]);var Ft=v>0?kt[kt.length-1]:void 0,Ht=v++,Rt=new te.Part(new ee(fe),D,e,Ht,Ft);kt.push(Rt),D.duration+=Rt.duration;break;case"PRELOAD-HINT":var nr=new ee(fe);o.preloadHint=nr;break;case"RENDITION-REPORT":var Xt=new ee(fe);o.renditionReports=o.renditionReports||[],o.renditionReports.push(Xt);break;default:b.logger.warn("line parsed but not handled: "+s)}}}I&&!I.relurl?(u.pop(),m-=I.duration,o.partList&&(o.fragmentHint=I)):o.partList&&(M(D,I),D.cc=y,o.fragmentHint=D);var Xr=u.length,pr=u[0],Qr=u[Xr-1];if((m+=o.skippedSegments*o.targetduration)>0&&Xr&&Qr){o.averagetargetduration=m/Xr;var Fi=Qr.sn;o.endSN=Fi!=="initSegment"?Fi:0,pr&&(o.startCC=pr.cc,pr.initSegment||o.fragments.every(function(ar){return ar.relurl&&(sr=ar.relurl,ne.test((or=(Qt=$.parseURL(sr))===null||Qt===void 0?void 0:Qt.path)!=null?or:""));var sr,or,Qt})&&(b.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(D=new te.Fragment(i,e)).relurl=Qr.relurl,D.level=t,D.sn="initSegment",pr.initSegment=D,o.needSidxRanges=!0))}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(m+=o.fragmentHint.duration),o.totalduration=m,o.endCC=y,W>0&&function(ar,sr){for(var or=ar[sr],Qt=sr;Qt--;){var mr=ar[Qt];if(!mr)return;mr.programDateTime=or.programDateTime-1e3*mr.duration,or=mr}}(u,W),o},h}();function k(h,l){["video","audio","text"].forEach(function(e){var t=h.filter(function(n){return function(s,r){var a=me[r];return!!a&&a[s.slice(0,4)]===!0}(n,e)});if(t.length){var i=t.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});l[e+"Codec"]=i.length>0?i[0]:t[0],h=h.filter(function(n){return t.indexOf(n)===-1})}}),l.unknownCodecs=h}function N(h,l,e){var t=l[e];t&&(h[e]=t)}function M(h,l){h.rawProgramDateTime?h.programDateTime=Date.parse(h.rawProgramDateTime):l!=null&&l.programDateTime&&(h.programDateTime=l.endProgramDateTime),(0,F.isFiniteNumber)(h.programDateTime)||(h.programDateTime=null,h.rawProgramDateTime=null)}function V(h,l,e,t){h.relurl=l.URI,l.BYTERANGE&&h.setByteRange(l.BYTERANGE),h.level=e,h.sn="initSegment",t&&(h.levelkey=t),h.initSegment=null}var _=H(308);function ge(h,l){var e=h.url;return e!==void 0&&e.indexOf("data:")!==0||(e=l.url),e}const pe=function(){function h(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var l=h.prototype;return l.startLoad=function(e){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var e=this.hls;e.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(f.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(f.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var e=this.hls;e.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(f.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(f.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,s=new(i||n)(t);return e.loader=s,this.loaders[e.type]=s,s},l.getInternalLoader=function(e){return this.loaders[e.type]},l.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},l.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:_.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},l.onLevelLoading=function(e,t){var i=t.id,n=t.level,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:null,level:n,responseType:"text",type:_.PlaylistContextType.LEVEL,url:s,deliveryDirectives:r})},l.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:_.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:r})},l.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,s=t.url,r=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:_.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:r})},l.load=function(e){var t,i,n,s,r,a,o=this.hls.config,u=this.getInternalLoader(e);if(u){var d=u.context;if(d&&d.url===e.url)return void b.logger.trace("[playlist-loader]: playlist request ongoing");b.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),u.abort()}switch(e.type){case _.PlaylistContextType.MANIFEST:i=o.manifestLoadingMaxRetry,n=o.manifestLoadingTimeOut,s=o.manifestLoadingRetryDelay,r=o.manifestLoadingMaxRetryTimeout;break;case _.PlaylistContextType.LEVEL:case _.PlaylistContextType.AUDIO_TRACK:case _.PlaylistContextType.SUBTITLE_TRACK:i=0,n=o.levelLoadingTimeOut;break;default:i=o.levelLoadingMaxRetry,n=o.levelLoadingTimeOut,s=o.levelLoadingRetryDelay,r=o.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part&&(e.type===_.PlaylistContextType.LEVEL&&e.level!==null?a=this.hls.levels[e.level].details:e.type===_.PlaylistContextType.AUDIO_TRACK&&e.id!==null?a=this.hls.audioTracks[e.id].details:e.type===_.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(a=this.hls.subtitleTracks[e.id].details),a)){var c=a.partTarget,v=a.targetduration;c&&v&&(n=Math.min(1e3*Math.max(3*c,.8*v),n))}var m={timeout:n,maxRetry:i,retryDelay:s,maxRetryDelay:r,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(e,m,y)},l.loadsuccess=function(e,t,i,n){if(n===void 0&&(n=null),i.isSidxRequest)return this.handleSidxRequest(e,i),void this.handlePlaylistLoaded(e,t,i,n);this.resetInternalLoader(i.type);var s=e.data;s.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,n):this.handleMasterPlaylist(e,t,i,n)):this.handleManifestParsingError(e,i,"no EXTM3U delimiter",n)},l.loaderror=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,e)},l.loadtimeout=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},l.handleMasterPlaylist=function(e,t,i,n){var s=this.hls,r=e.data,a=ge(e,i),o=se.parseMasterPlaylist(r,a),u=o.levels,d=o.sessionData;if(u.length){var c=u.map(function(D){return{id:D.attrs.AUDIO,audioCodec:D.audioCodec}}),v=u.map(function(D){return{id:D.attrs.SUBTITLES,textCodec:D.textCodec}}),m=se.parseMasterPlaylistMedia(r,a,"AUDIO",c),y=se.parseMasterPlaylistMedia(r,a,"SUBTITLES",v),I=se.parseMasterPlaylistMedia(r,a,"CLOSED-CAPTIONS");m.length&&(m.some(function(D){return!D.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ee({}),bitrate:0,url:""}))),s.trigger(f.Events.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:y,captions:I,url:a,stats:t,networkDetails:n,sessionData:d})}else this.handleManifestParsingError(e,i,"no level found in manifest",n)},l.handleTrackOrLevelPlaylist=function(e,t,i,n){var s=this.hls,r=i.id,a=i.level,o=i.type,u=ge(e,i),d=(0,F.isFiniteNumber)(r)?r:0,c=(0,F.isFiniteNumber)(a)?a:d,v=function(W){switch(W.type){case _.PlaylistContextType.AUDIO_TRACK:return _.PlaylistLevelType.AUDIO;case _.PlaylistContextType.SUBTITLE_TRACK:return _.PlaylistLevelType.SUBTITLE;default:return _.PlaylistLevelType.MAIN}}(i),m=se.parseLevelPlaylist(e.data,u,c,v,d);if(m.fragments.length){if(o===_.PlaylistContextType.MANIFEST){var y={attrs:new ee({}),bitrate:0,details:m,name:"",url:u};s.trigger(f.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null})}if(t.parsing.end=performance.now(),m.needSidxRanges){var I,D=(I=m.fragments[0].initSegment)===null||I===void 0?void 0:I.url;this.load({url:D,isSidxRequest:!0,type:o,level:a,levelDetails:m,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=m,this.handlePlaylistLoaded(e,t,i,n)}else s.trigger(f.Events.ERROR,{type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},l.handleSidxRequest=function(e,t){var i=new Uint8Array(e.data),n=(0,Q.findBox)(i,["sidx"])[0];if(n){var s=(0,Q.parseSegmentIndex)(n);if(s){var r=s.references,a=t.levelDetails;r.forEach(function(o,u){var d=o.info,c=a.fragments[u];if(c.byteRange.length===0&&c.setByteRange(String(1+d.end-d.start)+"@"+String(d.start)),c.initSegment){var v=(0,Q.findBox)(i,["moov"])[0],m=v?v.length:null;c.initSegment.setByteRange(String(m)+"@0")}})}}},l.handleManifestParsingError=function(e,t,i,n){this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===_.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:n})},l.handleNetworkError=function(e,t,i,n){i===void 0&&(i=!1),b.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=C.ErrorDetails.UNKNOWN,r=!1,a=this.getInternalLoader(e);switch(e.type){case _.PlaylistContextType.MANIFEST:s=i?C.ErrorDetails.MANIFEST_LOAD_TIMEOUT:C.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case _.PlaylistContextType.LEVEL:s=i?C.ErrorDetails.LEVEL_LOAD_TIMEOUT:C.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case _.PlaylistContextType.AUDIO_TRACK:s=i?C.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:C.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case _.PlaylistContextType.SUBTITLE_TRACK:s=i?C.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:C.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1}a&&this.resetInternalLoader(e.type);var o={type:C.ErrorTypes.NETWORK_ERROR,details:s,fatal:r,url:e.url,loader:a,context:e,networkDetails:t};n&&(o.response=n),this.hls.trigger(f.Events.ERROR,o)},l.handlePlaylistLoaded=function(e,t,i,n){var s=i.type,r=i.level,a=i.id,o=i.groupId,u=i.loader,d=i.levelDetails,c=i.deliveryDirectives;if(d!=null&&d.targetduration){if(u)switch(d.live&&(u.getCacheAge&&(d.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(d.ageHeader)||(d.ageHeader=0)),s){case _.PlaylistContextType.MANIFEST:case _.PlaylistContextType.LEVEL:this.hls.trigger(f.Events.LEVEL_LOADED,{details:d,level:r||0,id:a||0,stats:t,networkDetails:n,deliveryDirectives:c});break;case _.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(f.Events.AUDIO_TRACK_LOADED,{details:d,id:a||0,groupId:o||"",stats:t,networkDetails:n,deliveryDirectives:c});break;case _.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(f.Events.SUBTITLE_TRACK_LOADED,{details:d,id:a||0,groupId:o||"",stats:t,networkDetails:n,deliveryDirectives:c})}}else this.handleManifestParsingError(e,i,"invalid target duration",n)},h}();var Te=function(){function h(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this.registerListeners()}var l=h.prototype;return l.startLoad=function(e){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){this.hls.on(f.Events.KEY_LOADING,this.onKeyLoading,this)},l.unregisterListeners=function(){this.hls.off(f.Events.KEY_LOADING,this.onKeyLoading)},l.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onKeyLoading=function(e,t){var i=t.frag,n=i.type,s=this.loaders[n];if(i.decryptdata){var r=i.decryptdata.uri;if(r!==this.decrypturl||this.decryptkey===null){var a=this.hls.config;if(s&&(b.logger.warn("abort previous key loader for type:"+n),s.abort()),!r)return void b.logger.warn("key uri is falsy");var o=a.loader,u=i.loader=this.loaders[n]=new o(a);this.decrypturl=r,this.decryptkey=null;var d={url:r,frag:i,responseType:"arraybuffer"},c={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(d,c,v)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(f.Events.KEY_LOADED,{frag:i}))}else b.logger.warn("Missing decryption data on fragment in onKeyLoading")},l.loadsuccess=function(e,t,i){var n=i.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(f.Events.KEY_LOADED,{frag:n})):b.logger.error("after key load, decryptdata unset")},l.loaderror=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},l.loadtimeout=function(e,t){var i=t.frag,n=i.loader;n&&n.abort(),delete this.loaders[i.type],this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},h}();function ke(h,l){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=h,l.dispatchEvent(e)}function J(h,l){var e=h.mode;if(e==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(l.id))try{if(h.addCue(l),!h.cues.getCueById(l.id))throw new Error("addCue is failed for: "+l)}catch(i){b.logger.debug("[texttrack-utils]: "+i);var t=new self.TextTrackCue(l.startTime,l.endTime,l.text);t.id=l.id,h.addCue(t)}e==="disabled"&&(h.mode=e)}function De(h){var l=h.mode;if(l==="disabled"&&(h.mode="hidden"),h.cues)for(var e=h.cues.length;e--;)h.removeCue(h.cues[e]);l==="disabled"&&(h.mode=l)}function Re(h,l,e,t){var i=h.mode;if(i==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0)for(var n=function(r,a,o){var u=[],d=function(y,I){if(I<y[0].startTime)return 0;var D=y.length-1;if(I>y[D].endTime)return-1;for(var W=0,q=D;W<=q;){var K=Math.floor((q+W)/2);if(I<y[K].startTime)q=K-1;else{if(!(I>y[K].startTime&&W<D))return K;W=K+1}}return y[W].startTime-I<I-y[q].startTime?W:q}(r,a);if(d>-1)for(var c=d,v=r.length;c<v;c++){var m=r[c];if(m.startTime>=a&&m.endTime<=o)u.push(m);else if(m.startTime>o)return u}return u}(h.cues,l,e),s=0;s<n.length;s++)t&&!t(n[s])||h.removeCue(n[s]);i==="disabled"&&(h.mode=i)}var Ke=H(181),Ie=H(856);function we(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Me=function(){var h=we();try{new h(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Pe(h,l){return h.getTime()/1e3-l}const Ye=function(){function h(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var l=h.prototype;return l.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},l._registerListeners=function(){var e=this.hls;e.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l._unregisterListeners=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l.onMediaAttached=function(e,t){this.media=t.media},l.onMediaDetaching=function(){this.id3Track&&(De(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},l.onManifestLoading=function(){this.dateRangeCuesAppended={}},l.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},l.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if(i.kind==="metadata"&&i.label==="id3")return ke(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},l.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,s=i.enableID3MetadataCues;if(n||s){t.frag;var r=t.samples;t.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=we(),o=0;o<r.length;o++){var u=r[o].type;if((u!==Ie.MetadataSchema.emsg||n)&&s){var d=Ke.getID3Frames(r[o].data);if(d){var c=r[o].pts,v=c+r[o].duration;v>Me&&(v=Me),v-c<=0&&(v=c+.25);for(var m=0;m<d.length;m++){var y=d[m];if(!Ke.isTimeStampFrame(y)){this.updateId3CueEnds(c);var I=new a(c,v,"");I.value=y,u&&(I.type=u),this.id3Track.addCue(I)}}}}}}}},l.updateId3CueEnds=function(e){var t,i=(t=this.id3Track)===null||t===void 0?void 0:t.cues;if(i)for(var n=i.length;n--;){var s=i[n];s.startTime<e&&s.endTime===Me&&(s.endTime=e)}},l.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,s=t.type,r=this.id3Track,a=this.hls;if(a){var o=a.config,u=o.enableEmsgMetadataCues,d=o.enableID3MetadataCues;r&&(u||d)&&Re(r,i,n,s==="audio"?function(c){return c.type===Ie.MetadataSchema.audioId3&&d}:s==="video"?function(c){return c.type===Ie.MetadataSchema.emsg&&u}:function(c){return c.type===Ie.MetadataSchema.audioId3&&d||c.type===Ie.MetadataSchema.emsg&&u})}},l.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,r=this.id3Track,a=n.dateRanges,o=Object.keys(a);if(r)for(var u=Object.keys(s).filter(function(W){return!o.includes(W)}),d=function(W){var q=u[W];Object.keys(s[q].cues).forEach(function(K){r.removeCue(s[q].cues[K])}),delete s[q]},c=u.length;c--;)d(c);var v=n.fragments[n.fragments.length-1];if(o.length!==0&&(0,F.isFiniteNumber)(v==null?void 0:v.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var m=v.programDateTime/1e3-v.start,y=we(),I=function(W){var q=o[W],K=a[q],X=s[q],re=(X==null?void 0:X.cues)||{},j=(X==null?void 0:X.durationKnown)||!1,fe=Pe(K.startDate,m),ue=Me,Ae=K.endDate;if(Ae)ue=Pe(Ae,m),j=!0;else if(K.endOnNext&&!j){var _e=o.reduce(function(vt,tt){var st=a[tt];return st.class===K.class&&st.id!==tt&&st.startDate>K.startDate&&vt.push(st),vt},[]).sort(function(vt,tt){return vt.startDate.getTime()-tt.startDate.getTime()})[0];_e&&(ue=Pe(_e.startDate,m),j=!0)}for(var Be,Xe=Object.keys(K.attr),Ne=0;Ne<Xe.length;Ne++){var Ge=Xe[Ne];if(Ge!==he.ID&&Ge!==he.CLASS&&Ge!==he.START_DATE&&Ge!==he.DURATION&&Ge!==he.END_DATE&&Ge!==he.END_ON_NEXT){var Qe=re[Ge];if(Qe)j&&!X.durationKnown&&(Qe.endTime=ue);else{var at=K.attr[Ge];Qe=new y(fe,ue,""),Ge!==he.SCTE35_OUT&&Ge!==he.SCTE35_IN||(Be=at,at=Uint8Array.from(Be.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),Qe.value={key:Ge,data:at},Qe.type=Ie.MetadataSchema.dateRange,i.id3Track.addCue(Qe),re[Ge]=Qe}}}s[q]={cues:re,dateRange:K,durationKnown:j}},D=0;D<o.length;D++)I(D)}}},h}();function Ve(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}var Fe,Je=function(){function h(i){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=i,this.config=i.config,this.registerListeners()}var l,e,t=h.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(f.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(f.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(f.Events.ERROR,this.onError)},t.onMediaAttached=function(i,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(i,n){var s=n.details;this.levelDetails=s,s.advanced&&this.timeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(i,n){n.details===C.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var i=this.media,n=this.levelDetails;if(i&&n){this.currentTime=i.currentTime;var s=this.computeLatency();if(s!==null){this._latency=s;var r=this.config,a=r.lowLatencyMode,o=r.maxLiveSyncPlaybackRate;if(a&&o!==1){var u=this.targetLatency;if(u!==null){var d=s-u,c=d<Math.min(this.maxLatency,u+n.targetduration);if(n.live&&c&&d>.05&&this.forwardBufferLength>1){var v=Math.min(2,Math.max(1,o)),m=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20;i.playbackRate=Math.min(v,Math.max(1,m))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var i=this.levelDetails;return i===null?null:i.edge+i.age},t.computeLatency=function(){var i=this.estimateLiveEdge();return i===null?null:i-this.currentTime},l=h,(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var i=this.config,n=this.levelDetails;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:n?i.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var i=this.levelDetails;if(i===null)return null;var n=i.holdBack,s=i.partHoldBack,r=i.targetduration,a=this.config,o=a.liveSyncDuration,u=a.liveSyncDurationCount,d=a.lowLatencyMode,c=this.hls.userConfig,v=d&&s||n;(c.liveSyncDuration||c.liveSyncDurationCount||v===0)&&(v=o!==void 0?o:u*r);var m=r;return v+Math.min(1*this.stallCount,m)}},{key:"liveSyncPosition",get:function(){var i=this.estimateLiveEdge(),n=this.targetLatency,s=this.levelDetails;if(i===null||n===null||s===null)return null;var r=s.edge,a=i-n-this.edgeStalled,o=r-s.totalduration,u=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,a),u)}},{key:"drift",get:function(){var i=this.levelDetails;return i===null?1:i.drift}},{key:"edgeStalled",get:function(){var i=this.levelDetails;if(i===null)return 0;var n=3*(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.max(i.age-n,0)}},{key:"forwardBufferLength",get:function(){var i=this.media,n=this.levelDetails;if(!i||!n)return 0;var s=i.buffered.length;return(s?i.buffered.end(s-1):n.edge)-this.currentTime}}])&&Ve(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();function $e(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}(function(h){h.No="",h.Yes="YES",h.v2="v2"})(Fe||(Fe={}));var ot=function(){function h(l,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=l,this.part=e,this.skip=t}return h.prototype.addDirectives=function(l){var e=new self.URL(l);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},h}(),rt=function(){function h(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(i){return i}).join(",").replace(/\.[^.,]+/g,"")}var l,e;return l=h,(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var i=t%this.url.length;this._urlId!==i&&(this.details=void 0,this._urlId=i)}}])&&$e(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();function Ze(){return Ze=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Ze.apply(this,arguments)}function ht(h,l,e){switch(l){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(e);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(e)}}function it(h){var l={};h.forEach(function(e){var t=e.groupId||"";e.id=l[t]=l[t]||0,l[t]++})}function lt(h,l){var e=l.startPTS;if((0,F.isFiniteNumber)(e)){var t,i=0;l.sn>h.sn?(i=e-h.start,t=h):(i=h.start-e,t=l),t.duration!==i&&(t.duration=i)}else l.sn>h.sn?h.cc===l.cc&&h.minEndPTS?l.start=h.start+(h.minEndPTS-h.start):l.start=h.start+h.duration:l.start=Math.max(h.start-l.duration,0)}function Et(h,l,e,t,i,n){t-e<=0&&(b.logger.warn("Fragment should have a positive duration",l),t=e+l.duration,n=i+l.duration);var s=e,r=t,a=l.startPTS,o=l.endPTS;if((0,F.isFiniteNumber)(a)){var u=Math.abs(a-e);(0,F.isFiniteNumber)(l.deltaPTS)?l.deltaPTS=Math.max(u,l.deltaPTS):l.deltaPTS=u,s=Math.max(e,a),e=Math.min(e,a),i=Math.min(i,l.startDTS),r=Math.min(t,o),t=Math.max(t,o),n=Math.max(n,l.endDTS)}l.duration=t-e;var d=e-l.start;l.appendedPTS=t,l.start=l.startPTS=e,l.maxStartPTS=s,l.startDTS=i,l.endPTS=t,l.minEndPTS=r,l.endDTS=n;var c,v=l.sn;if(!h||v<h.startSN||v>h.endSN)return 0;var m=v-h.startSN,y=h.fragments;for(y[m]=l,c=m;c>0;c--)lt(y[c],y[c-1]);for(c=m;c<y.length-1;c++)lt(y[c],y[c+1]);return h.fragmentHint&&lt(y[y.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,d}function ft(h,l){var e=l.startSN+l.skippedSegments-h.startSN,t=h.fragments;e<0||e>=t.length||Tt(l,t[e].start)}function Tt(h,l){if(l){for(var e=h.fragments,t=h.skippedSegments;t<e.length;t++)e[t].start+=l;h.fragmentHint&&(h.fragmentHint.start+=l)}}var St=function(){function h(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,t+":"),this.warn=b.logger.warn.bind(b.logger,t+":"),this.hls=e}var l=h.prototype;return l.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},l.onError=function(e,t){t.fatal&&t.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},l.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},l.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},l.stopLoad=function(){this.canLoad=!1,this.clearTimer()},l.switchParams=function(e,t){var i=t==null?void 0:t.renditionReports;if(i)for(var n=0;n<i.length;n++){var s=i[n],r=""+s.URI;if(r===e.slice(-r.length)){var a=parseInt(s["LAST-MSN"]),o=parseInt(s["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var u=Math.min(t.age-t.partTarget,t.targetduration);o!==void 0&&u>t.partTarget&&(o+=1)}if((0,F.isFiniteNumber)(a))return new ot(a,(0,F.isFiniteNumber)(o)?o:void 0,Fe.No)}}},l.loadPlaylist=function(e){},l.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},l.playlistLoaded=function(e,t,i){var n=this,s=t.details,r=t.stats,a=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(s.advancedDateTime=Date.now()-a,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),i&&s.fragments.length>0&&function(re,j){for(var fe=null,ue=re.fragments,Ae=ue.length-1;Ae>=0;Ae--){var _e=ue[Ae].initSegment;if(_e){fe=_e;break}}re.fragmentHint&&delete re.fragmentHint.endPTS;var Be,Xe,Ne,Ge,Qe,at=0;if(function(Ce,Ue,rr){for(var Pt=Ue.skippedSegments,At=Math.max(Ce.startSN,Ue.startSN)-Ue.startSN,ir=(Ce.fragmentHint?1:0)+(Pt?Ue.endSN:Math.min(Ce.endSN,Ue.endSN))-Ue.startSN,kt=Ue.startSN-Ce.startSN,Ft=Ue.fragmentHint?Ue.fragments.concat(Ue.fragmentHint):Ue.fragments,Ht=Ce.fragmentHint?Ce.fragments.concat(Ce.fragmentHint):Ce.fragments,Rt=At;Rt<=ir;Rt++){var nr=Ht[kt+Rt],Xt=Ft[Rt];Pt&&!Xt&&Rt<Pt&&(Xt=Ue.fragments[Rt]=nr),nr&&Xt&&rr(nr,Xt)}}(re,j,function(Ce,Ue){Ce.relurl&&(at=Ce.cc-Ue.cc),(0,F.isFiniteNumber)(Ce.startPTS)&&(0,F.isFiniteNumber)(Ce.endPTS)&&(Ue.start=Ue.startPTS=Ce.startPTS,Ue.startDTS=Ce.startDTS,Ue.appendedPTS=Ce.appendedPTS,Ue.maxStartPTS=Ce.maxStartPTS,Ue.endPTS=Ce.endPTS,Ue.endDTS=Ce.endDTS,Ue.minEndPTS=Ce.minEndPTS,Ue.duration=Ce.endPTS-Ce.startPTS,Ue.duration&&(Be=Ue),j.PTSKnown=j.alignedSliding=!0),Ue.elementaryStreams=Ce.elementaryStreams,Ue.loader=Ce.loader,Ue.stats=Ce.stats,Ue.urlId=Ce.urlId,Ce.initSegment&&(Ue.initSegment=Ce.initSegment,fe=Ce.initSegment)}),fe&&(j.fragmentHint?j.fragments.concat(j.fragmentHint):j.fragments).forEach(function(Ce){var Ue;Ce.initSegment&&Ce.initSegment.relurl!==((Ue=fe)===null||Ue===void 0?void 0:Ue.relurl)||(Ce.initSegment=fe)}),j.skippedSegments)if(j.deltaUpdateFailed=j.fragments.some(function(Ce){return!Ce}),j.deltaUpdateFailed){b.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var vt=j.skippedSegments;vt--;)j.fragments.shift();j.startSN=j.fragments[0].sn,j.startCC=j.fragments[0].cc}else j.canSkipDateRanges&&(j.dateRanges=(Xe=re.dateRanges,Ne=j.dateRanges,Ge=j.recentlyRemovedDateranges,Qe=Ze({},Xe),Ge&&Ge.forEach(function(Ce){delete Qe[Ce]}),Object.keys(Ne).forEach(function(Ce){var Ue=new ie(Ne[Ce].attr,Qe[Ce]);Ue.isValid?Qe[Ce]=Ue:b.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Ne[Ce].attr)+'"')}),Qe));var tt=j.fragments;if(at){b.logger.warn("discontinuity sliding from playlist, take drift into account");for(var st=0;st<tt.length;st++)tt[st].cc+=at}j.skippedSegments&&(j.startCC=j.fragments[0].cc),function(Ce,Ue,rr){if(Ce&&Ue)for(var Pt=0,At=0,ir=Ce.length;At<=ir;At++){var kt=Ce[At],Ft=Ue[At+Pt];kt&&Ft&&kt.index===Ft.index&&kt.fragment.sn===Ft.fragment.sn?(Ht=kt,(Rt=Ft).elementaryStreams=Ht.elementaryStreams,Rt.stats=Ht.stats):Pt--}var Ht,Rt}(re.partList,j.partList),Be?Et(j,Be,Be.startPTS,Be.endPTS,Be.startDTS,Be.endDTS):ft(re,j),tt.length&&(j.totalduration=j.edge-tt[0].start),j.driftStartTime=re.driftStartTime,j.driftStart=re.driftStart;var Dt=j.advancedDateTime;if(j.advanced&&Dt){var tr=j.edge;j.driftStart||(j.driftStartTime=Dt,j.driftStart=tr),j.driftEndTime=Dt,j.driftEnd=tr}else j.driftEndTime=re.driftEndTime,j.driftEnd=re.driftEnd,j.advancedDateTime=re.advancedDateTime}(i,s),!this.canLoad||!s.live)return;var o,u=void 0,d=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var c=this.hls.config.lowLatencyMode,v=s.lastPartSn,m=s.endSN,y=s.lastPartIndex,I=v===m;y!==-1?(u=I?m+1:v,d=I?c?0:y:y+1):u=m+1;var D=s.age,W=D+s.ageHeader,q=Math.min(W-s.partTarget,1.5*s.targetduration);if(q>0){if(i&&q>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+q+" with playlist age: "+s.age),q=0;else{var K=Math.floor(q/s.targetduration);u+=K,d!==void 0&&(d+=Math.round(q%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+D.toFixed(2)+"s goal: "+q+" skip sn "+K+" to part "+d)}s.tuneInGoal=q}if(o=this.getDeliveryDirectives(s,t.deliveryDirectives,u,d),c||!I)return void this.loadPlaylist(o)}else o=this.getDeliveryDirectives(s,t.deliveryDirectives,u,d);var X=function(re,j){var fe,ue=1e3*re.levelTargetDuration,Ae=ue/2,_e=re.age,Be=_e>0&&_e<3*ue,Xe=j.loading.end-j.loading.start,Ne=re.availabilityDelay;if(re.updated===!1)if(Be){var Ge=333*re.misses;fe=Math.max(Math.min(Ae,2*Xe),Ge),re.availabilityDelay=(re.availabilityDelay||0)+fe}else fe=Ae;else Be?(Ne=Math.min(Ne||ue/2,_e),re.availabilityDelay=Ne,fe=Ne+ue-_e):fe=ue-Xe;return Math.round(fe)}(s,r);u!==void 0&&s.canBlockReload&&(X-=s.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(X)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(o)},X)}else this.clearTimer()},l.getDeliveryDirectives=function(e,t,i,n){var s=function(r,a){var o=r.canSkipUntil,u=r.canSkipDateRanges,d=r.endSN;return o&&(a!==void 0?a-d:0)<o?u?Fe.v2:Fe.Yes:Fe.No}(e,i);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,s=Fe.No),new ot(i,n,s)},l.retryLoadingOrFail=function(e){var t,i=this,n=this.hls.config,s=this.retryCount<n.levelLoadingMaxRetry;if(s)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&(t=e.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return i.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return s},h}();function bt(){return bt=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},bt.apply(this,arguments)}function w(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function L(h,l){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(h,l)}var g,T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),E=function(h){var l,e;function t(r){var a;return(a=h.call(this,r,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,L(l,e);var i,n,s=t.prototype;return s._registerListeners=function(){var r=this.hls;r.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(f.Events.ERROR,this.onError,this)},s._unregisterListeners=function(){var r=this.hls;r.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(f.Events.ERROR,this.onError,this)},s.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,h.prototype.destroy.call(this)},s.startLoad=function(){this._levels.forEach(function(r){r.loadError=0}),h.prototype.startLoad.call(this)},s.onManifestLoaded=function(r,a){var o,u,d=[],c=[],v=[],m={},y=!1,I=!1,D=!1;if(a.levels.forEach(function(X){var re=X.attrs;y=y||!(!X.width||!X.height),I=I||!!X.videoCodec,D=D||!!X.audioCodec,T&&X.audioCodec&&X.audioCodec.indexOf("mp4a.40.34")!==-1&&(X.audioCodec=void 0);var j=X.bitrate+"-"+X.attrs.RESOLUTION+"-"+X.attrs.CODECS;(u=m[j])?u.url.push(X.url):(u=new rt(X),m[j]=u,d.push(u)),re&&(re.AUDIO&&ht(u,"audio",re.AUDIO),re.SUBTITLES&&ht(u,"text",re.SUBTITLES))}),(y||I)&&D&&(d=d.filter(function(X){var re=X.videoCodec,j=X.width,fe=X.height;return!!re||!(!j||!fe)})),d=d.filter(function(X){var re=X.audioCodec,j=X.videoCodec;return(!re||P(re,"audio"))&&(!j||P(j,"video"))}),a.audioTracks&&it(c=a.audioTracks.filter(function(X){return!X.audioCodec||P(X.audioCodec,"audio")})),a.subtitles&&it(v=a.subtitles),d.length>0){o=d[0].bitrate,d.sort(function(X,re){return X.bitrate-re.bitrate}),this._levels=d;for(var W=0;W<d.length;W++)if(d[W].bitrate===o){this._firstLevel=W,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+o);break}var q=D&&!I,K={levels:d,audioTracks:c,subtitleTracks:v,firstLevel:this._firstLevel,stats:a.stats,audio:D,video:I,altAudio:!q&&c.some(function(X){return!!X.url})};this.hls.trigger(f.Events.MANIFEST_PARSED,K),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},s.onError=function(r,a){var o;if(h.prototype.onError.call(this,r,a),!a.fatal){var u=a.context,d=this._levels[this.currentLevelIndex];if(u&&(u.type===_.PlaylistContextType.AUDIO_TRACK&&d.audioGroupIds&&u.groupId===d.audioGroupIds[d.urlId]||u.type===_.PlaylistContextType.SUBTITLE_TRACK&&d.textGroupIds&&u.groupId===d.textGroupIds[d.urlId]))this.redundantFailover(this.currentLevelIndex);else{var c,v=!1,m=!0;switch(a.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:case C.ErrorDetails.KEY_LOAD_ERROR:case C.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var y=a.frag.type===_.PlaylistLevelType.MAIN?a.frag.level:this.currentLevelIndex,I=this._levels[y];I?(I.fragmentError++,I.fragmentError>this.hls.config.fragLoadingMaxRetry&&(c=y)):c=y}break;case C.ErrorDetails.LEVEL_LOAD_ERROR:case C.ErrorDetails.LEVEL_LOAD_TIMEOUT:u&&(u.deliveryDirectives&&(m=!1),c=u.level),v=!0;break;case C.ErrorDetails.REMUX_ALLOC_ERROR:c=(o=a.level)!=null?o:this.currentLevelIndex,v=!0}c!==void 0&&this.recoverLevel(a,c,v,m)}}},s.recoverLevel=function(r,a,o,u){var d=r.details,c=this._levels[a];if(c.loadError++,o){if(!this.retryLoadingOrFail(r))return void(this.currentLevelIndex=-1);r.levelRetry=!0}if(u){var v=c.url.length;if(v>1&&c.loadError<v)r.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){for(var m=-1,y=this._levels,I=y.length;I--;){var D=(I+this.currentLevelIndex)%y.length;if(D!==this.currentLevelIndex&&y[D].loadError===0){m=D;break}}m>-1&&this.currentLevelIndex!==m&&(this.warn(d+": switch to "+m),r.levelRetry=!0,this.hls.nextAutoLevel=m)}}},s.redundantFailover=function(r){var a=this._levels[r],o=a.url.length;if(o>1){var u=(a.urlId+1)%o;this.warn("Switching to redundant URL-id "+u),this._levels.forEach(function(d){d.urlId=u}),this.level=r}},s.onFragLoaded=function(r,a){var o=a.frag;if(o!==void 0&&o.type===_.PlaylistLevelType.MAIN){var u=this._levels[o.level];u!==void 0&&(u.fragmentError=0,u.loadError=0)}},s.onLevelLoaded=function(r,a){var o,u,d=a.level,c=a.details,v=this._levels[d];if(!v)return this.warn("Invalid level index "+d),void((u=a.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(c.deltaUpdateFailed=!0));d===this.currentLevelIndex?(v.fragmentError===0&&(v.loadError=0,this.retryCount=0),this.playlistLoaded(d,a,v.details)):(o=a.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(c.deltaUpdateFailed=!0)},s.onAudioTrackSwitched=function(r,a){var o=this.hls.levels[this.currentLevelIndex];if(o&&o.audioGroupIds){for(var u=-1,d=this.hls.audioTracks[a.id].groupId,c=0;c<o.audioGroupIds.length;c++)if(o.audioGroupIds[c]===d){u=c;break}u!==o.urlId&&(o.urlId=u,this.startLoad())}},s.loadPlaylist=function(r){var a=this.currentLevelIndex,o=this._levels[a];if(this.canLoad&&o&&o.url.length>0){var u=o.urlId,d=o.url[u];if(r)try{d=r.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Attempt loading level index "+a+(r?" at sn "+r.msn+" part "+r.part:"")+" with URL-id "+u+" "+d),this.clearTimer(),this.hls.trigger(f.Events.LEVEL_LOADING,{url:d,level:a,id:u,deliveryDirectives:r||null})}},s.removeLevel=function(r,a){var o=function(d,c){return c!==a},u=this._levels.filter(function(d,c){return c!==r||d.url.length>1&&a!==void 0&&(d.url=d.url.filter(o),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(o)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(o)),d.urlId=0,!0)}).map(function(d,c){var v=d.details;return v!=null&&v.fragments&&v.fragments.forEach(function(m){m.level=c}),d});this._levels=u,this.hls.trigger(f.Events.LEVELS_UPDATED,{levels:u})},i=t,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(r){var a,o=this._levels;if(o.length!==0&&(this.currentLevelIndex!==r||(a=o[r])===null||a===void 0||!a.details)){if(r<0||r>=o.length){var u=r<0;if(this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.LEVEL_SWITCH_ERROR,level:r,fatal:u,reason:"invalid level idx"}),u)return;r=Math.min(r,o.length-1)}this.clearTimer();var d=this.currentLevelIndex,c=o[d],v=o[r];this.log("switching to level "+r+" from "+d),this.currentLevelIndex=r;var m=bt({},v,{level:r,maxBitrate:v.maxBitrate,uri:v.uri,urlId:v.urlId});delete m._urlId,this.hls.trigger(f.Events.LEVEL_SWITCHING,m);var y=v.details;if(!y||y.live){var I=this.switchParams(v.uri,c==null?void 0:c.details);this.loadPlaylist(I)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(r){this._firstLevel=r}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var r=this.hls.config.startLevel;return r!==void 0?r:this._firstLevel}return this._startLevel},set:function(r){this._startLevel=r}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}}])&&w(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(St);(function(h){h.NOT_LOADED="NOT_LOADED",h.APPENDING="APPENDING",h.PARTIAL="PARTIAL",h.OK="OK"})(g||(g={}));var R=function(){function h(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var l=h.prototype;return l._registerListeners=function(){var e=this.hls;e.on(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(f.Events.FRAG_LOADED,this.onFragLoaded,this)},l._unregisterListeners=function(){var e=this.hls;e.off(f.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(f.Events.FRAG_LOADED,this.onFragLoaded,this)},l.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},l.getAppendedFrag=function(e,t){if(t===_.PlaylistLevelType.MAIN){var i=this.activeFragment,n=this.activeParts;if(!i)return null;if(n)for(var s=n.length;s--;){var r=n[s],a=r?r.end:i.appendedPTS;if(r.start<=e&&a!==void 0&&e<=a)return s>9&&(this.activeParts=n.slice(s-9)),r}else if(i.start<=e&&i.appendedPTS!==void 0&&e<=i.appendedPTS)return i}return this.getBufferedFrag(e,t)},l.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),s=n.length;s--;){var r=i[n[s]];if((r==null?void 0:r.body.type)===t&&r.buffered){var a=r.body;if(a.start<=e&&e<=a.end)return a}}return null},l.detectEvictedFragments=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r)if(r.buffered){var a=r.range[e];a&&a.time.some(function(o){var u=!n.isTimeBuffered(o.startPTS,o.endPTS,t);return u&&n.removeFragment(r.body),u})}else r.body.type===i&&n.removeFragment(r.body)})},l.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,s=e.part;if(i&&n.sn!=="initSegment"){var r=x(n),a=this.fragments[r];a&&(Object.keys(i).forEach(function(o){var u=n.elementaryStreams[o];if(u){var d=i[o],c=s!==null||u.partial===!0;a.range[o]=t.getBufferedTimes(n,s,c,d)}}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},l.fragBuffered=function(e){var t=x(e),i=this.fragments[t];i&&(i.loaded=null,i.buffered=!0)},l.getBufferedTimes=function(e,t,i,n){for(var s={time:[],partial:i},r=t?t.start:e.start,a=t?t.end:e.end,o=e.minEndPTS||a,u=e.maxStartPTS||r,d=0;d<n.length;d++){var c=n.start(d)-this.bufferPadding,v=n.end(d)+this.bufferPadding;if(u>=c&&o<=v){s.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(a,n.end(d))});break}if(r<v&&a>c)s.partial=!0,s.time.push({startPTS:Math.max(r,n.start(d)),endPTS:Math.min(a,n.end(d))});else if(a<=c)break}return s},l.getPartialFragment=function(e){var t,i,n,s=null,r=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(u){var d=o[u];d&&O(d)&&(i=d.body.start-a,n=d.body.end+a,e>=i&&e<=n&&(t=Math.min(e-i,n-e),r<=t&&(s=d.body,r=t)))}),s},l.getState=function(e){var t=x(e),i=this.fragments[t];return i?i.buffered?O(i)?g.PARTIAL:g.OK:g.APPENDING:g.NOT_LOADED},l.isTimeBuffered=function(e,t,i){for(var n,s,r=0;r<i.length;r++){if(n=i.start(r)-this.bufferPadding,s=i.end(r)+this.bufferPadding,e>=n&&t<=s)return!0;if(t<=n)return!1}return!1},l.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if(i.sn!=="initSegment"&&!i.bitrateTest&&!n){var s=x(i);this.fragments[s]={body:i,loaded:t,buffered:!1,range:Object.create(null)}}},l.onBufferAppended=function(e,t){var i=this,n=t.frag,s=t.part,r=t.timeRanges;if(n.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=n,s){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(s)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(o){var u=r[o];if(i.detectEvictedFragments(o,u),!s)for(var d=0;d<u.length;d++)n.appendedPTS=Math.max(u.end(d),n.appendedPTS||0)})},l.onFragBuffered=function(e,t){this.detectPartialFragments(t)},l.hasFragment=function(e){var t=x(e);return!!this.fragments[t]},l.removeFragmentsInRange=function(e,t,i){var n=this;Object.keys(this.fragments).forEach(function(s){var r=n.fragments[s];if(r&&r.buffered){var a=r.body;a.type===i&&a.start<t&&a.end>e&&n.removeFragment(a)}})},l.removeFragment=function(e){var t=x(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},l.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},h}();function O(h){var l,e;return h.buffered&&(((l=h.range.video)===null||l===void 0?void 0:l.partial)||((e=h.range.audio)===null||e===void 0?void 0:e.partial))}function x(h){return h.type+"_"+h.level+"_"+h.urlId+"_"+h.sn}var Y=function(){function h(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var l=h.prototype;return l.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},l.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},l.onHandlerDestroyed=function(){},l.hasInterval=function(){return!!this._tickInterval},l.hasNextTick=function(){return!!this._tickTimer},l.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},l.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},l.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},l.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},l.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},l.doTick=function(){},h}(),ae={length:0,start:function(){return 0},end:function(){return 0}},z=function(){function h(){}return h.isBuffered=function(l,e){try{if(l){for(var t=h.getBuffered(l),i=0;i<t.length;i++)if(e>=t.start(i)&&e<=t.end(i))return!0}}catch{}return!1},h.bufferInfo=function(l,e,t){try{if(l){var i,n=h.getBuffered(l),s=[];for(i=0;i<n.length;i++)s.push({start:n.start(i),end:n.end(i)});return this.bufferedInfo(s,e,t)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},h.bufferedInfo=function(l,e,t){e=Math.max(0,e),l.sort(function(y,I){return y.start-I.start||I.end-y.end});var i=[];if(t)for(var n=0;n<l.length;n++){var s=i.length;if(s){var r=i[s-1].end;l[n].start-r<t?l[n].end>r&&(i[s-1].end=l[n].end):i.push(l[n])}else i.push(l[n])}else i=l;for(var a,o=0,u=e,d=e,c=0;c<i.length;c++){var v=i[c].start,m=i[c].end;if(e+t>=v&&e<m)u=v,o=(d=m)-e;else if(e+t<v){a=v;break}}return{len:o,start:u||0,end:d||0,nextStart:a}},h.getBuffered=function(l){try{return l.buffered}catch(e){return b.logger.log("failed to get media.buffered",e),ae}},h}(),de=function(h,l,e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=h,this.sn=l,this.id=e,this.size=t,this.part=i,this.partial=n};function Se(h,l){for(var e=null,t=0,i=h.length;t<i;t++){var n=h[t];if(n&&n.cc===l){e=n;break}}return e}function ye(h,l){if(h){var e=h.start+l;h.start=h.startPTS=e,h.endPTS=e+h.duration}}function be(h,l){for(var e=l.fragments,t=0,i=e.length;t<i;t++)ye(e[t],h);l.fragmentHint&&ye(l.fragmentHint,h),l.alignedSliding=!0}function Oe(h,l){if(h.hasProgramDateTime&&l.hasProgramDateTime){var e=h.fragments,t=l.fragments;if(e.length&&t.length){var i=t[Math.round(t.length/2)-1],n=Se(e,i.cc)||e[Math.round(e.length/2)-1],s=i.programDateTime,r=n.programDateTime;s!==null&&r!==null&&be((r-s)/1e3-(n.start-i.start),h)}}}const He=function(h,l){for(var e=0,t=h.length-1,i=null,n=null;e<=t;){var s=l(n=h[i=(e+t)/2|0]);if(s>0)e=i+1;else{if(!(s<0))return n;t=i-1}}return null};function Le(h,l,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var i=null;return h?i=l[h.sn-l[0].sn+1]||null:e===0&&l[0].start===0&&(i=l[0]),i&&ze(e,t,i)===0?i:He(l,ze.bind(null,e,t))||i}function ze(h,l,e){h===void 0&&(h=0),l===void 0&&(l=0);var t=Math.min(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=h?1:e.start-t>h&&e.start?-1:0}function dt(h,l,e){var t=1e3*Math.min(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>h}function nt(h){var l=typeof Map=="function"?new Map:void 0;return nt=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,i)}function i(){return et(e,arguments,ct(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),xe(i,e)},nt(h)}function et(h,l,e){return et=gt()?Reflect.construct.bind():function(t,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(t,s));return n&&xe(r,n.prototype),r},et.apply(null,arguments)}function gt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xe(h,l){return xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xe(h,l)}function ct(h){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},ct(h)}var Ct=Math.pow(2,17),ut=function(){function h(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var l=h.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(e,t){var i=this,n=e.url;if(!n)return Promise.reject(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(o,u){i.loader&&i.loader.destroy();var d=i.loader=e.loader=r?new r(s):new a(s),c=Lt(e),v={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:e.sn==="initSegment"?1/0:Ct};e.stats=d.stats,d.load(c,v,{onSuccess:function(m,y,I,D){i.resetLoader(e,d),o({frag:e,part:null,payload:m.data,networkDetails:D})},onError:function(m,y,I){i.resetLoader(e,d),u(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:m,networkDetails:I}))},onAbort:function(m,y,I){i.resetLoader(e,d),u(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:I}))},onTimeout:function(m,y,I){i.resetLoader(e,d),u(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:I}))},onProgress:function(m,y,I,D){t&&t({frag:e,part:null,payload:I,networkDetails:D})}})})},l.loadPart=function(e,t,i){var n=this;this.abort();var s=this.config,r=s.fLoader,a=s.loader;return new Promise(function(o,u){n.loader&&n.loader.destroy();var d=n.loader=e.loader=r?new r(s):new a(s),c=Lt(e,t),v={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:Ct};t.stats=d.stats,d.load(c,v,{onSuccess:function(m,y,I,D){n.resetLoader(e,d),n.updateStatsFromPart(e,t);var W={frag:e,part:t,payload:m.data,networkDetails:D};i(W),o(W)},onError:function(m,y,I){n.resetLoader(e,d),u(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:m,networkDetails:I}))},onAbort:function(m,y,I){e.stats.aborted=t.stats.aborted,n.resetLoader(e,d),u(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:I}))},onTimeout:function(m,y,I){n.resetLoader(e,d),u(new pt({type:C.ErrorTypes.NETWORK_ERROR,details:C.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:I}))}})})},l.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,s=n.total;if(i.loaded+=n.loaded,s){var r=Math.round(e.duration/t.duration),a=Math.min(Math.round(i.loaded/s),r),o=(r-a)*Math.round(i.loaded/a);i.total=i.loaded+o}else i.total=Math.max(i.loaded,i.total);var u=i.loading,d=n.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},l.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},h}();function Lt(h,l){l===void 0&&(l=null);var e=l||h,t={frag:h,part:l,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return(0,F.isFiniteNumber)(i)&&(0,F.isFiniteNumber)(n)&&(t.rangeStart=i,t.rangeEnd=n),t}var pt=function(h){var l,e;function t(i){for(var n,s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return(n=h.call.apply(h,[this].concat(r))||this).data=void 0,n.data=i,n}return e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,xe(l,e),t}(nt(Error)),Ut=H(21);const It=function(h){for(var l="",e=h.length,t=0;t<e;t++)l+="["+h.start(t).toFixed(3)+","+h.end(t).toFixed(3)+"]";return l};function lr(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function $r(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function Tr(h,l){return Tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tr(h,l)}var wt="STOPPED",qe="IDLE",Sr="KEY_LOADING",jt="FRAG_LOADING",Vt="FRAG_LOADING_WAITING_RETRY",ur="WAITING_TRACK",Ot="PARSING",Jt="PARSED",hr="ENDED",Bt="ERROR",Zt="WAITING_INIT_PTS",Wt="WAITING_LEVEL",br=function(h){var l,e;function t(r,a,o){var u;return(u=h.call(this)||this).hls=void 0,u.fragPrevious=null,u.fragCurrent=null,u.fragmentTracker=void 0,u.transmuxer=null,u._state=wt,u.media=null,u.mediaBuffer=null,u.config=void 0,u.bitrateTest=!1,u.lastCurrentTime=0,u.nextLoadPosition=0,u.startPosition=0,u.loadedmetadata=!1,u.fragLoadError=0,u.retryDate=0,u.levels=null,u.fragmentLoader=void 0,u.levelLastLoaded=null,u.startFragRequested=!1,u.decrypter=void 0,u.initPTS=[],u.onvseeking=null,u.onvended=null,u.logPrefix="",u.log=void 0,u.warn=void 0,u.logPrefix=o,u.log=b.logger.log.bind(b.logger,o+":"),u.warn=b.logger.warn.bind(b.logger,o+":"),u.hls=r,u.fragmentLoader=new ut(r.config),u.fragmentTracker=a,u.config=r.config,u.decrypter=new Ut.default(r,r.config),r.on(f.Events.KEY_LOADED,u.onKeyLoaded,$r(u)),r.on(f.Events.LEVEL_SWITCHING,u.onLevelSwitching,$r(u)),u}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Tr(l,e);var i,n,s=t.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(r){},s.stopLoad=function(){this.fragmentLoader.abort();var r=this.fragCurrent;r&&this.fragmentTracker.removeFragment(r),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=wt},s._streamEnded=function(r,a){var o=this.fragCurrent,u=this.fragmentTracker;if(!a.live&&o&&this.media&&o.sn>=a.endSN&&!r.nextStart){var d=a.partList;if(d!=null&&d.length){var c=d[d.length-1];return z.isBuffered(this.media,c.start+c.duration/2)}var v=u.getState(o);return v===g.PARTIAL||v===g.OK}return!1},s.onMediaAttached=function(r,a){var o=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),o.addEventListener("seeking",this.onvseeking),o.addEventListener("ended",this.onvended);var u=this.config;this.levels&&u.autoStartLoad&&this.state===wt&&this.startLoad(u.startPosition)},s.onMediaDetaching=function(){var r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var r=this.config,a=this.fragCurrent,o=this.media,u=this.mediaBuffer,d=this.state,c=o?o.currentTime:0,v=z.bufferInfo(u||o,c,r.maxBufferHole);if(this.log("media seeking to "+((0,F.isFiniteNumber)(c)?c.toFixed(3):c)+", state: "+d),d===hr)this.resetLoadingState();else if(a){var m=r.maxFragLookUpTolerance,y=a.start-m,I=a.start+a.duration+m;if(!v.len||I<v.start||y>v.end){var D=c>I;(c<y||D)&&(D&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.resetLoadingState())}}o&&(this.lastCurrentTime=c),this.loadedmetadata||v.len||(this.nextLoadPosition=this.startPosition=c),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onKeyLoaded=function(r,a){if(this.state===Sr&&a.frag===this.fragCurrent&&this.levels){this.state=qe;var o=this.levels[a.frag.level].details;o&&this.loadFragment(a.frag,o,a.frag.start)}},s.onLevelSwitching=function(r,a){this.fragLoadError=0},s.onHandlerDestroying=function(){this.stopLoad(),h.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=wt,this.hls.off(f.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,h.prototype.onHandlerDestroyed.call(this)},s.loadKey=function(r,a){this.log("Loading key for "+r.sn+" of ["+a.startSN+"-"+a.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level),this.state=Sr,this.fragCurrent=r,this.hls.trigger(f.Events.KEY_LOADING,{frag:r})},s.loadFragment=function(r,a,o){this._loadFragForPlayback(r,a,o)},s._loadFragForPlayback=function(r,a,o){var u=this;this._doFragLoad(r,a,o,function(d){if(u.fragContextChanged(r))return u.warn("Fragment "+r.sn+(d.part?" p: "+d.part.index:"")+" of level "+r.level+" was dropped during download."),void u.fragmentTracker.removeFragment(r);r.stats.chunkCount++,u._handleFragmentLoadProgress(d)}).then(function(d){if(d){u.fragLoadError=0;var c=u.state;u.fragContextChanged(r)?(c===jt||!u.fragCurrent&&c===Ot)&&(u.fragmentTracker.removeFragment(r),u.state=qe):("payload"in d&&(u.log("Loaded fragment "+r.sn+" of level "+r.level),u.hls.trigger(f.Events.FRAG_LOADED,d)),u._handleFragmentLoadComplete(d))}}).catch(function(d){u.state!==wt&&u.state!==Bt&&(u.warn(d),u.resetFragmentLoading(r))})},s.flushMainBuffer=function(r,a,o){if(o===void 0&&(o=null),r-a){var u={startOffset:r,endOffset:a,type:o};this.fragLoadError=0,this.hls.trigger(f.Events.BUFFER_FLUSHING,u)}},s._loadInitSegment=function(r){var a=this;this._doFragLoad(r).then(function(o){if(!o||a.fragContextChanged(r)||!a.levels)throw new Error("init load aborted");return o}).then(function(o){var u=a.hls,d=o.payload,c=r.decryptdata;if(d&&d.byteLength>0&&c&&c.key&&c.iv&&c.method==="AES-128"){var v=self.performance.now();return a.decrypter.webCryptoDecrypt(new Uint8Array(d),c.key.buffer,c.iv.buffer).then(function(m){var y=self.performance.now();return u.trigger(f.Events.FRAG_DECRYPTED,{frag:r,payload:m,stats:{tstart:v,tdecrypt:y}}),o.payload=m,o})}return o}).then(function(o){var u=a.fragCurrent,d=a.hls,c=a.levels;if(!c)throw new Error("init load aborted, missing levels");c[r.level].details;var v=r.stats;a.state=qe,a.fragLoadError=0,r.data=new Uint8Array(o.payload),v.parsing.start=v.buffering.start=self.performance.now(),v.parsing.end=v.buffering.end=self.performance.now(),o.frag===u&&d.trigger(f.Events.FRAG_BUFFERED,{stats:v,frag:u,part:null,id:r.type}),a.tick()}).catch(function(o){a.state!==wt&&a.state!==Bt&&(a.warn(o),a.resetFragmentLoading(r))})},s.fragContextChanged=function(r){var a=this.fragCurrent;return!r||!a||r.level!==a.level||r.sn!==a.sn||r.urlId!==a.urlId},s.fragBufferedComplete=function(r,a){var o,u,d=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+r.type+" sn: "+r.sn+(a?" part: "+a.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+r.level+" "+(d?It(z.getBuffered(d)):"(detached)")),this.state=qe,d&&(!this.loadedmetadata&&r.type==_.PlaylistLevelType.MAIN&&d.buffered.length&&((o=this.fragCurrent)===null||o===void 0?void 0:o.sn)===((u=this.fragPrevious)===null||u===void 0?void 0:u.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},s.seekToStartPos=function(){},s._handleFragmentLoadComplete=function(r){var a=this.transmuxer;if(a){var o=r.frag,u=r.part,d=r.partsLoaded,c=!d||d.length===0||d.some(function(m){return!m}),v=new de(o.level,o.sn,o.stats.chunkCount+1,0,u?u.index:-1,!c);a.flush(v)}},s._handleFragmentLoadProgress=function(r){},s._doFragLoad=function(r,a,o,u){var d=this;if(o===void 0&&(o=null),!this.levels)throw new Error("frag load aborted, missing levels");if(o=Math.max(r.start,o||0),this.config.lowLatencyMode&&a){var c=a.partList;if(c&&u){o>r.end&&a.fragmentHint&&(r=a.fragmentHint);var v=this.getNextPart(c,r,o);if(v>-1){var m=c[v];return this.log("Loading part sn: "+r.sn+" p: "+m.index+" cc: "+r.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+v+"-"+(c.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(o.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=jt,this.hls.trigger(f.Events.FRAG_LOADING,{frag:r,part:c[v],targetBufferTime:o}),this.doFragPartsLoad(r,c,v,u).catch(function(y){return d.handleFragLoadError(y)})}if(!r.url||this.loadedEndOfParts(c,o))return Promise.resolve(null)}}return this.log("Loading fragment "+r.sn+" cc: "+r.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+r.level+", target: "+parseFloat(o.toFixed(3))),(0,F.isFiniteNumber)(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=jt,this.hls.trigger(f.Events.FRAG_LOADING,{frag:r,targetBufferTime:o}),this.fragmentLoader.load(r,u).catch(function(y){return d.handleFragLoadError(y)})},s.doFragPartsLoad=function(r,a,o,u){var d=this;return new Promise(function(c,v){var m=[];(function y(I){var D=a[I];d.fragmentLoader.loadPart(r,D,u).then(function(W){m[D.index]=W;var q=W.part;d.hls.trigger(f.Events.FRAG_LOADED,W);var K=a[I+1];if(!K||K.fragment!==r)return c({frag:r,part:q,partsLoaded:m});y(I+1)}).catch(v)})(o)})},s.handleFragLoadError=function(r){var a=r.data;return a&&a.details===C.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(f.Events.ERROR,a),null},s._handleTransmuxerFlush=function(r){var a=this.getCurrentContext(r);if(a&&this.state===Ot){var o=a.frag,u=a.part,d=a.level,c=self.performance.now();o.stats.parsing.end=c,u&&(u.stats.parsing.end=c),this.updateLevelTiming(o,u,d,r.partial)}else this.fragCurrent||(this.state=qe)},s.getCurrentContext=function(r){var a=this.levels,o=r.level,u=r.sn,d=r.part;if(!a||!a[o])return this.warn("Levels object was unset while buffering fragment "+u+" of level "+o+". The current chunk will not be buffered."),null;var c=a[o],v=d>-1?function(y,I,D){if(!y||!y.details)return null;var W=y.details.partList;if(W)for(var q=W.length;q--;){var K=W[q];if(K.index===D&&K.fragment.sn===I)return K}return null}(c,u,d):null,m=v?v.fragment:function(y,I,D){if(!y||!y.details)return null;var W=y.details,q=W.fragments[I-W.startSN];return q||((q=W.fragmentHint)&&q.sn===I?q:I<W.startSN&&D&&D.sn===I?D:null)}(c,u,this.fragCurrent);return m?{frag:m,part:v,level:c}:null},s.bufferFragmentData=function(r,a,o,u){if(r&&this.state===Ot){var d=r.data1,c=r.data2,v=d;if(d&&c&&(v=(0,Q.appendUint8Array)(d,c)),v&&v.length){var m={type:r.type,frag:a,part:o,chunkMeta:u,parent:a.type,data:v};this.hls.trigger(f.Events.BUFFER_APPENDING,m),r.dropped&&r.independent&&!o&&this.flushBufferGap(a)}}},s.flushBufferGap=function(r){var a=this.media;if(a)if(z.isBuffered(a,a.currentTime)){var o=a.currentTime,u=z.bufferInfo(a,o,0),d=r.duration,c=Math.min(2*this.config.maxFragLookUpTolerance,.25*d),v=Math.max(Math.min(r.start-c,u.end-c),o+c);r.start-v>c&&this.flushMainBuffer(v,r.start)}else this.flushMainBuffer(0,r.start)},s.getFwdBufferInfo=function(r,a){var o=this.config,u=this.getLoadPosition();if(!(0,F.isFiniteNumber)(u))return null;var d=z.bufferInfo(r,u,o.maxBufferHole);if(d.len===0&&d.nextStart!==void 0){var c=this.fragmentTracker.getBufferedFrag(u,a);if(c&&d.nextStart<c.end)return z.bufferInfo(r,u,Math.max(d.nextStart,o.maxBufferHole))}return d},s.getMaxBufferLength=function(r){var a,o=this.config;return a=r?Math.max(8*o.maxBufferSize/r,o.maxBufferLength):o.maxBufferLength,Math.min(a,o.maxMaxBufferLength)},s.reduceMaxBufferLength=function(r){var a=this.config,o=r||a.maxBufferLength;return a.maxMaxBufferLength>=o&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},s.getNextFragment=function(r,a){var o=a.fragments,u=o.length;if(!u)return null;var d,c=this.config,v=o[0].start;if(a.live){var m=c.initialLiveManifestSize;if(u<m)return this.warn("Not enough fragments to start playback (have: "+u+", need: "+m+")"),null;a.PTSKnown||this.startFragRequested||this.startPosition!==-1||(d=this.getInitialLiveFragment(a,o),this.startPosition=d?this.hls.liveSyncPosition||d.start:r)}else r<=v&&(d=o[0]);if(!d){var y=c.lowLatencyMode?a.partEnd:a.fragmentEnd;d=this.getFragmentAtPosition(r,y,a)}return this.mapToInitFragWhenRequired(d)},s.mapToInitFragWhenRequired=function(r){return r==null||!r.initSegment||r!=null&&r.initSegment.data||this.bitrateTest?r:r.initSegment},s.getNextPart=function(r,a,o){for(var u=-1,d=!1,c=!0,v=0,m=r.length;v<m;v++){var y=r[v];if(c=c&&!y.independent,u>-1&&o<y.start)break;var I=y.loaded;!I&&(d||y.independent||c)&&y.fragment===a&&(u=v),d=I}return u},s.loadedEndOfParts=function(r,a){var o=r[r.length-1];return o&&a>o.start&&o.loaded},s.getInitialLiveFragment=function(r,a){var o=this.fragPrevious,u=null;if(o){if(r.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+o.programDateTime),u=function(m,y,I){if(y===null||!Array.isArray(m)||!m.length||!(0,F.isFiniteNumber)(y)||y<(m[0].programDateTime||0)||y>=(m[m.length-1].endProgramDateTime||0))return null;I=I||0;for(var D=0;D<m.length;++D){var W=m[D];if(dt(y,I,W))return W}return null}(a,o.endProgramDateTime,this.config.maxFragLookUpTolerance)),!u){var d=o.sn+1;if(d>=r.startSN&&d<=r.endSN){var c=a[d-r.startSN];o.cc===c.cc&&(u=c,this.log("Live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=function(m,y){return He(m,function(I){return I.cc<y?1:I.cc>y?-1:0})}(a,o.cc),u&&this.log("Live playlist, switching playlist, load frag with same CC: "+u.sn))}}else{var v=this.hls.liveSyncPosition;v!==null&&(u=this.getFragmentAtPosition(v,this.bitrateTest?r.fragmentEnd:r.edge,r))}return u},s.getFragmentAtPosition=function(r,a,o){var u,d=this.config,c=this.fragPrevious,v=o.fragments,m=o.endSN,y=o.fragmentHint,I=d.maxFragLookUpTolerance,D=!!(d.lowLatencyMode&&o.partList&&y);if(D&&y&&!this.bitrateTest&&(v=v.concat(y),m=y.sn),u=r<a?Le(c,v,r,r>a-I?0:I):v[v.length-1]){var W=u.sn-o.startSN;if(this.fragmentTracker.getState(u)===g.OK&&(c=u),c&&u.sn===c.sn&&!D&&c&&u.level===c.level){var q=v[W+1];u.sn<m&&this.fragmentTracker.getState(q)!==g.OK?(this.log("SN "+u.sn+" just loaded, load next one: "+q.sn),u=q):u=null}}return u},s.synchronizeToLiveEdge=function(r){var a=this.config,o=this.media;if(o){var u=this.hls.liveSyncPosition,d=o.currentTime,c=r.fragments[0].start,v=r.edge,m=d>=c-a.maxFragLookUpTolerance&&d<=v;if(u!==null&&o.duration>u&&(d<u||!m)){var y=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*r.targetduration;(!m&&o.readyState<4||d<v-y)&&(this.loadedmetadata||(this.nextLoadPosition=u),o.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+v+", reset currentTime to : "+u.toFixed(3)),o.currentTime=u))}}},s.alignPlaylists=function(r,a){var o=this.levels,u=this.levelLastLoaded,d=this.fragPrevious,c=u!==null?o[u]:null,v=r.fragments.length;if(!v)return this.warn("No fragments in live playlist"),0;var m=r.fragments[0].start,y=!a,I=r.alignedSliding&&(0,F.isFiniteNumber)(m);if(y||!I&&!m){(function(W,q,K){q&&(function(X,re,j){if(function(ue,Ae,_e){return!(!Ae.details||!(_e.endCC>_e.startCC||ue&&ue.cc<_e.startCC))}(X,j,re)){var fe=function(ue,Ae,_e){var Be=ue.fragments,Xe=Ae.fragments;if(Xe.length&&Be.length){var Ne=Se(Be,Xe[0].cc);if(Ne&&(!Ne||Ne.startPTS))return Ne;b.logger.log("No frag in previous level to align on")}else b.logger.log("No fragments to align")}(j.details,re);fe&&(0,F.isFiniteNumber)(fe.start)&&(b.logger.log("Adjusting PTS using last level due to CC increase within current level "+re.url),be(fe.start,re))}}(W,K,q),!K.alignedSliding&&q.details&&function(X,re){if(re.fragments.length&&X.hasProgramDateTime&&re.hasProgramDateTime){var j=re.fragments[0].programDateTime,fe=X.fragments[0].programDateTime,ue=(fe-j)/1e3+re.fragments[0].start;ue&&(0,F.isFiniteNumber)(ue)&&(b.logger.log("Adjusting PTS using programDateTime delta "+(fe-j)+"ms, sliding:"+ue.toFixed(3)+" "+X.url+" "),be(ue,X))}}(K,q.details),K.alignedSliding||!q.details||K.skippedSegments||ft(q.details,K))})(d,c,r);var D=r.fragments[0].start;return this.log("Live playlist sliding: "+D.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+r.startSN+" prev-sn: "+(d?d.sn:"na")+" fragments: "+v),D}return m},s.waitForCdnTuneIn=function(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,3*r.partTarget)},s.setStartPosition=function(r,a){var o=this.startPosition;if(o<a&&(o=-1),o===-1||this.lastCurrentTime===-1){var u=r.startTimeOffset;(0,F.isFiniteNumber)(u)?(o=a+u,u<0&&(o+=r.totalduration),o=Math.min(Math.max(a,o),a+r.totalduration),this.log("Start time offset "+u+" found in playlist, adjust startPosition to "+o),this.startPosition=o):r.live?o=this.hls.liveSyncPosition||a:this.startPosition=o=0,this.lastCurrentTime=o}this.nextLoadPosition=o},s.getLoadPosition=function(){var r=this.media,a=0;return this.loadedmetadata&&r?a=r.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},s.handleFragLoadAborted=function(r,a){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn("Fragment "+r.sn+(a?" part"+a.index:"")+" of level "+r.level+" was aborted"),this.resetFragmentLoading(r))},s.resetFragmentLoading=function(r){this.fragCurrent&&(this.fragContextChanged(r)||this.state===Vt)||(this.state=qe)},s.onFragmentOrKeyLoadError=function(r,a){if(!a.fatal){var o=a.frag;if(o&&o.type===r){this.fragCurrent;var u=this.config;if(this.fragLoadError+1<=u.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var d=Math.min(Math.pow(2,this.fragLoadError)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout);this.warn("Fragment "+o.sn+" of "+r+" "+o.level+" failed to load, retrying in "+d+"ms"),this.retryDate=self.performance.now()+d,this.fragLoadError++,this.state=Vt}else a.levelRetry?(r===_.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=qe):(b.logger.error(a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.stopLoad(),this.state=Bt)}}},s.afterBufferFlushed=function(r,a,o){if(r){var u=z.getBuffered(r);this.fragmentTracker.detectEvictedFragments(a,u,o),this.state===hr&&this.resetLoadingState()}},s.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=qe},s.resetStartWhenNotLoaded=function(r){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[r].details:null;a!=null&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},s.updateLevelTiming=function(r,a,o,u){var d=this,c=o.details;Object.keys(r.elementaryStreams).reduce(function(v,m){var y=r.elementaryStreams[m];if(y){var I=y.endPTS-y.startPTS;if(I<=0)return d.warn("Could not parse fragment "+r.sn+" "+m+" duration reliably ("+I+")"),v||!1;var D=u?0:Et(c,r,y.startPTS,y.endPTS,y.startDTS,y.endDTS);return d.hls.trigger(f.Events.LEVEL_PTS_UPDATED,{details:c,level:o,drift:D,type:m,frag:r,start:y.startPTS,end:y.endPTS}),!0}return v},!1)||(this.warn("Found no media in fragment "+r.sn+" of level "+o.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=Jt,this.hls.trigger(f.Events.FRAG_PARSED,{frag:r,part:a})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=t,(n=[{key:"state",get:function(){return this._state},set:function(r){var a=this._state;a!==r&&(this._state=r,this.log(a+"->"+r))}}])&&lr(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(Y);function Lr(){return self.MediaSource||self.WebKitMediaSource}function Jr(){return self.SourceBuffer||self.WebKitSourceBuffer}var Dr=function(){var h=ENTRY_MODULE,l={},e=function i(n){var s=l[n];if(s!==void 0)return s.exports;var r=l[n]={exports:{}};return h[n].call(r.exports,r,r.exports,i),r.exports};e.m=h,e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,{a:n}),n},e.d=function(i,n){for(var s in n)e.o(n,s)&&!e.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:n[s]})},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})};var t=e(ENTRY_MODULE);return t.default||t}.toString().split("ENTRY_MODULE"),Zr="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function ei(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Mi(h,l,e){var t={};t[e]=[];var i=l.toString().replace(/^"[^"]+"/,"function"),n=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return t;for(var s,r=n[1],a=new RegExp("(\\\\n|\\W)"+ei(r)+Zr,"g");s=a.exec(i);)s[3]!=="dll-reference"&&t[e].push(s[3]);for(a=new RegExp("\\("+ei(r)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+Zr,"g");s=a.exec(i);)h[s[2]]||(t[e].push(s[1]),h[s[2]]=H(s[1]).m),t[s[2]]=t[s[2]]||[],t[s[2]].push(s[4]);for(var o,u=Object.keys(t),d=0;d<u.length;d++)for(var c=0;c<t[u[d]].length;c++)o=t[u[d]][c],isNaN(1*o)||(t[u[d]][c]=1*t[u[d]][c]);return t}function Ni(h){return Object.keys(h).reduce(function(l,e){return l||h[e].length>0},!1)}function ti(h,l,e,t){var i=h[t].map(function(n){return'"'+n+'": '+l[t][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return Dr[0]+"{"+i+"}"+Dr[1]+'"'+e+'"'+Dr[2]}var Yt=H(544),ri=H(729),Ar=Lr()||{isTypeSupported:function(){return!1}},ii=function(){function h(e,t,i,n){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var a=function(c,v){(v=v||{}).frag=s.frag,v.id=s.id,s.hls.trigger(c,v)};this.observer=new ri.EventEmitter,this.observer.on(f.Events.FRAG_DECRYPTED,a),this.observer.on(f.Events.ERROR,a);var o={mp4:Ar.isTypeSupported("video/mp4"),mpeg:Ar.isTypeSupported("audio/mpeg"),mp3:Ar.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){var d;b.logger.log("demuxing in webworker");try{d=this.worker=function(c,v){v=v||{};var m={main:H.m},y=v.all?{main:Object.keys(m.main)}:function(K,X){for(var re={main:[X]},j={main:[]},fe={main:{}};Ni(re);)for(var ue=Object.keys(re),Ae=0;Ae<ue.length;Ae++){var _e=ue[Ae],Be=re[_e].pop();if(fe[_e]=fe[_e]||{},!fe[_e][Be]&&K[_e][Be]){fe[_e][Be]=!0,j[_e]=j[_e]||[],j[_e].push(Be);for(var Xe=Mi(K,K[_e][Be],_e),Ne=Object.keys(Xe),Ge=0;Ge<Ne.length;Ge++)re[Ne[Ge]]=re[Ne[Ge]]||[],re[Ne[Ge]]=re[Ne[Ge]].concat(Xe[Ne[Ge]])}}return j}(m,c),I="";Object.keys(y).filter(function(K){return K!=="main"}).forEach(function(K){for(var X=0;y[K][X];)X++;y[K].push(X),m[K][X]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",I=I+"var "+K+" = ("+ti(y,m,X,modules)+`)();
`}),I=I+"new (("+ti(y,m,c,"main")+")())(self);";var D=new window.Blob([I],{type:"text/javascript"}),W=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(D),q=new window.Worker(W);return q.objectURL=W,q}(182),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(c){s.useWorker=!1,b.logger.warn("Exception in webworker, fallback to inline"),s.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},d.postMessage({cmd:"init",typeSupported:o,vendor:u,id:t,config:JSON.stringify(r)})}catch(c){b.logger.warn("Error in worker:",c),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new Yt.default(this.observer,o,r,u,t),this.worker=null}}else this.transmuxer=new Yt.default(this.observer,o,r,u,t)}var l=h.prototype;return l.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},l.push=function(e,t,i,n,s,r,a,o,u,d){var c,v,m=this;u.transmuxing.start=self.performance.now();var y=this.transmuxer,I=this.worker,D=r?r.start:s.start,W=s.decryptdata,q=this.frag,K=!(q&&s.cc===q.cc),X=!(q&&u.level===q.level),re=q?u.sn-q.sn:-1,j=this.part?u.part-this.part.index:-1,fe=re===0&&u.id>1&&u.id===(q==null?void 0:q.stats.chunkCount),ue=!X&&(re===1||re===0&&(j===1||fe&&j<=0)),Ae=self.performance.now();(X||re||s.stats.parsing.start===0)&&(s.stats.parsing.start=Ae),!r||!j&&ue||(r.stats.parsing.start=Ae);var _e=!(q&&((c=s.initSegment)===null||c===void 0?void 0:c.url)===((v=q.initSegment)===null||v===void 0?void 0:v.url)),Be=new Yt.TransmuxState(K,ue,o,X,D,_e);if(!ue||K||_e){b.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+K+`
        trackSwitch: `+X+`
        contiguous: `+ue+`
        accurateTimeOffset: `+o+`
        timeOffset: `+D+`
        initSegmentChange: `+_e);var Xe=new Yt.TransmuxConfig(i,n,t,a,d);this.configureTransmuxer(Xe)}if(this.frag=s,this.part=r,I)I.postMessage({cmd:"demux",data:e,decryptdata:W,chunkMeta:u,state:Be},e instanceof ArrayBuffer?[e]:[]);else if(y){var Ne=y.push(e,W,u,Be);(0,Yt.isPromise)(Ne)?Ne.then(function(Ge){m.handleTransmuxComplete(Ge)}):this.handleTransmuxComplete(Ne)}},l.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(i){var s=i.flush(e);(0,Yt.isPromise)(s)?s.then(function(r){t.handleFlushResult(r,e)}):this.handleFlushResult(s,e)}},l.handleFlushResult=function(e,t){var i=this;e.forEach(function(n){i.handleTransmuxComplete(n)}),this.onFlush(t)},l.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":b.logger[t.data.logType]&&b.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},l.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},l.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},h}(),Ui=function(){function h(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var l=h.prototype;return l.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},l.poll=function(e,t){var i=this.config,n=this.media,s=this.stalled;if(n!==null){var r=n.currentTime,a=n.seeking,o=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,r===e){if((u||o)&&(this.stalled=null),!(n.paused&&!a||n.ended||n.playbackRate===0)&&z.getBuffered(n).length){var d=z.bufferInfo(n,r,0),c=d.len>0,v=d.nextStart||0;if(c||v){if(a){var m=d.len>2,y=!v||t&&t.start<=r||v-r>2&&!this.fragmentTracker.getPartialFragment(r);if(m||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var I,D=Math.max(v,d.start||0)-r,W=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,q=!(W==null||(I=W.details)===null||I===void 0)&&I.live?2*W.details.targetduration:2;if(D>0&&D<=q)return void this._trySkipBufferHole(null)}var K=self.performance.now();if(s!==null){var X=K-s;if(a||!(X>=250)||(this._reportStall(d),this.media)){var re=z.bufferInfo(n,r,i.maxBufferHole);this._tryFixBufferStall(re,X)}}else this.stalled=K}}}else if(this.moved=!0,s!==null){if(this.stallReported){var j=self.performance.now()-s;b.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(j)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},l._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,s=this.media;if(s!==null){var r=s.currentTime,a=n.getPartialFragment(r);if(a&&(this._trySkipBufferHole(a)||!this.media))return;e.len>i.maxBufferHole&&t>1e3*i.highBufferWatchdogPeriod&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},l._reportStall=function(e){var t=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,b.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},l._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(n===null)return 0;for(var s=n.currentTime,r=0,a=z.getBuffered(n),o=0;o<a.length;o++){var u=a.start(o);if(s+t.maxBufferHole>=r&&s<u){var d=Math.max(u+.05,n.currentTime+.1);return b.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+d),this.moved=!0,this.stalled=null,n.currentTime=d,e&&i.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+d,frag:e}),d}r=a.end(o)}return 0},l._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(i!==null){var s=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var r=s+(n+1)*e.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+s+" to "+r),i.currentTime=r,t.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+s+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},h}();function Bi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function kr(h,l){return kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kr(h,l)}var Gi=function(h){var l,e;function t(r,a){var o;return(o=h.call(this,r,a,"[stream-controller]")||this).audioCodecSwap=!1,o.gapController=null,o.level=-1,o._forceStartLoad=!1,o.altAudio=!1,o.audioOnly=!1,o.fragPlaying=null,o.onvplaying=null,o.onvseeked=null,o.fragLastKbps=0,o.couldBacktrack=!1,o.backtrackFragment=null,o.audioCodecSwitch=!1,o.videoBuffer=null,o._registerListeners(),o}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,kr(l,e);var i,n,s=t.prototype;return s._registerListeners=function(){var r=this.hls;r.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(f.Events.ERROR,this.onError,this),r.on(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(f.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(f.Events.ERROR,this.onError,this),r.off(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(f.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},s.startLoad=function(r){if(this.levels){var a=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=o.startLevel;u===-1&&(o.config.testBandwidth&&this.levels.length>1?(u=0,this.bitrateTest=!0):u=o.nextAutoLevel),this.level=o.nextLoadLevel=u,this.loadedmetadata=!1}a>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),r=a),this.state=qe,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=wt},s.stopLoad=function(){this._forceStartLoad=!1,h.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case qe:this.doTickIdle();break;case Wt:var r,a=this.levels,o=this.level,u=a==null||(r=a[o])===null||r===void 0?void 0:r.details;if(u&&(!u.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(u))break;this.state=qe;break}break;case Vt:var d,c=self.performance.now(),v=this.retryDate;(!v||c>=v||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=qe)}this.onTickEnd()},s.onTickEnd=function(){h.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},s.doTickIdle=function(){var r,a,o=this.hls,u=this.levelLastLoaded,d=this.levels,c=this.media,v=o.config,m=o.nextLoadLevel;if(u!==null&&(c||!this.startFragRequested&&v.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&d&&d[m]){var y=d[m];this.level=o.nextLoadLevel=m;var I=y.details;if(!I||this.state===Wt||I.live&&this.levelLastLoaded!==m)this.state=Wt;else{var D=this.getMainFwdBufferInfo();if(D!==null&&!(D.len>=this.getMaxBufferLength(y.maxBitrate))){if(this._streamEnded(D,I)){var W={};return this.altAudio&&(W.type="video"),this.hls.trigger(f.Events.BUFFER_EOS,W),void(this.state=hr)}this.backtrackFragment&&this.backtrackFragment.start>D.end&&(this.backtrackFragment=null);var q=this.backtrackFragment?this.backtrackFragment.start:D.end,K=this.getNextFragment(q,I);if(this.couldBacktrack&&!this.fragPrevious&&K&&K.sn!=="initSegment"&&this.fragmentTracker.getState(K)!==g.OK){var X,re=((X=this.backtrackFragment)!=null?X:K).sn-I.startSN,j=I.fragments[re-1];j&&K.cc===j.cc&&(K=j,this.fragmentTracker.removeFragment(j))}else this.backtrackFragment&&D.len&&(this.backtrackFragment=null);if(K&&this.fragmentTracker.getState(K)===g.OK&&this.nextLoadPosition>q){var fe=this.audioOnly&&!this.altAudio?te.ElementaryStreamTypes.AUDIO:te.ElementaryStreamTypes.VIDEO;c&&this.afterBufferFlushed(c,fe,_.PlaylistLevelType.MAIN),K=this.getNextFragment(this.nextLoadPosition,I)}K&&(!K.initSegment||K.initSegment.data||this.bitrateTest||(K=K.initSegment),((r=K.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(a=K.decryptdata)!==null&&a!==void 0&&a.key?this.loadFragment(K,I,q):this.loadKey(K,I))}}}},s.loadFragment=function(r,a,o){var u,d=this.fragmentTracker.getState(r);this.fragCurrent=r,d===g.NOT_LOADED?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,a,o)):d===g.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((u=this.media)===null||u===void 0?void 0:u.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},s.getAppendedFrag=function(r){var a=this.fragmentTracker.getAppendedFrag(r,_.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},s.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,_.PlaylistLevelType.MAIN)},s.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},s.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.nextLevelSwitch=function(){var r=this.levels,a=this.media;if(a!=null&&a.readyState){var o,u=this.getAppendedFrag(a.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!a.paused&&r){var d=r[this.hls.nextLoadLevel],c=this.fragLastKbps;o=c&&this.fragCurrent?this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:0}else o=0;var v=this.getBufferedFrag(a.currentTime+o);if(v){var m=this.followingBufferedFrag(v);if(m){this.abortCurrentFrag();var y=m.maxStartPTS?m.maxStartPTS:m.start,I=m.duration,D=Math.max(v.end,y+Math.min(Math.max(I-this.config.maxFragLookUpTolerance,.5*I),.75*I));this.flushMainBuffer(D,Number.POSITIVE_INFINITY)}}}},s.abortCurrentFrag=function(){var r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r!=null&&r.loader&&r.loader.abort(),this.state){case Sr:case jt:case Vt:case Ot:case Jt:this.state=qe}this.nextLoadPosition=this.getLoadPosition()},s.flushMainBuffer=function(r,a){h.prototype.flushMainBuffer.call(this,r,a,this.altAudio?"video":null)},s.onMediaAttached=function(r,a){h.prototype.onMediaAttached.call(this,r,a);var o=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),o.addEventListener("playing",this.onvplaying),o.addEventListener("seeked",this.onvseeked),this.gapController=new Ui(this.config,o,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var r=this.media;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),h.prototype.onMediaDetaching.call(this)},s.onMediaPlaying=function(){this.tick()},s.onMediaSeeked=function(){var r=this.media,a=r?r.currentTime:null;(0,F.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},s.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(f.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},s.onManifestParsed=function(r,a){var o,u,d,c=!1,v=!1;a.levels.forEach(function(m){(o=m.audioCodec)&&(o.indexOf("mp4a.40.2")!==-1&&(c=!0),o.indexOf("mp4a.40.5")!==-1&&(v=!0))}),this.audioCodecSwitch=c&&v&&typeof((d=Jr())==null||(u=d.prototype)===null||u===void 0?void 0:u.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},s.onLevelLoading=function(r,a){var o=this.levels;if(o&&this.state===qe){var u=o[a.level];(!u.details||u.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(u.details))&&(this.state=Wt)}},s.onLevelLoaded=function(r,a){var o,u=this.levels,d=a.level,c=a.details,v=c.totalduration;if(u){this.log("Level "+d+" loaded ["+c.startSN+","+c.endSN+"], cc ["+c.startCC+", "+c.endCC+"] duration:"+v);var m=this.fragCurrent;!m||this.state!==jt&&this.state!==Vt||m.level!==a.level&&m.loader&&(this.state=qe,this.backtrackFragment=null,m.loader.abort());var y=u[d],I=0;if(c.live||(o=y.details)!==null&&o!==void 0&&o.live){if(c.fragments[0]||(c.deltaUpdateFailed=!0),c.deltaUpdateFailed)return;I=this.alignPlaylists(c,y.details)}if(y.details=c,this.levelLastLoaded=d,this.hls.trigger(f.Events.LEVEL_UPDATED,{details:c,level:d}),this.state===Wt){if(this.waitForCdnTuneIn(c))return;this.state=qe}this.startFragRequested?c.live&&this.synchronizeToLiveEdge(c):this.setStartPosition(c,I),this.tick()}else this.warn("Levels were reset while loading level "+d)},s._handleFragmentLoadProgress=function(r){var a,o=r.frag,u=r.part,d=r.payload,c=this.levels;if(c){var v=c[o.level],m=v.details;if(m){var y=v.videoCodec,I=m.PTSKnown||!m.live,D=(a=o.initSegment)===null||a===void 0?void 0:a.data,W=this._getAudioCodec(v),q=this.transmuxer=this.transmuxer||new ii(this.hls,_.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=u?u.index:-1,X=K!==-1,re=new de(o.level,o.sn,o.stats.chunkCount,d.byteLength,K,X),j=this.initPTS[o.cc];q.push(d,D,W,y,o,u,m.totalduration,I,re,j)}else this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered")},s.onAudioTrackSwitching=function(r,a){var o=this.altAudio,u=!!a.url,d=a.id;if(!u){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var c=this.fragCurrent;c!=null&&c.loader&&(this.log("Switching to main audio track, cancel main fragment load"),c.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var v=this.hls;o&&v.trigger(f.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),v.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:d})}},s.onAudioTrackSwitched=function(r,a){var o=a.id,u=!!this.hls.audioTracks[o].url;if(u){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=u,this.tick()},s.onBufferCreated=function(r,a){var o,u,d=a.tracks,c=!1;for(var v in d){var m=d[v];if(m.id==="main"){if(u=v,o=m,v==="video"){var y=d[v];y&&(this.videoBuffer=y.buffer)}}else c=!0}c&&o?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(r,a){var o=a.frag,u=a.part;if(!o||o.type===_.PlaylistLevelType.MAIN){if(this.fragContextChanged(o))return this.warn("Fragment "+o.sn+(u?" p: "+u.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Jt&&(this.state=qe));var d=u?u.stats:o.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),o.sn!=="initSegment"&&(this.fragPrevious=o),this.fragBufferedComplete(o,u)}},s.onError=function(r,a){switch(a.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:case C.ErrorDetails.KEY_LOAD_ERROR:case C.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.MAIN,a);break;case C.ErrorDetails.LEVEL_LOAD_ERROR:case C.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Bt&&(a.fatal?(this.warn(""+a.details),this.state=Bt):a.levelRetry||this.state!==Wt||(this.state=qe));break;case C.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===Ot||this.state===Jt)){var o=!0,u=this.getFwdBufferInfo(this.media,_.PlaylistLevelType.MAIN);u&&u.len>.5&&(o=!this.reduceMaxBufferLength(u.len)),o&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},s.checkBuffer=function(){var r=this.media,a=this.gapController;if(r&&a&&r.readyState){if(this.loadedmetadata||!z.getBuffered(r).length){var o=this.state!==qe?this.fragCurrent:null;a.poll(this.lastCurrentTime,o)}this.lastCurrentTime=r.currentTime}},s.onFragLoadEmergencyAborted=function(){this.state=qe,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},s.onBufferFlushed=function(r,a){var o=a.type;if(o!==te.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var u=(o===te.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(u,o,_.PlaylistLevelType.MAIN)}},s.onLevelsUpdated=function(r,a){this.levels=a.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s.seekToStartPos=function(){var r=this.media;if(r){var a=r.currentTime,o=this.startPosition;if(o>=0&&a<o){if(r.seeking)return void this.log("could not seek to "+o+", already seeking at "+a);var u=z.getBuffered(r),d=(u.length?u.start(0):0)-o;d>0&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+d+" to match buffer start"),o+=d,this.startPosition=o),this.log("seek to target start position "+o+" from current time "+a),r.currentTime=o}}},s._getAudioCodec=function(r){var a=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},s._loadBitrateTestFrag=function(r){var a=this;r.bitrateTest=!0,this._doFragLoad(r).then(function(o){var u=a.hls;if(o&&!u.nextLoadLevel&&!a.fragContextChanged(r)){a.fragLoadError=0,a.state=qe,a.startFragRequested=!1,a.bitrateTest=!1;var d=r.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),u.trigger(f.Events.FRAG_LOADED,o),r.bitrateTest=!1}})},s._handleTransmuxComplete=function(r){var a,o="main",u=this.hls,d=r.remuxResult,c=r.chunkMeta,v=this.getCurrentContext(c);if(!v)return this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(c.level);var m=v.frag,y=v.part,I=v.level,D=d.video,W=d.text,q=d.id3,K=d.initSegment,X=I.details,re=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(m)){if(this.state=Ot,K){K.tracks&&(this._bufferInitSegment(I,K.tracks,m,c),u.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:o,tracks:K.tracks}));var j=K.initPTS,fe=K.timescale;(0,F.isFiniteNumber)(j)&&(this.initPTS[m.cc]=j,u.trigger(f.Events.INIT_PTS_FOUND,{frag:m,id:o,initPTS:j,timescale:fe}))}if(D&&d.independent!==!1){if(X){var ue=D.startPTS,Ae=D.endPTS,_e=D.startDTS,Be=D.endDTS;if(y)y.elementaryStreams[D.type]={startPTS:ue,endPTS:Ae,startDTS:_e,endDTS:Be};else if(D.firstKeyFrame&&D.independent&&(this.couldBacktrack=!0),D.dropped&&D.independent){var Xe=this.getMainFwdBufferInfo();if((Xe?Xe.end:this.getLoadPosition())+this.config.maxBufferHole<(D.firstKeyFramePTS?D.firstKeyFramePTS:ue)-this.config.maxBufferHole)return void this.backtrack(m);m.setElementaryStreamInfo(D.type,m.start,Ae,m.start,Be,!0)}m.setElementaryStreamInfo(D.type,ue,Ae,_e,Be),this.backtrackFragment&&(this.backtrackFragment=m),this.bufferFragmentData(D,m,y,c)}}else if(d.independent===!1)return void this.backtrack(m);if(re){var Ne=re.startPTS,Ge=re.endPTS,Qe=re.startDTS,at=re.endDTS;y&&(y.elementaryStreams[te.ElementaryStreamTypes.AUDIO]={startPTS:Ne,endPTS:Ge,startDTS:Qe,endDTS:at}),m.setElementaryStreamInfo(te.ElementaryStreamTypes.AUDIO,Ne,Ge,Qe,at),this.bufferFragmentData(re,m,y,c)}if(X&&q!=null&&(a=q.samples)!==null&&a!==void 0&&a.length){var vt={id:o,frag:m,details:X,samples:q.samples};u.trigger(f.Events.FRAG_PARSING_METADATA,vt)}if(X&&W){var tt={id:o,frag:m,details:X,samples:W.samples};u.trigger(f.Events.FRAG_PARSING_USERDATA,tt)}}},s._bufferInitSegment=function(r,a,o,u){var d=this;if(this.state===Ot){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var c=a.audio,v=a.video,m=a.audiovideo;if(c){var y=r.audioCodec,I=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(y&&(y=y.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),c.metadata.channelCount!==1&&I.indexOf("firefox")===-1&&(y="mp4a.40.5")),I.indexOf("android")!==-1&&c.container!=="audio/mpeg"&&(y="mp4a.40.2",this.log("Android: force audio codec to "+y)),r.audioCodec&&r.audioCodec!==y&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+y+'"'),c.levelCodec=y,c.id="main",this.log("Init audio buffer, container:"+c.container+", codecs[selected/level/parsed]=["+(y||"")+"/"+(r.audioCodec||"")+"/"+c.codec+"]")}v&&(v.levelCodec=r.videoCodec,v.id="main",this.log("Init video buffer, container:"+v.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+v.codec+"]")),m&&this.log("Init audiovideo buffer, container:"+m.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+m.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(D){var W=a[D].initSegment;W!=null&&W.byteLength&&d.hls.trigger(f.Events.BUFFER_APPENDING,{type:D,data:W,frag:o,part:null,chunkMeta:u,parent:o.type})}),this.tick()}},s.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,_.PlaylistLevelType.MAIN)},s.backtrack=function(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=qe},s.checkFragmentChanged=function(){var r=this.media,a=null;if(r&&r.readyState>1&&r.seeking===!1){var o=r.currentTime;if(z.isBuffered(r,o)?a=this.getAppendedFrag(o):z.isBuffered(r,o+.1)&&(a=this.getAppendedFrag(o+.1)),a){this.backtrackFragment=null;var u=this.fragPlaying,d=a.level;u&&a.sn===u.sn&&u.level===d&&a.urlId===u.urlId||(this.hls.trigger(f.Events.FRAG_CHANGED,{frag:a}),u&&u.level===d||this.hls.trigger(f.Events.LEVEL_SWITCHED,{level:d}),this.fragPlaying=a)}}},i=t,(n=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentFrag",get:function(){var r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}},{key:"currentProgramDateTime",get:function(){var r=this.media;if(r){var a=r.currentTime,o=this.currentFrag;if(o&&(0,F.isFiniteNumber)(a)&&(0,F.isFiniteNumber)(o.programDateTime)){var u=o.programDateTime+1e3*(a-o.start);return new Date(u)}}return null}},{key:"currentLevel",get:function(){var r=this.currentFrag;return r?r.level:-1}},{key:"nextBufferedFrag",get:function(){var r=this.currentFrag;return r?this.followingBufferedFrag(r):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&Bi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(br);const dr=function(){function h(e,t,i){t===void 0&&(t=0),i===void 0&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var l=h.prototype;return l.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},l.getTotalWeight=function(){return this.totalWeight_},l.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},h}(),Ki=function(){function h(e,t,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new dr(e),this.fast_=new dr(t)}var l=h.prototype;return l.update=function(e,t){var i=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new dr(e,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new dr(t,n.getEstimate(),n.getTotalWeight()))},l.sample=function(e,t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/i;this.fast_.sample(i,n),this.slow_.sample(i,n)},l.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},l.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},l.destroy=function(){},h}();function Hi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}const ji=function(){function h(i){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;var n=i.config;this.bwEstimator=new Ki(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var l,e,t=h.prototype;return t.registerListeners=function(){var i=this.hls;i.on(f.Events.FRAG_LOADING,this.onFragLoading,this),i.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(f.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var i=this.hls;i.off(f.Events.FRAG_LOADING,this.onFragLoading,this),i.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(f.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(i,n){var s,r=n.frag;r.type===_.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=(s=n.part)!=null?s:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(i,n){var s=this.hls.config;n.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.autoLevelEnabled,a=(s.config,s.media);if(i&&a){var o=n?n.stats:i.stats,u=n?n.duration:i.duration;if(o.aborted||o.loaded&&o.loaded===o.total||i.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!a.paused&&a.playbackRate&&a.readyState){var d=s.mainForwardBufferInfo;if(d!==null){var c=performance.now()-o.loading.start,v=Math.abs(a.playbackRate);if(!(c<=500*u/v)){var m=o.loaded&&o.loading.first,y=this.bwEstimator.getEstimate(),I=s.levels,D=s.minAutoLevel,W=I[i.level],q=o.total||Math.max(o.loaded,Math.round(u*W.maxBitrate/8)),K=m?1e3*o.loaded/c:0,X=K?(q-o.loaded)/K:8*q/y,re=d.len/v;if(!(X<=re)){var j,fe=Number.POSITIVE_INFINITY;for(j=i.level-1;j>D;j--){var ue=I[j].maxBitrate;if((fe=K?u*ue/(6.4*K):u*ue/y)<re)break}fe>=X||(b.logger.warn("Fragment "+i.sn+(n?" part "+n.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+j+`
      Current BW estimate: `+((0,F.isFiniteNumber)(y)?(y/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+X.toFixed(3)+` s
      Estimated load time for the next fragment: `+fe.toFixed(3)+` s
      Time to underbuffer: `+re.toFixed(3)+" s"),s.nextLoadLevel=j,m&&this.bwEstimator.sample(c,o.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),s.trigger(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:o}))}}}}}},t.onFragLoaded=function(i,n){var s=n.frag,r=n.part;if(s.type===_.PlaylistLevelType.MAIN&&(0,F.isFiniteNumber)(s.sn)){var a=r?r.stats:s.stats,o=r?r.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[s.level],d=(u.loaded?u.loaded.bytes:0)+a.loaded,c=(u.loaded?u.loaded.duration:0)+o;u.loaded={bytes:d,duration:c},u.realBitrate=Math.round(8*d/c)}if(s.bitrateTest){var v={stats:a,frag:s,part:r,id:s.type};this.onFragBuffered(f.Events.FRAG_BUFFERED,v)}}},t.onFragBuffered=function(i,n){var s=n.frag,r=n.part,a=r?r.stats:s.stats;if(!a.aborted&&s.type===_.PlaylistLevelType.MAIN&&s.sn!=="initSegment"){var o=a.parsing.end-a.loading.start;this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},t.onError=function(i,n){switch(n.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var i=this.fragCurrent,n=this.partCurrent,s=this.hls,r=s.maxAutoLevel,a=s.config,o=s.minAutoLevel,u=s.media,d=n?n.duration:i?i.duration:0,c=(u&&u.currentTime,u&&u.playbackRate!==0?Math.abs(u.playbackRate):1),v=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,m=s.mainForwardBufferInfo,y=(m?m.len:0)/c,I=this.findBestLevel(v,o,r,y,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(I>=0)return I;b.logger.trace((y?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var D=d?Math.min(d,a.maxStarvationDelay):a.maxStarvationDelay,W=a.abrBandWidthFactor,q=a.abrBandWidthUpFactor;if(!y){var K=this.bitrateTestDelay;K&&(D=(d?Math.min(d,a.maxLoadingDelay):a.maxLoadingDelay)-K,b.logger.trace("bitrate test took "+Math.round(1e3*K)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*D)+" ms"),W=q=1)}return I=this.findBestLevel(v,o,r,y+D,W,q),Math.max(I,0)},t.findBestLevel=function(i,n,s,r,a,o){for(var u,d=this.fragCurrent,c=this.partCurrent,v=this.lastLoadedFragLevel,m=this.hls.levels,y=m[v],I=!(y==null||(u=y.details)===null||u===void 0||!u.live),D=y==null?void 0:y.codecSet,W=c?c.duration:d?d.duration:0,q=s;q>=n;q--){var K=m[q];if(K&&(!D||K.codecSet===D)){var X,re=K.details,j=(c?re==null?void 0:re.partTarget:re==null?void 0:re.averagetargetduration)||W;X=q<=v?a*i:o*i;var fe=m[q].maxBitrate,ue=fe*j/X;if(b.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+q+"/"+Math.round(X)+"/"+fe+"/"+j+"/"+r+"/"+ue),X>fe&&(ue===0||!(0,F.isFiniteNumber)(ue)||I&&!this.bitrateTestDelay||ue<r))return q}}return-1},l=h,(e=[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,n=this.bwEstimator;if(i!==-1&&!n.canEstimate())return i;var s=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[s].loadError?i:(i!==-1&&(s=Math.min(i,s)),s)},set:function(i){this._nextAutoLevel=i}}])&&Hi(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();var ni=function(){function h(){this.chunks=[],this.dataLength=0}var l=h.prototype;return l.push=function(e){this.chunks.push(e),this.dataLength+=e.length},l.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=t.length===1?t[0]:function(n,s){for(var r=new Uint8Array(s),a=0,o=0;o<n.length;o++){var u=n[o];r.set(u,a),a+=u.length}return r}(t,i),this.reset(),e):new Uint8Array(0)},l.reset=function(){this.chunks.length=0,this.dataLength=0},h}();function cr(){return cr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},cr.apply(this,arguments)}function Rr(h,l){return Rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rr(h,l)}var Vi=function(h){var l,e;function t(n,s){var r;return(r=h.call(this,n,s,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Rr(l,e);var i=t.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var n=this.hls;n.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(f.Events.ERROR,this.onError,this),n.on(f.Events.BUFFER_RESET,this.onBufferReset,this),n.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var n=this.hls;n.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(f.Events.ERROR,this.onError,this),n.off(f.Events.BUFFER_RESET,this.onBufferReset,this),n.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(n,s){var r=s.frag,a=s.id,o=s.initPTS;if(a==="main"){var u=r.cc;this.initPTS[r.cc]=o,this.log("InitPTS for cc: "+u+" found from main: "+o),this.videoTrackCC=u,this.state===Zt&&this.tick()}},i.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=wt);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),n=s,this.state=qe):(this.loadedmetadata=!1,this.state=ur),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},i.doTick=function(){switch(this.state){case qe:this.doTickIdle();break;case ur:var n,s=this.levels,r=this.trackId,a=s==null||(n=s[r])===null||n===void 0?void 0:n.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=Zt}break;case Vt:var o,u=performance.now(),d=this.retryDate;(!d||u>=d||(o=this.media)!==null&&o!==void 0&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=qe);break;case Zt:var c=this.waitingData;if(c){var v=c.frag,m=c.part,y=c.cache,I=c.complete;if(this.initPTS[v.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=jt;var D={frag:v,part:m,payload:y.flush(),networkDetails:null};this._handleFragmentLoadProgress(D),I&&h.prototype._handleFragmentLoadComplete.call(this,D)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+v.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),q=z.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole);ze(q.end,this.config.maxFragLookUpTolerance,v)<0&&(this.log("Waiting fragment cc ("+v.cc+") @ "+v.start+" cancelled because another fragment at "+q.end+" is needed"),this.clearWaitingFragment())}}else this.state=qe}this.onTickEnd()},i.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=qe)},i.resetLoadingState=function(){this.clearWaitingFragment(),h.prototype.resetLoadingState.call(this)},i.onTickEnd=function(){var n=this.media;n&&n.readyState&&(this.lastCurrentTime=n.currentTime)},i.doTickIdle=function(){var n,s,r=this.hls,a=this.levels,o=this.media,u=this.trackId,d=r.config;if(a&&a[u]&&(o||!this.startFragRequested&&d.startFragPrefetch)){var c=a[u].details;if(!c||c.live&&this.levelLastLoaded!==u||this.waitForCdnTuneIn(c))this.state=ur;else{var v=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&v&&(this.bufferFlushed=!1,this.afterBufferFlushed(v,te.ElementaryStreamTypes.AUDIO,_.PlaylistLevelType.AUDIO));var m=this.getFwdBufferInfo(v,_.PlaylistLevelType.AUDIO);if(m!==null){var y=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,_.PlaylistLevelType.MAIN),I=m.len,D=this.getMaxBufferLength(y==null?void 0:y.len),W=this.audioSwitch;if(!(I>=D)||W){if(!W&&this._streamEnded(m,c))return r.trigger(f.Events.BUFFER_EOS,{type:"audio"}),void(this.state=hr);var q=c.fragments[0].start,K=m.end;if(W&&o){var X=this.getLoadPosition();K=X,c.PTSKnown&&X<q&&(m.end>q||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=q+.05)}if(!(y&&K>y.end+c.targetduration)&&(y&&y.len||!m.len)){var re=this.getNextFragment(K,c);re?((n=re.decryptdata)===null||n===void 0?void 0:n.keyFormat)!=="identity"||(s=re.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(re,c,K):this.loadKey(re,c):this.bufferFlushed=!0}}}}}},i.getMaxBufferLength=function(n){var s=h.prototype.getMaxBufferLength.call(this);return n?Math.max(s,n):s},i.onMediaDetaching=function(){this.videoBuffer=null,h.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(n,s){var r=s.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(a){return new rt(a)})},i.onAudioTrackSwitching=function(n,s){var r=!!s.url;this.trackId=s.id;var a=this.fragCurrent;a!=null&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=qe):this.state=wt,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(n,s){this.mainDetails=s.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(f.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(n,s){var r;if(this.mainDetails!=null){var a=this.levels,o=s.details,u=s.id;if(a){this.log("Track "+u+" loaded ["+o.startSN+","+o.endSN+"],duration:"+o.totalduration);var d=a[u],c=0;if(o.live||(r=d.details)!==null&&r!==void 0&&r.live){var v=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!v)return;!d.details&&o.hasProgramDateTime&&v.hasProgramDateTime?(Oe(o,v),c=o.fragments[0].start):c=this.alignPlaylists(o,d.details)}d.details=o,this.levelLastLoaded=u,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(d.details,c),this.state!==ur||this.waitForCdnTuneIn(o)||(this.state=qe),this.tick()}else this.warn("Audio tracks were reset while loading level "+u)}else this.cachedTrackLoadedData=s},i._handleFragmentLoadProgress=function(n){var s,r=n.frag,a=n.part,o=n.payload,u=this.config,d=this.trackId,c=this.levels;if(c){var v=c[d],m=v.details,y=u.defaultAudioCodec||v.audioCodec||"mp4a.40.2",I=this.transmuxer;I||(I=this.transmuxer=new ii(this.hls,_.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var D=this.initPTS[r.cc],W=(s=r.initSegment)===null||s===void 0?void 0:s.data;if(D!==void 0){var q=a?a.index:-1,K=q!==-1,X=new de(r.level,r.sn,r.stats.chunkCount,o.byteLength,q,K);I.push(o,W,y,"",r,a,m.totalduration,!1,X,D)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+m.startSN+" ,"+m.endSN+"],track "+d),(this.waitingData=this.waitingData||{frag:r,part:a,cache:new ni,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=Zt}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},i._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:h.prototype._handleFragmentLoadComplete.call(this,n)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(n,s){var r=s.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer||null)},i.onFragBuffered=function(n,s){var r,a=s.frag,o=s.part;a.type===_.PlaylistLevelType.AUDIO?this.fragContextChanged(a)?this.warn("Fragment "+a.sn+(o?" p: "+o.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,o)):this.loadedmetadata||a.type!==_.PlaylistLevelType.MAIN||(r=this.videoBuffer||this.media)!==null&&r!==void 0&&r.buffered.length&&(this.loadedmetadata=!0)},i.onError=function(n,s){switch(s.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:case C.ErrorDetails.KEY_LOAD_ERROR:case C.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.AUDIO,s);break;case C.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case C.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Bt&&this.state!==wt&&(this.state=s.fatal?Bt:qe,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case C.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===Ot||this.state===Jt)){var r=!0,a=this.getFwdBufferInfo(this.mediaBuffer,_.PlaylistLevelType.AUDIO);a&&a.len>.5&&(r=!this.reduceMaxBufferLength(a.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},i.onBufferFlushed=function(n,s){s.type===te.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},i._handleTransmuxComplete=function(n){var s,r="audio",a=this.hls,o=n.remuxResult,u=n.chunkMeta,d=this.getCurrentContext(u);if(!d)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(u.level);var c=d.frag,v=d.part,m=d.level.details,y=o.audio,I=o.text,D=o.id3,W=o.initSegment;if(!this.fragContextChanged(c)&&m){if(this.state=Ot,this.audioSwitch&&y&&this.completeAudioSwitch(),W!=null&&W.tracks&&(this._bufferInitSegment(W.tracks,c,u),a.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:r,tracks:W.tracks})),y){var q=y.startPTS,K=y.endPTS,X=y.startDTS,re=y.endDTS;v&&(v.elementaryStreams[te.ElementaryStreamTypes.AUDIO]={startPTS:q,endPTS:K,startDTS:X,endDTS:re}),c.setElementaryStreamInfo(te.ElementaryStreamTypes.AUDIO,q,K,X,re),this.bufferFragmentData(y,c,v,u)}if(D!=null&&(s=D.samples)!==null&&s!==void 0&&s.length){var j=cr({id:r,frag:c,details:m},D);a.trigger(f.Events.FRAG_PARSING_METADATA,j)}if(I){var fe=cr({id:r,frag:c,details:m},I);a.trigger(f.Events.FRAG_PARSING_USERDATA,fe)}}},i._bufferInitSegment=function(n,s,r){if(this.state===Ot){n.video&&delete n.video;var a=n.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,n);var o=a.initSegment;if(o!=null&&o.byteLength){var u={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:o};this.hls.trigger(f.Events.BUFFER_APPENDING,u)}this.tick()}}},i.loadFragment=function(n,s,r){var a=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||a===g.NOT_LOADED||a===g.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n):s.live&&!(0,F.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=Zt):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,n,s,r)))},i.completeAudioSwitch=function(){var n=this.hls,s=this.media,r=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),h.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:r})},t}(br);const Wi=Vi;function Yi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Ir(h,l){return Ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ir(h,l)}const qi=function(h){var l,e;function t(r){var a;return(a=h.call(this,r,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Ir(l,e);var i,n,s=t.prototype;return s.registerListeners=function(){var r=this.hls;r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(f.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(f.Events.ERROR,this.onError,this)},s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,h.prototype.destroy.call(this)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.audioTracks||[]},s.onAudioTrackLoaded=function(r,a){var o=a.id,u=a.details,d=this.tracksInGroup[o];if(d){var c=d.details;d.details=a.details,this.log("audioTrack "+o+" loaded ["+u.startSN+"-"+u.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,a,c))}else this.warn("Invalid audio track id "+o)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.audioGroupIds){var o=a.audioGroupIds[a.urlId];if(this.groupId!==o){this.groupId=o;var u=this.tracks.filter(function(c){return!o||c.groupId===o});this.selectDefaultTrack&&!u.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var d={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(f.Events.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}}},s.onError=function(r,a){h.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===_.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.setAudioTrack=function(r){var a=this.tracksInGroup;if(r<0||r>=a.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var o=a[this.trackId];this.log("Now switching to audio-track index "+r);var u=a[r],d=u.id,c=u.groupId,v=c===void 0?"":c,m=u.name,y=u.type,I=u.url;if(this.trackId=r,this.trackName=m,this.selectDefaultTrack=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHING,{id:d,groupId:v,name:m,type:y,url:I}),!u.details||u.details.live){var D=this.switchParams(u.url,o==null?void 0:o.details);this.loadPlaylist(D)}}},s.selectInitialTrack=function(){this.tracksInGroup;var r=this.trackName,a=this.findTrackId(r)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},s.findTrackId=function(r){for(var a=this.tracksInGroup,o=0;o<a.length;o++){var u=a[o];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var o=a.id,u=a.groupId,d=a.url;if(r)try{d=r.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist for id: "+o),this.clearTimer(),this.hls.trigger(f.Events.AUDIO_TRACK_LOADING,{url:d,id:o,groupId:u,deliveryDirectives:r||null})}},i=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}}])&&Yi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(St);function zi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function _r(h,l){return _r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_r(h,l)}var Xi=function(h){var l,e;function t(r,a){var o;return(o=h.call(this,r,a,"[subtitle-stream-controller]")||this).levels=[],o.currentTrackId=-1,o.tracksBuffered=[],o.mainDetails=null,o._registerListeners(),o}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,_r(l,e);var i,n,s=t.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var r=this.hls;r.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(f.Events.ERROR,this.onError,this),r.on(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(f.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(f.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var r=this.hls;r.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(f.Events.ERROR,this.onError,this),r.off(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(f.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(f.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.startLoad=function(r){this.stopLoad(),this.state=qe,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(r,a){this.mainDetails=a.details},s.onSubtitleFragProcessed=function(r,a){var o=a.frag,u=a.success;if(this.fragPrevious=o,this.state=qe,u){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var c,v=o.start,m=0;m<d.length;m++)if(v>=d[m].start&&v<=d[m].end){c=d[m];break}var y=o.start+o.duration;c?c.end=y:(c={start:v,end:y},d.push(c)),this.fragmentTracker.fragBuffered(o)}}},s.onBufferFlushing=function(r,a){var o=a.startOffset,u=a.endOffset;if(o===0&&u!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,c=this.levels;if(!c.length||!c[d]||!c[d].details)return;var v=u-c[d].details.targetduration;if(v<=0)return;a.endOffsetSubtitles=Math.max(0,v),this.tracksBuffered.forEach(function(m){for(var y=0;y<m.length;)if(m[y].end<=v)m.shift();else{if(!(m[y].start<v))break;m[y].start=v,y++}}),this.fragmentTracker.removeFragmentsInRange(o,v,_.PlaylistLevelType.SUBTITLE)}},s.onFragBuffered=function(r,a){var o;this.loadedmetadata||a.frag.type!==_.PlaylistLevelType.MAIN||(o=this.media)!==null&&o!==void 0&&o.buffered.length&&(this.loadedmetadata=!0)},s.onError=function(r,a){var o,u=a.frag;u&&u.type===_.PlaylistLevelType.SUBTITLE&&((o=this.fragCurrent)!==null&&o!==void 0&&o.loader&&this.fragCurrent.loader.abort(),this.state=qe)},s.onSubtitleTracksUpdated=function(r,a){var o=this,u=a.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(d){return new rt(d)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(d){o.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(r,a){if(this.currentTrackId=a.id,this.levels.length&&this.currentTrackId!==-1){var o=this.levels[this.currentTrackId];o!=null&&o.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,o&&this.setInterval(500)}else this.clearInterval()},s.onSubtitleTrackLoaded=function(r,a){var o,u=a.details,d=a.id,c=this.currentTrackId,v=this.levels;if(v.length){var m=v[c];if(!(d>=v.length||d!==c)&&m){this.mediaBuffer=this.mediaBufferTimeRanges;var y=0;if(u.live||(o=m.details)!==null&&o!==void 0&&o.live){var I=this.mainDetails;if(u.deltaUpdateFailed||!I)return;var D=I.fragments[0];m.details?(y=this.alignPlaylists(u,m.details))===0&&D&&Tt(u,y=D.start):u.hasProgramDateTime&&I.hasProgramDateTime?(Oe(u,I),y=u.fragments[0].start):D&&Tt(u,y=D.start)}m.details=u,this.levelLastLoaded=d,this.startFragRequested||!this.mainDetails&&u.live||this.setStartPosition(m.details,y),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===qe&&(Le(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),m.details=void 0))}}},s._handleFragmentLoadComplete=function(r){var a=r.frag,o=r.payload,u=a.decryptdata,d=this.hls;if(!this.fragContextChanged(a)&&o&&o.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer).then(function(v){var m=performance.now();d.trigger(f.Events.FRAG_DECRYPTED,{frag:a,payload:v,stats:{tstart:c,tdecrypt:m}})})}},s.doTick=function(){if(this.media){if(this.state===qe){var r=this.currentTrackId,a=this.levels;if(!a.length||!a[r]||!a[r].details)return;var o=a[r].details,u=o.targetduration,d=this.config,c=this.getLoadPosition(),v=z.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],c-u,d.maxBufferHole),m=v.end,y=v.len,I=this.getFwdBufferInfo(this.media,_.PlaylistLevelType.MAIN);if(y>this.getMaxBufferLength(I==null?void 0:I.len)+u)return;var D,W=o.fragments,q=W.length,K=o.edge,X=this.fragPrevious;if(m<K){var re=d.maxFragLookUpTolerance;!(D=Le(X,W,Math.max(W[0].start,m),re))&&X&&X.start<W[0].start&&(D=W[0])}else D=W[q-1];if(!(D=this.mapToInitFragWhenRequired(D))||this.fragmentTracker.getState(D)!==g.NOT_LOADED)return;D.encrypted?this.loadKey(D,o):this.loadFragment(D,o,m)}}else this.state=qe},s.getMaxBufferLength=function(r){var a=h.prototype.getMaxBufferLength.call(this);return r?Math.max(a,r):a},s.loadFragment=function(r,a,o){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,r,a,o))},i=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return new Qi(this.tracksBuffered[this.currentTrackId]||[])}}])&&zi(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(br),Qi=function(h){this.buffered=void 0;var l=function(e,t,i){if((t>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return h[t][e]};this.buffered={get length(){return h.length},end:function(e){return l("end",e,h.length)},start:function(e){return l("start",e,h.length)}}};function $i(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Cr(h,l){return Cr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Cr(h,l)}function wr(h){for(var l=[],e=0;e<h.length;e++){var t=h[e];t.kind==="subtitles"&&t.label&&l.push(h[e])}return l}const Ji=function(h){var l,e;function t(r){var a;return(a=h.call(this,r,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a._subtitleDisplay=!0,a.registerListeners(),a}e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Cr(l,e);var i,n,s=t.prototype;return s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,h.prototype.destroy.call(this)},s.registerListeners=function(){var r=this.hls;r.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(f.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var r=this.hls;r.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(f.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(f.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(f.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(f.Events.ERROR,this.onError,this)},s.onMediaAttached=function(r,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},s.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},s.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),wr(this.media.textTracks).forEach(function(r){De(r)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},s.onManifestParsed=function(r,a){this.tracks=a.subtitleTracks},s.onSubtitleTrackLoaded=function(r,a){var o=a.id,u=a.details,d=this.trackId,c=this.tracksInGroup[d];if(c){var v=c.details;c.details=a.details,this.log("subtitle track "+o+" loaded ["+u.startSN+"-"+u.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,a,v))}else this.warn("Invalid subtitle track id "+o)},s.onLevelLoading=function(r,a){this.switchLevel(a.level)},s.onLevelSwitching=function(r,a){this.switchLevel(a.level)},s.switchLevel=function(r){var a=this.hls.levels[r];if(a!=null&&a.textGroupIds){var o=a.textGroupIds[a.urlId];if(this.groupId!==o){var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(m){return!o||m.groupId===o});this.tracksInGroup=d;var c=this.findTrackId(u==null?void 0:u.name)||this.findTrackId();this.groupId=o;var v={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(f.Events.SUBTITLE_TRACKS_UPDATED,v),c!==-1&&this.setSubtitleTrack(c,u)}}},s.findTrackId=function(r){for(var a=this.tracksInGroup,o=0;o<a.length;o++){var u=a[o];if((!this.selectDefaultTrack||u.default)&&(!r||r===u.name))return u.id}return-1},s.onError=function(r,a){h.prototype.onError.call(this,r,a),!a.fatal&&a.context&&a.context.type===_.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.loadPlaylist=function(r){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var o=a.id,u=a.groupId,d=a.url;if(r)try{d=r.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Loading subtitle playlist for id "+o),this.hls.trigger(f.Events.SUBTITLE_TRACK_LOADING,{url:d,id:o,groupId:u,deliveryDirectives:r||null})}},s.toggleTrackModes=function(r){var a=this,o=this.media,u=this.trackId;if(o){var d=wr(o.textTracks),c=d.filter(function(y){return y.groupId===a.groupId});if(r===-1)[].slice.call(d).forEach(function(y){y.mode="disabled"});else{var v=c[u];v&&(v.mode="disabled")}var m=c[r];m&&(m.mode=this.subtitleDisplay?"showing":"hidden")}},s.setSubtitleTrack=function(r,a){var o,u=this.tracksInGroup;if(this.media){if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(o=u[r])!==null&&o!==void 0&&o.details)||r<-1||r>=u.length)){this.clearTimer();var d=u[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,d){var c=d.id,v=d.groupId,m=v===void 0?"":v,y=d.name,I=d.type,D=d.url;this.hls.trigger(f.Events.SUBTITLE_TRACK_SWITCH,{id:c,groupId:m,name:y,type:I,url:D});var W=this.switchParams(d.url,a==null?void 0:a.details);this.loadPlaylist(W)}else this.hls.trigger(f.Events.SUBTITLE_TRACK_SWITCH,{id:r})}}else this.queuedDefaultTrack=r},s.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var r=-1,a=wr(this.media.textTracks),o=0;o<a.length;o++)if(a[o].mode==="hidden")r=o;else if(a[o].mode==="showing"){r=o;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},i=t,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,a)}}])&&$i(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),t}(St);var We,Zi=function(){function h(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var l=h.prototype;return l.append=function(e,t){var i=this.queues[t];i.push(e),i.length===1&&this.buffers[t]&&this.executeNext(t)},l.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},l.appendBlocker=function(e){var t,i=new Promise(function(s){t=s}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},l.executeNext=function(e){var t=this.buffers,i=this.queues,n=t[e],s=i[e];if(s.length){var r=s[0];try{r.execute()}catch(a){b.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(a),n&&n.updating||(s.shift(),this.executeNext(e))}}},l.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},l.current=function(e){return this.queues[e][0]},h}(),ai=Lr(),si=/([ha]vc.)(?:\.[^.,]+)+/,en=function(){function h(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=t.hls,n=t.media,s=t.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),n&&(t.updateMediaElementDuration(),i.trigger(f.Events.MEDIA_ATTACHED,{media:n})),s&&s.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var l=h.prototype;return l.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},l.destroy=function(){this.unregisterListeners(),this.details=null},l.registerListeners=function(){var e=this.hls;e.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.Events.BUFFER_RESET,this.onBufferReset,this),e.on(f.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(f.Events.BUFFER_EOS,this.onBufferEos,this),e.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(f.Events.FRAG_PARSED,this.onFragParsed,this),e.on(f.Events.FRAG_CHANGED,this.onFragChanged,this)},l.unregisterListeners=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.Events.BUFFER_RESET,this.onBufferReset,this),e.off(f.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(f.Events.BUFFER_EOS,this.onBufferEos,this),e.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(f.Events.FRAG_PARSED,this.onFragParsed,this),e.off(f.Events.FRAG_CHANGED,this.onFragChanged,this)},l._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Zi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},l.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},l.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&ai){var n=this.mediaSource=new ai;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src}},l.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(b.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(n){b.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(f.Events.MEDIA_DETACHED,void 0)},l.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(n){b.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",n)}}),this._initSourceBuffer()},l.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(s){if(n){var r=i.tracks[s];if(r&&typeof r.buffer.changeType=="function"){var a=t[s],o=a.id,u=a.codec,d=a.levelCodec,c=a.container,v=a.metadata,m=(r.levelCodec||r.codec).replace(si,"$1"),y=(d||u).replace(si,"$1");if(m!==y){var I=c+";codecs="+(d||u);i.appendChangeType(s,I),b.logger.log("[buffer-controller]: switching codec "+m+" to "+y),i.tracks[s]={buffer:r.buffer,codec:u,container:c,levelCodec:d,metadata:v,id:o}}}}else i.pendingTracks[s]=t[s]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},l.appendChangeType=function(e,t){var i=this,n=this.operationQueue,s={execute:function(){var r=i.sourceBuffer[e];r&&(b.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(r){b.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",r)}};n.append(s,e)},l.onBufferAppending=function(e,t){var i=this,n=this.hls,s=this.operationQueue,r=this.tracks,a=t.data,o=t.type,u=t.frag,d=t.part,c=t.chunkMeta,v=c.buffering[o],m=self.performance.now();v.start=m;var y=u.stats.buffering,I=d?d.stats.buffering:null;y.start===0&&(y.start=m),I&&I.start===0&&(I.start=m);var D=r.audio,W=o==="audio"&&c.id===1&&(D==null?void 0:D.container)==="audio/mpeg",q={execute:function(){if(v.executeStart=self.performance.now(),W){var K=i.sourceBuffer[o];if(K){var X=u.start-K.timestampOffset;Math.abs(X)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+u.start+" (delta: "+X+") sn: "+u.sn+")"),K.timestampOffset=u.start)}}i.appendExecutor(a,o)},onStart:function(){},onComplete:function(){var K=self.performance.now();v.executeEnd=v.end=K,y.first===0&&(y.first=K),I&&I.first===0&&(I.first=K);var X=i.sourceBuffer,re={};for(var j in X)re[j]=z.getBuffered(X[j]);i.appendError=0,i.hls.trigger(f.Events.BUFFER_APPENDED,{type:o,frag:u,part:d,chunkMeta:c,parent:u.type,timeRanges:re})},onError:function(K){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",K);var X={type:C.ErrorTypes.MEDIA_ERROR,parent:u.type,details:C.ErrorDetails.BUFFER_APPEND_ERROR,err:K,fatal:!1};K.code===DOMException.QUOTA_EXCEEDED_ERR?X.details=C.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,X.details=C.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),X.fatal=!0,n.stopLoad())),n.trigger(f.Events.ERROR,X)}};s.append(q,o)},l.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,s=function(r){return{execute:i.removeExecutor.bind(i,r,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(f.Events.BUFFER_FLUSHED,{type:r})},onError:function(a){b.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",a)}}};t.type?n.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(function(r){n.append(s(r),r)})},l.onFragParsed=function(e,t){var i=this,n=t.frag,s=t.part,r=[],a=s?s.elementaryStreams:n.elementaryStreams;a[te.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(a[te.ElementaryStreamTypes.AUDIO]&&r.push("audio"),a[te.ElementaryStreamTypes.VIDEO]&&r.push("video")),r.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var o=self.performance.now();n.stats.buffering.end=o,s&&(s.stats.buffering.end=o);var u=s?s.stats:n.stats;i.hls.trigger(f.Events.FRAG_BUFFERED,{frag:n,part:s,stats:u,id:n.type})},r)},l.onFragChanged=function(e,t){this.flushBackBuffer()},l.onBufferEos=function(e,t){var i=this;this.getSourceBufferTypes().reduce(function(n,s){var r=i.sourceBuffer[s];return t.type&&t.type!==s||r&&!r.ended&&(r.ended=!0,b.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS")),n&&!(r&&!r.ended)},!0)&&this.blockBuffers(function(){var n=i.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},l.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},l.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,n=this.sourceBuffer;if(i&&t!==null){var s=this.getSourceBufferTypes();if(s.length){var r=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,F.isFiniteNumber)(r)&&!(r<0)){var a=i.currentTime,o=t.levelTargetDuration,u=Math.max(r,o),d=Math.floor(a/o)*o-u;s.forEach(function(c){var v=n[c];if(v){var m=z.getBuffered(v);m.length>0&&d>m.start(0)&&(e.trigger(f.Events.BACK_BUFFER_REACHED,{bufferEnd:d}),t.live&&e.trigger(f.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d}),e.trigger(f.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:c}))}})}}}},l.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,s=e.fragments[0].start+e.totalduration,r=i.duration,a=(0,F.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>r||!(0,F.isFiniteNumber)(r))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},l.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){var n=Math.max(0,i[0].start),s=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,s)}},l.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!e||n===2){this.createSourceBuffers(i),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0)return void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach(function(r){t.executeNext(r)})}},l.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var s in e)if(!t[s]){var r=e[s];if(!r)throw Error("source buffer exists for track "+s+", however track does not");var a=r.levelCodec||r.codec,o=r.container+";codecs="+a;b.logger.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var u=t[s]=i.addSourceBuffer(o),d=s;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[s]={buffer:u,codec:a,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},n++}catch(c){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+c.message),this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,mimeType:o})}}n&&this.hls.trigger(f.Events.BUFFER_CREATED,{tracks:this.tracks})},l._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},l._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},l._onSBUpdateError=function(e,t){b.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},l.removeExecutor=function(e,t,i){var n=this.media,s=this.mediaSource,r=this.operationQueue,a=this.sourceBuffer[e];if(!n||!s||!a)return b.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);var o=(0,F.isFiniteNumber)(n.duration)?n.duration:1/0,u=(0,F.isFiniteNumber)(s.duration)?s.duration:1/0,d=Math.max(0,t),c=Math.min(i,o,u);c>d?(b.logger.log("[buffer-controller]: Removing ["+d+","+c+"] from the "+e+" SourceBuffer"),a.remove(d,c)):r.shiftAndExecuteNext(e)},l.appendExecutor=function(e,t){var i=this.operationQueue,n=this.sourceBuffer[t];if(!n)return b.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)},l.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,s=t.map(function(r){return n.appendBlocker(r)});Promise.all(s).then(function(){e(),t.forEach(function(r){var a=i.sourceBuffer[r];a&&a.updating||n.shiftAndExecuteNext(r)})})},l.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},l.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var s=i.bind(this,e);this.listeners[e].push({event:t,listener:s}),n.addEventListener(t,s)}},l.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(i){t.removeEventListener(i.event,i.listener)})},h}(),oi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},li=function(h){var l=h;return oi.hasOwnProperty(h)&&(l=oi[h]),String.fromCharCode(l)},Gt=15,xt=100,tn={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nn={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},an={25:2,26:4,29:6,30:8,31:10,27:13,28:15},sn=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(We||(We={}));var on=function(){function h(){this.time=null,this.verboseLevel=We.ERROR}return h.prototype.log=function(l,e){this.verboseLevel>=l&&b.logger.log(this.time+" ["+l+"] "+e)},h}(),Kt=function(h){for(var l=[],e=0;e<h.length;e++)l.push(h[e].toString(16));return l},ui=function(){function h(e,t,i,n,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}var l=h.prototype;return l.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},l.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}},l.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},l.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},l.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},l.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),ln=function(){function h(e,t,i,n,s,r){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new ui(t,i,n,s,r)}var l=h.prototype;return l.reset=function(){this.uchar=" ",this.penState.reset()},l.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},l.setPenState=function(e){this.penState.copy(e)},l.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},l.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},l.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),un=function(){function h(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<xt;t++)this.chars.push(new ln);this.logger=e,this.pos=0,this.currPenState=new ui}var l=h.prototype;return l.equals=function(e){for(var t=!0,i=0;i<xt;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},l.copy=function(e){for(var t=0;t<xt;t++)this.chars[t].copy(e.chars[t])},l.isEmpty=function(){for(var e=!0,t=0;t<xt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},l.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(We.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>xt&&(this.logger.log(We.DEBUG,"Too large cursor position "+this.pos),this.pos=xt)},l.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},l.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},l.insertChar=function(e){e>=144&&this.backSpace();var t=li(e);this.pos>=xt?this.logger.log(We.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},l.clearFromPos=function(e){var t;for(t=e;t<xt;t++)this.chars[t].reset()},l.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},l.clearToEndOfRow=function(){this.clearFromPos(this.pos)},l.getTextString=function(){for(var e=[],t=!0,i=0;i<xt;i++){var n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")},l.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},h}(),Or=function(){function h(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Gt;t++)this.rows.push(new un(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var l=h.prototype;return l.reset=function(){for(var e=0;e<Gt;e++)this.rows[e].clear();this.currRow=14},l.equals=function(e){for(var t=!0,i=0;i<Gt;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},l.copy=function(e){for(var t=0;t<Gt;t++)this.rows[t].copy(e.rows[t])},l.isEmpty=function(){for(var e=!0,t=0;t<Gt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},l.backSpace=function(){this.rows[this.currRow].backSpace()},l.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},l.insertChar=function(e){this.rows[this.currRow].insertChar(e)},l.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},l.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},l.setCursor=function(e){this.logger.log(We.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},l.setPAC=function(e){this.logger.log(We.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<Gt;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var r=s.rows[n].cueStartTime,a=this.logger.time;if(r&&a!==null&&r<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(s.rows[n+o])}}this.currRow=t;var u=this.rows[this.currRow];if(e.indent!==null){var d=e.indent,c=Math.max(d-1,0);u.setCursor(e.indent),e.color=u.chars[c].penState.foreground}var v={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(v)},l.setBkgData=function(e){this.logger.log(We.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},l.setRollUpRows=function(e){this.nrRollUpRows=e},l.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(We.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(We.INFO,"Rolling up")}else this.logger.log(We.DEBUG,"roll_up but nrRollUpRows not set yet")},l.getDisplayText=function(e){e=e||!1;for(var t=[],i="",n=-1,s=0;s<Gt;s++){var r=this.rows[s].getTextString();r&&(n=s+1,e?t.push("Row "+n+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join(`
`)),i},l.getTextAndFormat=function(){return this.rows},h}(),hi=function(){function h(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Or(i),this.nonDisplayedMemory=new Or(i),this.lastOutputScreen=new Or(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var l=h.prototype;return l.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},l.getHandler=function(){return this.outputFilter},l.setHandler=function(e){this.outputFilter=e},l.setPAC=function(e){this.writeScreen.setPAC(e)},l.setBkgData=function(e){this.writeScreen.setBkgData(e)},l.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(We.INFO,"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},l.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(We.INFO,i+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(We.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},l.ccRCL=function(){this.logger.log(We.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},l.ccBS=function(){this.logger.log(We.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},l.ccAOF=function(){},l.ccAON=function(){},l.ccDER=function(){this.logger.log(We.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},l.ccRU=function(e){this.logger.log(We.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},l.ccFON=function(){this.logger.log(We.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},l.ccRDC=function(){this.logger.log(We.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},l.ccTR=function(){this.logger.log(We.INFO,"TR"),this.setMode("MODE_TEXT")},l.ccRTD=function(){this.logger.log(We.INFO,"RTD"),this.setMode("MODE_TEXT")},l.ccEDM=function(){this.logger.log(We.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},l.ccCR=function(){this.logger.log(We.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},l.ccENM=function(){this.logger.log(We.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},l.ccEOC=function(){if(this.logger.log(We.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(We.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},l.ccTO=function(e){this.logger.log(We.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},l.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(We.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},l.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},l.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},h}(),hn=function(){function h(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new on;this.channels=[null,new hi(e,t,n),new hi(e+1,i,n)],this.cmdHistory={a:null,b:null},this.logger=n}var l=h.prototype;return l.getHandler=function(e){return this.channels[e].getHandler()},l.setHandler=function(e,t){this.channels[e].setHandler(t)},l.addData=function(e,t){var i,n,s,r=!1;this.logger.time=e;for(var a=0;a<t.length;a+=2)if(n=127&t[a],s=127&t[a+1],n!==0||s!==0){if(this.logger.log(We.DATA,"["+Kt([t[a],t[a+1]])+"] -> ("+Kt([n,s])+")"),(i=this.parseCmd(n,s))||(i=this.parseMidrow(n,s)),i||(i=this.parsePAC(n,s)),i||(i=this.parseBackgroundAttributes(n,s)),!i&&(r=this.parseChars(n,s))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(r):this.logger.log(We.WARNING,"No channel found yet. TEXT-MODE?")}i||r||this.logger.log(We.WARNING,"Couldn't parse cleaned data "+Kt([n,s])+" orig: "+Kt([t[a],t[a+1]]))}},l.parseCmd=function(e,t){var i=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(di(e,t,i))return qt(null,null,i),this.logger.log(We.DEBUG,"Repeated command ("+Kt([e,t])+") is dropped"),!0;var n=e===20||e===21||e===23?1:2,s=this.channels[n];return e===20||e===21||e===28||e===29?t===32?s.ccRCL():t===33?s.ccBS():t===34?s.ccAOF():t===35?s.ccAON():t===36?s.ccDER():t===37?s.ccRU(2):t===38?s.ccRU(3):t===39?s.ccRU(4):t===40?s.ccFON():t===41?s.ccRDC():t===42?s.ccTR():t===43?s.ccRTD():t===44?s.ccEDM():t===45?s.ccCR():t===46?s.ccENM():t===47&&s.ccEOC():s.ccTO(t-32),qt(e,t,i),this.currentChannel=n,!0},l.parseMidrow=function(e,t){var i=0;if((e===17||e===25)&&t>=32&&t<=47){if((i=e===17?1:2)!==this.currentChannel)return this.logger.log(We.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[i];return!!n&&(n.ccMIDROW(t),this.logger.log(We.DEBUG,"MIDROW ("+Kt([e,t])+")"),!0)}return!1},l.parsePAC=function(e,t){var i,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(di(e,t,n))return qt(null,null,n),!0;var s=e<=23?1:2;i=t>=64&&t<=95?s===1?tn[e]:nn[e]:s===1?rn[e]:an[e];var r=this.channels[s];return!!r&&(r.setPAC(this.interpretPAC(i,t)),qt(e,t,n),this.currentChannel=s,!0)},l.interpretPAC=function(e,t){var i,n={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,n.underline=(1&i)==1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},l.parseChars=function(e,t){var i,n,s=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19?(n=r===17?t+80:r===18?t+112:t+144,this.logger.log(We.INFO,"Special char '"+li(n)+"' in channel "+i),s=[n]):e>=32&&e<=127&&(s=t===0?[e]:[e,t]),s){var a=Kt(s);this.logger.log(We.DEBUG,"Char codes =  "+a.join(",")),qt(e,t,this.cmdHistory)}return s},l.parseBackgroundAttributes=function(e,t){var i;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var n={};e===16||e===24?(i=Math.floor((t-32)/2),n.background=sn[i],t%2==1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));var s=e<=23?1:2;return this.channels[s].setBkgData(n),qt(e,t,this.cmdHistory),!0},l.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},l.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t];i&&i.cueSplitAtTime(e)}},h}();function qt(h,l,e){e.a=h,e.b=l}function di(h,l,e){return e.a===h&&e.b===l}const ci=hn;var fr=function(){function h(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var l=h.prototype;return l.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},l.newCue=function(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},l.reset=function(){this.cueRanges=[],this.startTime=null},h}();const xr=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var h=["","lr","rl"],l=["start","middle","end","left","right"];function e(s,r){if(typeof r!="string"||!Array.isArray(s))return!1;var a=r.toLowerCase();return!!~s.indexOf(a)&&a}function t(s){return e(l,s)}function i(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var c in d)s[c]=d[c]}return s}function n(s,r,a){var o=this,u={enumerable:!0};o.hasBeenReset=!1;var d="",c=!1,v=s,m=r,y=a,I=null,D="",W=!0,q="auto",K="start",X=50,re="middle",j=50,fe="middle";Object.defineProperty(o,"id",i({},u,{get:function(){return d},set:function(ue){d=""+ue}})),Object.defineProperty(o,"pauseOnExit",i({},u,{get:function(){return c},set:function(ue){c=!!ue}})),Object.defineProperty(o,"startTime",i({},u,{get:function(){return v},set:function(ue){if(typeof ue!="number")throw new TypeError("Start time must be set to a number.");v=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},u,{get:function(){return m},set:function(ue){if(typeof ue!="number")throw new TypeError("End time must be set to a number.");m=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},u,{get:function(){return y},set:function(ue){y=""+ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},u,{get:function(){return I},set:function(ue){I=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},u,{get:function(){return D},set:function(ue){var Ae=function(_e){return e(h,_e)}(ue);if(Ae===!1)throw new SyntaxError("An invalid or illegal string was specified.");D=Ae,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},u,{get:function(){return W},set:function(ue){W=!!ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},u,{get:function(){return q},set:function(ue){if(typeof ue!="number"&&ue!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");q=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},u,{get:function(){return K},set:function(ue){var Ae=t(ue);if(!Ae)throw new SyntaxError("An invalid or illegal string was specified.");K=Ae,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},u,{get:function(){return X},set:function(ue){if(ue<0||ue>100)throw new Error("Position must be between 0 and 100.");X=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},u,{get:function(){return re},set:function(ue){var Ae=t(ue);if(!Ae)throw new SyntaxError("An invalid or illegal string was specified.");re=Ae,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},u,{get:function(){return j},set:function(ue){if(ue<0||ue>100)throw new Error("Size must be between 0 and 100.");j=ue,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},u,{get:function(){return fe},set:function(ue){var Ae=t(ue);if(!Ae)throw new SyntaxError("An invalid or illegal string was specified.");fe=Ae,this.hasBeenReset=!0}})),o.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();var dn=function(){function h(){}return h.prototype.decode=function(l,e){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},h}();function fi(h){function l(t,i,n,s){return 3600*(0|t)+60*(0|i)+(0|n)+parseFloat(s||0)}var e=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?l(e[2],e[3],0,e[4]):l(e[1],e[2],e[3],e[4]):null}var cn=function(){function h(){this.values=Object.create(null)}var l=h.prototype;return l.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},l.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},l.has=function(e){return e in this.values},l.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},l.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},l.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},h}();function gi(h,l,e,t){var i=t?h.split(t):[h];for(var n in i)if(typeof i[n]=="string"){var s=i[n].split(e);s.length===2&&l(s[0],s[1])}}var Pr=new xr(0,0,""),gr=Pr.align==="middle"?"middle":"center";function fn(h,l,e){var t=h;function i(){var s=fi(h);if(s===null)throw new Error("Malformed timestamp: "+t);return h=h.replace(/^[^\sa-zA-Z-]+/,""),s}function n(){h=h.replace(/^\s+/,"")}if(n(),l.startTime=i(),n(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);h=h.slice(3),n(),l.endTime=i(),n(),function(s,r){var a=new cn;gi(s,function(d,c){var v;switch(d){case"region":for(var m=e.length-1;m>=0;m--)if(e[m].id===c){a.set(d,e[m].region);break}break;case"vertical":a.alt(d,c,["rl","lr"]);break;case"line":v=c.split(","),a.integer(d,v[0]),a.percent(d,v[0])&&a.set("snapToLines",!1),a.alt(d,v[0],["auto"]),v.length===2&&a.alt("lineAlign",v[1],["start",gr,"end"]);break;case"position":v=c.split(","),a.percent(d,v[0]),v.length===2&&a.alt("positionAlign",v[1],["start",gr,"end","line-left","line-right","auto"]);break;case"size":a.percent(d,c);break;case"align":a.alt(d,c,["start",gr,"end","left","right"])}},/:/,/\s/),r.region=a.get("region",null),r.vertical=a.get("vertical","");var o=a.get("line","auto");o==="auto"&&Pr.line===-1&&(o=-1),r.line=o,r.lineAlign=a.get("lineAlign","start"),r.snapToLines=a.get("snapToLines",!0),r.size=a.get("size",100),r.align=a.get("align",gr);var u=a.get("position","auto");u==="auto"&&Pr.position===50&&(u=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=u}(h,l)}function vi(h){return h.replace(/<br(?: \/)?>/gi,`
`)}var gn=function(){function h(){this.state="INITIAL",this.buffer="",this.decoder=new dn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var l=h.prototype;return l.parse=function(e){var t=this;function i(){var o=t.buffer,u=0;for(o=vi(o);u<o.length&&o[u]!=="\r"&&o[u]!==`
`;)++u;var d=o.slice(0,u);return o[u]==="\r"&&++u,o[u]===`
`&&++u,t.buffer=o.slice(u),d}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(n=i()).match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:n=i(),t.state){case"HEADER":/:/.test(n)?gi(n,function(o,u){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new xr(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{fn(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=n.indexOf("-->")!==-1;if(!n||a&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},l.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},h}(),pi=H(673),vn=H(524),pn=/\r\n|\n\r|\n|\r/g,Fr=function(h,l,e){return e===void 0&&(e=0),h.slice(e,e+l.length)===l},Mr=function(h){for(var l=5381,e=h.length;e;)l=33*l^h.charCodeAt(--e);return(l>>>0).toString()};function Nr(h,l,e){return Mr(h.toString())+Mr(l.toString())+Mr(e)}function Ur(){return Ur=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},Ur.apply(this,arguments)}var Br="stpp.ttml.im1t",mi=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,yi=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,mn={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ei(h,l,e,t,i){var n=(0,Q.findBox)(new Uint8Array(h),["mdat"]);if(n.length!==0){var s=n.map(function(a){return(0,Ke.utf8ArrayToStr)(a)}),r=(0,pi.toTimescaleFromScale)(l,1,e);try{s.forEach(function(a){return t(function(o,u){var d=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},v=Object.keys(c).reduce(function(W,q){return W[q]=d.getAttribute("ttp:"+q)||c[q],W},{}),m=d.getAttribute("xml:space")!=="preserve",y=Ti(Gr(d,"styling","style")),I=Ti(Gr(d,"layout","region")),D=Gr(d,"body","[begin]");return[].map.call(D,function(W){var q=Si(W,m);if(!q||!W.hasAttribute("begin"))return null;var K=Hr(W.getAttribute("begin"),v),X=Hr(W.getAttribute("dur"),v),re=Hr(W.getAttribute("end"),v);if(K===null)throw bi(W);if(re===null){if(X===null)throw bi(W);re=K+X}var j=new xr(K-u,re-u,q);j.id=Nr(j.startTime,j.endTime,j.text);var fe=I[W.getAttribute("region")],ue=y[W.getAttribute("style")];j.position=10,j.size=80;var Ae=function(Xe,Ne,Ge){var Qe="http://www.w3.org/ns/ttml#styling",at=null,vt=Xe!=null&&Xe.hasAttribute("style")?Xe.getAttribute("style"):null;return vt&&Ge.hasOwnProperty(vt)&&(at=Ge[vt]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(tt,st){var Dt=Kr(Ne,Qe,st)||Kr(Xe,Qe,st)||Kr(at,Qe,st);return Dt&&(tt[st]=Dt),tt},{})}(fe,ue,y),_e=Ae.textAlign;if(_e){var Be=mn[_e];Be&&(j.lineAlign=Be),j.align=_e}return Ur(j,Ae),j}).filter(function(W){return W!==null})}(a,r))})}catch(a){i(a)}}else i(new Error("Could not parse IMSC1 mdat"))}function Gr(h,l,e){var t=h.getElementsByTagName(l)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Ti(h){return h.reduce(function(l,e){var t=e.getAttribute("xml:id");return t&&(l[t]=e),l},{})}function Si(h,l){return[].slice.call(h.childNodes).reduce(function(e,t,i){var n;return t.nodeName==="br"&&i?e+`
`:(n=t.childNodes)!==null&&n!==void 0&&n.length?Si(t,l):l?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function Kr(h,l,e){return h&&h.hasAttributeNS(l,e)?h.getAttributeNS(l,e):null}function bi(h){return new Error("Could not parse ttml timestamp "+h)}function Hr(h,l){if(!h)return null;var e=fi(h);return e===null&&(mi.test(h)?e=function(t,i){var n=mi.exec(t),s=(0|n[4])+(0|n[5])/i.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+s/i.frameRate}(h,l):yi.test(h)&&(e=function(t,i){var n=yi.exec(t),s=Number(n[1]);switch(n[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/i.frameRate;case"t":return s/i.tickRate}return s}(h,l))),e}var yn=function(){function h(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new fr(this,"textTrack1"),i=new fr(this,"textTrack2"),n=new fr(this,"textTrack3"),s=new fr(this,"textTrack4");this.cea608Parser1=new ci(1,t,i),this.cea608Parser2=new ci(3,n,s)}e.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(f.Events.FRAG_LOADING,this.onFragLoading,this),e.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(f.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(f.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(f.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var l=h.prototype;return l.destroy=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(f.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(f.Events.FRAG_LOADING,this.onFragLoading,this),e.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(f.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(f.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(f.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(f.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(e,t,i,n,s){for(var r,a,o,u,d=!1,c=s.length;c--;){var v=s[c],m=(r=v[0],a=v[1],o=t,u=i,Math.min(a,u)-Math.max(r,o));if(m>=0&&(v[0]=Math.min(v[0],t),v[1]=Math.max(v[1],i),d=!0,m/(i-t)>.5))return}if(d||s.push([t,i]),this.config.renderTextTracksNatively){var y=this.captionsTracks[e];this.Cues.newCue(y,t,i,n)}else{var I=this.Cues.newCue(null,t,i,n);this.hls.trigger(f.Events.CUES_PARSED,{type:"captions",cues:I,track:e})}},l.onInitPtsFound=function(e,t){var i=this,n=t.frag,s=t.id,r=t.initPTS,a=t.timescale,o=this.unparsedVttFrags;s==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=a),o.length&&(this.unparsedVttFrags=[],o.forEach(function(u){i.onFragLoaded(f.Events.FRAG_LOADED,u)}))},l.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var n=t.textTracks[i];if(n[e])return n}return null},l.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},l.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,i=this.captionsTracks,n=this.media,s=t[e],r=s.label,a=s.languageCode,o=this.getExistingTrack(e);if(o)i[e]=o,De(i[e]),ke(i[e],n);else{var u=this.createTextTrack("captions",r,a);u&&(u[e]=!0,i[e]=u)}}},l.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(f.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},l.createTextTrack=function(e,t,i){var n=this.media;if(n)return n.addTextTrack(e,t,i)},l.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},l.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){De(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)De(t[i])}},l.onSubtitleTracksUpdated=function(e,t){var i=this;this.textTracks=[];var n=t.subtitleTracks||[],s=n.some(function(u){return u.textCodec===Br});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,d){var c;if(d<a.length){for(var v=null,m=0;m<a.length;m++)if(En(a[m],u)){v=a[m];break}v&&(c=v)}if(c)De(c);else{var y=i._captionsOrSubtitlesFromCharacteristics(u);(c=i.createTextTrack(y,u.name,u.lang))&&(c.mode="disabled")}c&&(c.groupId=u.groupId,i.textTracks.push(c))})}else if(!r&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(f.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}},l._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!==null&&t!==void 0&&t.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"},l.onManifestLoaded=function(e,t){var i=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(n){var s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(s){var r="textTrack"+s[1],a=i.captionsProperties[r];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)}})},l.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},l.onFragLoading=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2,s=this.lastSn,r=this.lastPartIndex;if(this.enabled&&i&&n&&t.frag.type===_.PlaylistLevelType.MAIN){var a,o,u=t.frag.sn,d=(a=t==null||(o=t.part)===null||o===void 0?void 0:o.index)!=null?a:-1;u===s+1||u===s&&d===r+1||(i.reset(),n.reset()),this.lastSn=u,this.lastPartIndex=d}},l.onFragLoaded=function(e,t){var i=t.frag,n=t.payload,s=this.initPTS,r=this.unparsedVttFrags;if(i.type===_.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,F.isFiniteNumber)(s[i.cc]))return r.push(t),void(s.length&&this.hls.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var a=i.decryptdata,o="stats"in t;if(a==null||a.key==null||a.method!=="AES-128"||o){var u=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===Br?this._parseIMSC1(i,n):this._parseVTTs(i,n,d)}}else this.hls.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},l._parseIMSC1=function(e,t){var i=this,n=this.hls;Ei(t,this.initPTS[e.cc],this.timescale[e.cc],function(s){i._appendCues(s,e.level),n.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){b.logger.log("Failed to parse IMSC1: "+s),n.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},l._parseVTTs=function(e,t,i){var n,s=this,r=this.hls;(function(a,o,u,d,c,v,m,y){var I,D=new gn,W=(0,Ke.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(pn,`
`).split(`
`),q=[],K=(0,pi.toMpegTsClockFromTimescale)(o,u),X="00:00.000",re=0,j=0,fe=!0;D.oncue=function(ue){var Ae=d[c],_e=d.ccOffset,Be=(re-K)/9e4;Ae!=null&&Ae.new&&(j!==void 0?_e=d.ccOffset=Ae.start:function(Qe,at,vt){var tt=Qe[at],st=Qe[tt.prevCC];if(!st||!st.new&&tt.new)return Qe.ccOffset=Qe.presentationOffset=tt.start,void(tt.new=!1);for(;(Dt=st)!==null&&Dt!==void 0&&Dt.new;){var Dt;Qe.ccOffset+=tt.start-st.start,tt.new=!1,st=Qe[(tt=st).prevCC]}Qe.presentationOffset=vt}(d,c,Be)),Be&&(_e=Be-d.presentationOffset);var Xe=ue.endTime-ue.startTime,Ne=(0,vn.normalizePts)(9e4*(ue.startTime+_e-j),9e4*v)/9e4;ue.startTime=Math.max(Ne,0),ue.endTime=Math.max(Ne+Xe,0);var Ge=ue.text.trim();ue.text=decodeURIComponent(encodeURIComponent(Ge)),ue.id||(ue.id=Nr(ue.startTime,ue.endTime,Ge)),ue.endTime>0&&q.push(ue)},D.onparsingerror=function(ue){I=ue},D.onflush=function(){I?y(I):m(q)},W.forEach(function(ue){if(fe){if(Fr(ue,"X-TIMESTAMP-MAP=")){fe=!1,ue.slice(16).split(",").forEach(function(Ae){Fr(Ae,"LOCAL:")?X=Ae.slice(6):Fr(Ae,"MPEGTS:")&&(re=parseInt(Ae.slice(7)))});try{j=function(Ae){var _e=parseInt(Ae.slice(-3)),Be=parseInt(Ae.slice(-6,-4)),Xe=parseInt(Ae.slice(-9,-7)),Ne=Ae.length>9?parseInt(Ae.substring(0,Ae.indexOf(":"))):0;if(!((0,F.isFiniteNumber)(_e)&&(0,F.isFiniteNumber)(Be)&&(0,F.isFiniteNumber)(Xe)&&(0,F.isFiniteNumber)(Ne)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+Ae);return _e+=1e3*Be,(_e+=6e4*Xe)+36e5*Ne}(X)/1e3}catch(Ae){I=Ae}return}ue===""&&(fe=!1)}D.parse(ue+`
`)}),D.flush()})((n=e.initSegment)!==null&&n!==void 0&&n.data?(0,Q.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],this.timescale[e.cc],i,e.cc,e.start,function(a){s._appendCues(a,e.level),r.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){s._fallbackToIMSC1(e,t),b.logger.log("Failed to parse VTT cue: "+a),r.trigger(f.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},l._fallbackToIMSC1=function(e,t){var i=this,n=this.tracks[e.level];n.textCodec||Ei(t,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=Br,i._parseIMSC1(e,t)},function(){n.textCodec="wvtt"})},l._appendCues=function(e,t){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(function(a){return J(n,a)})}else{var s=this.tracks[t];if(!s)return;var r=s.default?"default":"subtitles"+t;i.trigger(f.Events.CUES_PARSED,{type:"subtitles",cues:e,track:r})}},l.onFragDecrypted=function(e,t){var i=t.frag;if(i.type===_.PlaylistLevelType.SUBTITLE){if(!(0,F.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(f.Events.FRAG_LOADED,t)}},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(e,t){var i=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&i&&n){var s=t.frag,r=t.samples;if(s.type!==_.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(s)!=="NONE")for(var a=0;a<r.length;a++){var o=r[a].bytes;if(o){var u=this.extractCea608Data(o);i.addData(r[a].pts,u[0]),n.addData(r[a].pts,u[1])}}}},l.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,s=t.endOffsetSubtitles,r=t.type,a=this.media;if(a&&!(a.currentTime<n)){if(!r||r==="video"){var o=this.captionsTracks;Object.keys(o).forEach(function(d){return Re(o[d],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&s!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return Re(u[d],i,s)})}}},l.extractCea608Data=function(e){for(var t=[[],[]],i=31&e[0],n=2,s=0;s<i;s++){var r=e[n++],a=127&e[n++],o=127&e[n++];if((a!==0||o!==0)&&4&r){var u=3&r;u!==0&&u!==1||(t[u].push(a),t[u].push(o))}}return t},h}();function En(h,l){return h&&h.label===l.name&&!(h.textTrack1||h.textTrack2)}function Tn(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}const Sn=function(){function h(i){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var l,e,t=h.prototype;return t.setStreamController=function(i){this.streamController=i},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var i=this.hls;i.on(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var i=this.hls;i.off(f.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(f.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(i,n){h.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},t.onMediaAttaching=function(i,n){this.media=n.media instanceof HTMLVideoElement?n.media:null},t.onManifestParsed=function(i,n){var s=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,s.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onBufferCodecs=function(i,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(i.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},t.getMaxLevel=function(i){var n=this,s=this.hls.levels;if(!s.length)return-1;var r=s.filter(function(a,o){return h.isLevelAllowed(o,n.restrictedLevels)&&o<=i});return this.clientRect=null,h.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,n={width:0,height:0};if(i){var s=i.getBoundingClientRect();n.width=s.width,n.height=s.height,n.width||n.height||(n.width=s.right-s.left||i.width||0,n.height=s.bottom-s.top||i.height||0)}return this.clientRect=n,n},h.isLevelAllowed=function(i,n){return n===void 0&&(n=[]),n.indexOf(i)===-1},h.getMaxLevelByMediaSize=function(i,n,s){if(!i||!i.length)return-1;for(var r,a,o=i.length-1,u=0;u<i.length;u+=1){var d=i[u];if((d.width>=n||d.height>=s)&&(r=d,!(a=i[u+1])||r.width!==a.width||r.height!==a.height)){o=u;break}}return o},l=h,(e=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch{}return i}}])&&Tn(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}(),bn=function(){function h(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var l=h.prototype;return l.setStreamController=function(e){this.streamController=e},l.registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},l.unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHING,this.onMediaAttaching)},l.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},l.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},l.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var s=n-this.lastTime,r=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,o=1e3*r/s,u=this.hls;if(u.trigger(f.Events.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:i}),o>0&&r>u.config.fpsDroppedMonitoringThreshold*a){var d=u.currentLevel;b.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d-=1,u.trigger(f.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},l.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},h}();var zt;(function(h){h.WIDEVINE="com.widevine.alpha",h.PLAYREADY="com.microsoft.playready"})(zt||(zt={}));var Ln=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Dn(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}const An=function(){function h(i){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=i,this._config=i.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var l,e,t=h.prototype;return t.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},t._registerListeners=function(){this.hls.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(f.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t._unregisterListeners=function(){this.hls.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(f.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t.getLicenseServerUrl=function(i){switch(i){case zt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},t._attemptKeySystemAccess=function(i,n,s){var r=this,a=function(u,d,c,v){if(u===zt.WIDEVINE)return function(m,y,I){var D={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(W){D.audioCapabilities.push({contentType:'audio/mp4; codecs="'+W+'"',robustness:I.audioRobustness||""})}),y.forEach(function(W){D.videoCapabilities.push({contentType:'video/mp4; codecs="'+W+'"',robustness:I.videoRobustness||""})}),[D]}(d,c,v);throw new Error("Unknown key-system: "+u)}(i,n,s,this._drmSystemOptions);b.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(i,a);this.mediaKeysPromise=o.then(function(u){return r._onMediaKeySystemAccessObtained(i,u)}),o.catch(function(u){b.logger.error('Failed to obtain key-system "'+i+'" access:',u)})},t._onMediaKeySystemAccessObtained=function(i,n){var s=this;b.logger.log('Access for key-system "'+i+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:n,mediaKeySystemDomain:i};this._mediaKeysList.push(r);var a=Promise.resolve().then(function(){return n.createMediaKeys()}).then(function(o){return r.mediaKeys=o,b.logger.log('Media-keys created for key-system "'+i+'"'),s._onMediaKeysCreated(),o});return a.catch(function(o){b.logger.error("Failed to create media-keys:",o)}),a},t._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(n){n.mediaKeysSession||(n.mediaKeysSession=n.mediaKeys.createSession(),i._onNewMediaKeySession(n.mediaKeysSession))})},t._onNewMediaKeySession=function(i){var n=this;b.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(s){n._onKeySessionMessage(i,s.message)},!1)},t._onKeySessionMessage=function(i,n){b.logger.log("Got EME message event, creating license request"),this._requestLicense(n,function(s){b.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),i.update(s).catch(function(r){b.logger.warn("Updating key-session failed: "+r)})})},t.onMediaEncrypted=function(i){var n=this;if(b.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise)return b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var s=function(r){n._media&&(n._attemptSetMediaKeys(r),n._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(s).catch(s)},t._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var n=this._mediaKeysList[0];if(!n||!n.mediaKeys)return b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});b.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(n.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(i,n){var s=this,r=this._mediaKeysList[0];if(!r)return b.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)b.logger.warn("Key-Session already initialized but requested again");else{var a=r.mediaKeysSession;if(!a)return b.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!n)return b.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});b.logger.log('Generating key-session request for "'+i+'" init data type'),r.mediaKeysSessionInitialized=!0,a.generateRequest(i,n).then(function(){b.logger.debug("Key-session generation succeeded")}).catch(function(o){b.logger.error("Error generating key-session request:",o),s.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t._createLicenseXhr=function(i,n,s){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,i,n,s);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,r,i),a=void 0}catch(o){b.logger.error(o)}try{r.readyState||r.open("POST",i,!0),a&&a.call(this.hls,r,i)}catch(o){throw new Error("issue setting up KeySystem license XHR "+o)}return r},t._onLicenseRequestReadyStageChange=function(i,n,s,r){if(i.readyState===4)if(i.status===200){this._requestLicenseFailureCount=0,b.logger.log("License request succeeded");var a=i.response,o=this._licenseResponseCallback;if(o)try{a=o.call(this.hls,i,n)}catch(d){b.logger.error(d)}r(a)}else{if(b.logger.error("License Request XHR failed ("+n+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var u=3-this._requestLicenseFailureCount+1;b.logger.warn("Retrying license request, "+u+" attempts left"),this._requestLicense(s,r)}},t._generateLicenseRequestChallenge=function(i,n){if(i.mediaKeySystemDomain===zt.WIDEVINE)return n;throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},t._requestLicense=function(i,n){b.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s)return b.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(s.mediaKeySystemDomain),a=this._createLicenseXhr(r,i,n);b.logger.log("Sending license request to URL: "+r);var o=this._generateLicenseRequestChallenge(s,i);a.send(o)}catch(u){b.logger.error("Failure requesting DRM license: "+u),this.hls.trigger(f.Events.ERROR,{type:C.ErrorTypes.KEY_SYSTEM_ERROR,details:C.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(i,n){if(this._emeEnabled){var s=n.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){var i=this._media,n=this._mediaKeysList;i&&(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(n.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},t.onManifestParsed=function(i,n){if(this._emeEnabled){var s=n.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),r=n.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(zt.WIDEVINE,s,r)}},l=h,(e=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Dn(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),h}();var yt,jr,Li;function Di(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function Ai(h,l,e){return l&&Di(h.prototype,l),e&&Di(h,e),Object.defineProperty(h,"prototype",{writable:!1}),h}function ki(h,l){var e=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(e)return(e=e.call(h)).next.bind(e);if(Array.isArray(h)||(e=function(i,n){if(i){if(typeof i=="string")return Ri(i,n);var s=Object.prototype.toString.call(i).slice(8,-1);return s==="Object"&&i.constructor&&(s=i.constructor.name),s==="Map"||s==="Set"?Array.from(i):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Ri(i,n):void 0}}(h))||l&&h&&typeof h.length=="number"){e&&(h=e);var t=0;return function(){return t>=h.length?{done:!0}:{done:!1,value:h[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ri(h,l){(l==null||l>h.length)&&(l=h.length);for(var e=0,t=new Array(l);e<l;e++)t[e]=h[e];return t}function vr(){return vr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},vr.apply(this,arguments)}(function(h){h.MANIFEST="m",h.AUDIO="a",h.VIDEO="v",h.MUXED="av",h.INIT="i",h.CAPTION="c",h.TIMED_TEXT="tt",h.KEY="k",h.OTHER="o"})(yt||(yt={})),function(h){h.DASH="d",h.HLS="h",h.SMOOTH="s",h.OTHER="o"}(jr||(jr={})),function(h){h.VOD="v",h.LIVE="l"}(Li||(Li={}));var kn=function(){function h(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(s){try{t.apply(s,{ot:yt.MANIFEST,su:!t.initialized})}catch(r){b.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=function(s){try{var r=s.frag,a=t.hls.levels[r.level],o=t.getObjectType(r),u={d:1e3*r.duration,ot:o};o!==yt.VIDEO&&o!==yt.AUDIO&&o!=yt.MUXED||(u.br=a.bitrate/1e3,u.tb=t.getTopBandwidth(o)/1e3,u.bl=t.getBufferLength(o)),t.apply(s,u)}catch(d){b.logger.warn("Could not generate segment CMCD data.",d)}},this.hls=e;var i=this.config=e.config,n=i.cmcd;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||h.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var l=h.prototype;return l.registerListeners=function(){var e=this.hls;e.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this)},l.unregisterListeners=function(){var e=this.hls;e.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},l.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},l.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},l.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},l.onBufferCreated=function(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)===null||n===void 0?void 0:n.buffer},l.createData=function(){var e;return{v:1,sf:jr.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},l.apply=function(e,t){t===void 0&&(t={}),vr(t,this.createData());var i=t.ot===yt.INIT||t.ot===yt.VIDEO||t.ot===yt.MUXED;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var n=h.toHeaders(t);if(!Object.keys(n).length)return;e.headers||(e.headers={}),vr(e.headers,n)}else{var s=h.toQuery(t);if(!s)return;e.url=h.appendQueryToUri(e.url,s)}},l.getObjectType=function(e){var t=e.type;return t==="subtitle"?yt.TIMED_TEXT:e.sn==="initSegment"?yt.INIT:t==="audio"?yt.AUDIO:t==="main"?this.hls.audioTracks.length?yt.VIDEO:yt.MUXED:void 0},l.getTopBandwidth=function(e){var t,i=0,n=this.hls;if(e===yt.AUDIO)t=n.audioTracks;else{var s=n.maxAutoLevel,r=s>-1?s+1:n.levels.length;t=n.levels.slice(0,r)}for(var a,o=ki(t);!(a=o()).done;){var u=a.value;u.bitrate>i&&(i=u.bitrate)}return i>0?i:NaN},l.getBufferLength=function(e){var t=this.hls.media,i=e===yt.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*z.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN},l.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,o){t(r),this.loader.load(r,a,o)},Ai(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},l.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,i=e||this.config.loader;return function(){function n(r){this.loader=void 0,this.loader=new i(r)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(r,a,o){t(r),this.loader.load(r,a,o)},Ai(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},h.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},h.serialize=function(e){for(var t,i=[],n=function(y){return!Number.isNaN(y)&&y!=null&&y!==""&&y!==!1},s=function(y){return Math.round(y)},r=function(y){return 100*s(y/100)},a={br:s,d:s,bl:r,dl:r,mtp:r,nor:function(y){return encodeURIComponent(y)},rtp:r,tb:s},o=ki(Object.keys(e||{}).sort());!(t=o()).done;){var u=t.value,d=e[u];if(n(d)&&!(u==="v"&&d===1||u=="pr"&&d===1)){var c=a[u];c&&(d=c(d));var v,m=typeof d;v=u==="ot"||u==="sf"||u==="st"?u+"="+d:m==="boolean"?u:m==="number"?u+"="+d:u+"="+JSON.stringify(d),i.push(v)}}return i.join(",")},h.toHeaders=function(e){for(var t={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];n[s[o]!=null?s[o]:1][o]=e[o]}for(var u=0;u<n.length;u++){var d=h.serialize(n[u]);d&&(t["CMCD-"+i[u]]=d)}return t},h.toQuery=function(e){return"CMCD="+encodeURIComponent(h.serialize(e))},h.appendQueryToUri=function(e,t){if(!t)return e;var i=e.includes("?")?"&":"?";return""+e+i+t},h}(),Ii=H(408),Rn=/^age:\s*[\d.]+\s*$/m;const _i=function(){function h(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new Ii.LoadStats,this.retryDelay=0}var l=h.prototype;return l.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},l.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},l.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},l.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.retryDelay=t.retryDelay,this.loadInternal()},l.loadInternal=function(){var e=this.config,t=this.context;if(e){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var s=this.xhrSetup;try{if(s)try{s(i,t.url)}catch{i.open("GET",t.url,!0),s(i,t.url)}i.readyState||i.open("GET",t.url,!0);var r=this.context.headers;if(r)for(var a in r)i.setRequestHeader(a,r[a])}catch(o){return void this.callbacks.onError({code:i.status,text:o.message},t,i)}t.rangeEnd&&i.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),i.send()}},l.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,s=this.config;if(!i.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),n===4){t.onreadystatechange=null,t.onprogress=null;var r=t.status,a=t.responseType==="arraybuffer";if(r>=200&&r<300&&(a&&t.response||t.responseText!==null)){var o,u;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),u=a?(o=t.response).byteLength:(o=t.responseText).length,i.loaded=i.total=u,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(i,e,o,t),!this.callbacks)return;var c={url:t.responseURL,data:o};this.callbacks.onSuccess(c,i,e,t)}else i.retry>=s.maxRetry||r>=400&&r<499?(b.logger.error(r+" while loading "+e.url),this.callbacks.onError({code:r,text:t.statusText},e,t)):(b.logger.warn(r+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},l.loadtimeout=function(){b.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},l.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},l.getCacheAge=function(){var e=null;if(this.loader&&Rn.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},h}();function Vr(h){var l=typeof Map=="function"?new Map:void 0;return Vr=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,i)}function i(){return Wr(e,arguments,Yr(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),er(i,e)},Vr(h)}function Wr(h,l,e){return Wr=In()?Reflect.construct.bind():function(t,i,n){var s=[null];s.push.apply(s,i);var r=new(Function.bind.apply(t,s));return n&&er(r,n.prototype),r},Wr.apply(null,arguments)}function In(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function er(h,l){return er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},er(h,l)}function Yr(h){return Yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},Yr(h)}function qr(){return qr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},qr.apply(this,arguments)}var _n=function(){function h(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Cn,this.controller=new self.AbortController,this.stats=new Ii.LoadStats}var l=h.prototype;return l.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},l.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},l.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},l.load=function(e,t,i){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var r=function(d,c){var v={method:"GET",mode:"cors",credentials:"same-origin",signal:c,headers:new self.Headers(qr({},d.headers))};return d.rangeEnd&&v.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),v}(e,this.controller.signal),a=i.onProgress,o=e.responseType==="arraybuffer",u=o?"byteLength":"length";this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),i.onTimeout(s,e,n.response)},t.timeout),self.fetch(this.request).then(function(d){if(n.response=n.loader=d,!d.ok){var c=d.status,v=d.statusText;throw new wn(v||"fetch, bad network response",c,d)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(d.headers.get("Content-Length")||"0"),a&&(0,F.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(d,s,e,t.highWaterMark,a):o?d.arrayBuffer():d.text()}).then(function(d){var c=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var v=d[u];v&&(s.loaded=s.total=v);var m={url:c.url,data:d};a&&!(0,F.isFiniteNumber)(t.highWaterMark)&&a(s,e,d,c),i.onSuccess(m,s,e,c)}).catch(function(d){if(self.clearTimeout(n.requestTimeout),!s.aborted){var c=d&&d.code||0,v=d?d.message:null;i.onError({code:c,text:v},e,d?d.details:null)}})},l.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},l.loadProgressively=function(e,t,i,n,s){n===void 0&&(n=0);var r=new ni,a=e.body.getReader();return function o(){return a.read().then(function(u){if(u.done)return r.dataLength&&s(t,i,r.flush(),e),Promise.resolve(new ArrayBuffer(0));var d=u.value,c=d.length;return t.loaded+=c,c<n||r.dataLength?(r.push(d),r.dataLength>=n&&s(t,i,r.flush(),e)):s(t,i,d,e),o()}).catch(function(){return Promise.reject()})}()},h}();function Cn(h,l){return new self.Request(h.url,l)}var wn=function(h){var l,e;function t(i,n,s){var r;return(r=h.call(this,i)||this).code=void 0,r.details=void 0,r.code=n,r.details=s,r}return e=h,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,er(l,e),t}(Vr(Error));const Ci=_n;var On=/\s/;function zr(){return zr=Object.assign?Object.assign.bind():function(h){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(h[t]=e[t])}return h},zr.apply(this,arguments)}function wi(h,l){var e=Object.keys(h);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(h);l&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(h,i).enumerable})),e.push.apply(e,t)}return e}function Oi(h){for(var l=1;l<arguments.length;l++){var e=arguments[l]!=null?arguments[l]:{};l%2?wi(Object(e),!0).forEach(function(t){xn(h,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(e)):wi(Object(e)).forEach(function(t){Object.defineProperty(h,t,Object.getOwnPropertyDescriptor(e,t))})}return h}function xn(h,l,e){return l in h?Object.defineProperty(h,l,{value:e,enumerable:!0,configurable:!0,writable:!0}):h[l]=e,h}var Pn=Oi(Oi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_i,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ji,bufferController:en,capLevelController:Sn,fpsController:bn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ln,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(h,l,e,t){for(var i,n,s,r,a,o=[],u=self.VTTCue||self.TextTrackCue,d=0;d<t.rows.length;d++)if(s=!0,r=0,a="",!(i=t.rows[d]).isEmpty()){for(var c=0;c<i.chars.length;c++)On.test(i.chars[c].uchar)&&s?r++:(a+=i.chars[c].uchar,s=!1);i.cueStartTime=l,l===e&&(e+=1e-4),r>=16?r--:r++;var v=vi(a.trim()),m=Nr(l,e,v);h&&h.cues&&h.cues.getCueById(m)||((n=new u(l,e,v)).id=m,n.line=d+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*r/32)),o.push(n))}return h&&o.length&&(o.sort(function(y,I){return y.line==="auto"||I.line==="auto"?0:y.line>8&&I.line>8?I.line-y.line:y.line-I.line}),o.forEach(function(y){return J(h,y)})),o}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Xi,subtitleTrackController:Ji,timelineController:yn,audioStreamController:Wi,audioTrackController:qi,emeController:An,cmcdController:kn});function xi(h,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}var Pi=function(){function h(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ri.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var s=this.config=function(j,fe){if((fe.liveSyncDurationCount||fe.liveMaxLatencyDurationCount)&&(fe.liveSyncDuration||fe.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(fe.liveMaxLatencyDurationCount!==void 0&&(fe.liveSyncDurationCount===void 0||fe.liveMaxLatencyDurationCount<=fe.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(fe.liveMaxLatencyDuration!==void 0&&(fe.liveSyncDuration===void 0||fe.liveMaxLatencyDuration<=fe.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return zr({},j,fe)}(h.DefaultConfig,n);this.userConfig=n,(0,b.enableLogs)(s.debug,"Hls instance"),this._autoLevelCapping=-1,s.progressive&&function(j){var fe=j.loader;fe!==Ci&&fe!==_i?(b.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),j.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(j.loader=Ci,j.progressive=!0,j.enableSoftwareAES=!0,b.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(s);var r=s.abrController,a=s.bufferController,o=s.capLevelController,u=s.fpsController,d=this.abrController=new r(this),c=this.bufferController=new a(this),v=this.capLevelController=new o(this),m=new u(this),y=new pe(this),I=new Te(this),D=new Ye(this),W=this.levelController=new E(this),q=new R(this),K=this.streamController=new Gi(this,q);v.setStreamController(K),m.setStreamController(K);var X=[y,I,W,K];this.networkControllers=X;var re=[d,c,v,m,D,q];this.audioTrackController=this.createController(s.audioTrackController,null,X),this.createController(s.audioStreamController,q,X),this.subtitleTrackController=this.createController(s.subtitleTrackController,null,X),this.createController(s.subtitleStreamController,q,X),this.createController(s.timelineController,null,re),this.emeController=this.createController(s.emeController,null,re),this.cmcdController=this.createController(s.cmcdController,null,re),this.latencyController=this.createController(Je,null,re),this.coreComponents=re}h.isSupported=function(){return function(){var n=Lr();if(!n)return!1;var s=Jr(),r=n&&typeof n.isTypeSupported=="function"&&n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function";return!!r&&!!a}()};var l,e,t,i=h.prototype;return i.createController=function(n,s,r){if(n){var a=s?new n(this,s):new n(this);return r&&r.push(a),a}return null},i.on=function(n,s,r){r===void 0&&(r=this),this._emitter.on(n,s,r)},i.once=function(n,s,r){r===void 0&&(r=this),this._emitter.once(n,s,r)},i.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},i.off=function(n,s,r,a){r===void 0&&(r=this),this._emitter.off(n,s,r,a)},i.listeners=function(n){return this._emitter.listeners(n)},i.emit=function(n,s,r){return this._emitter.emit(n,s,r)},i.trigger=function(n,s){if(this.config.debug)return this.emit(n,n,s);try{return this.emit(n,n,s)}catch(r){b.logger.error("An internal error happened while handling event "+n+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(f.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:r})}return!1},i.listenerCount=function(n){return this._emitter.listenerCount(n)},i.destroy=function(){b.logger.log("destroy"),this.trigger(f.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},i.attachMedia=function(n){b.logger.log("attachMedia"),this._media=n,this.trigger(f.Events.MEDIA_ATTACHING,{media:n})},i.detachMedia=function(){b.logger.log("detachMedia"),this.trigger(f.Events.MEDIA_DETACHING,void 0),this._media=null},i.loadSource=function(n){this.stopLoad();var s=this.media,r=this.url,a=this.url=$.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});b.logger.log("loadSource:"+a),s&&r&&r!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(f.Events.MANIFEST_LOADING,{url:n})},i.startLoad=function(n){n===void 0&&(n=-1),b.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(s){s.startLoad(n)})},i.stopLoad=function(){b.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},i.swapAudioCodec=function(){b.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){b.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},i.removeLevel=function(n,s){s===void 0&&(s=0),this.levelController.removeLevel(n,s)},l=h,t=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return f.Events}},{key:"ErrorTypes",get:function(){return C.ErrorTypes}},{key:"ErrorDetails",get:function(){return C.ErrorDetails}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:Pn},set:function(n){h.defaultConfig=n}}],(e=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){b.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){b.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){b.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){b.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){b.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var s=!!n;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(b.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,s=this.config.minAutoBitrate;if(!n)return 0;for(var r=n.length,a=0;a<r;a++)if(n[a].maxBitrate>=s)return a;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,s=this.autoLevelCapping;return s===-1&&n&&n.length?n.length-1:s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var s=this.audioTrackController;s&&(s.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&xi(l.prototype,e),t&&xi(l,t),Object.defineProperty(l,"prototype",{writable:!1}),h}();Pi.defaultConfig=void 0},923:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{BaseSegment:()=>oe,ElementaryStreamTypes:()=>he,Fragment:()=>le,Part:()=>ie});var he,$=H(965),F=H(945),f=H(93),C=H(960),b=H(408);function Q(te,Z){te.prototype=Object.create(Z.prototype),te.prototype.constructor=te,B(te,Z)}function B(te,Z){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(ve,ce){return ve.__proto__=ce,ve},B(te,Z)}function U(te,Z){for(var ve=0;ve<Z.length;ve++){var ce=Z[ve];ce.enumerable=ce.enumerable||!1,ce.configurable=!0,"value"in ce&&(ce.writable=!0),Object.defineProperty(te,ce.key,ce)}}function ee(te,Z,ve){return Z&&U(te.prototype,Z),ve&&U(te,ve),Object.defineProperty(te,"prototype",{writable:!1}),te}(function(te){te.AUDIO="audio",te.VIDEO="video",te.AUDIOVIDEO="audiovideo"})(he||(he={}));var oe=function(){function te(Z){var ve;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((ve={})[he.AUDIO]=null,ve[he.VIDEO]=null,ve[he.AUDIOVIDEO]=null,ve),this.baseurl=Z}return te.prototype.setByteRange=function(Z,ve){var ce=Z.split("@",2),me=[];ce.length===1?me[0]=ve?ve.byteRangeEndOffset:0:me[0]=parseInt(ce[1]),me[1]=parseInt(ce[0])+me[0],this._byteRange=me},ee(te,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,F.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(Z){this._url=Z}}]),te}(),le=function(te){function Z(ce,me){var P;return(P=te.call(this,me)||this)._decryptdata=null,P.rawProgramDateTime=null,P.programDateTime=null,P.tagList=[],P.duration=0,P.sn=0,P.levelkey=void 0,P.type=void 0,P.loader=null,P.level=-1,P.cc=0,P.startPTS=void 0,P.endPTS=void 0,P.appendedPTS=void 0,P.startDTS=void 0,P.endDTS=void 0,P.start=0,P.deltaPTS=void 0,P.maxStartPTS=void 0,P.minEndPTS=void 0,P.stats=new b.LoadStats,P.urlId=0,P.data=void 0,P.bitrateTest=!1,P.title=null,P.initSegment=null,P.type=ce,P}Q(Z,te);var ve=Z.prototype;return ve.createInitializationVector=function(ce){for(var me=new Uint8Array(16),P=12;P<16;P++)me[P]=ce>>8*(15-P)&255;return me},ve.setDecryptDataFromLevelKey=function(ce,me){var P=ce;return(ce==null?void 0:ce.method)==="AES-128"&&ce.uri&&!ce.iv&&((P=C.LevelKey.fromURI(ce.uri)).method=ce.method,P.iv=this.createInitializationVector(me),P.keyFormat="identity"),P},ve.setElementaryStreamInfo=function(ce,me,P,p,A,S){S===void 0&&(S=!1);var G=this.elementaryStreams,ne=G[ce];ne?(ne.startPTS=Math.min(ne.startPTS,me),ne.endPTS=Math.max(ne.endPTS,P),ne.startDTS=Math.min(ne.startDTS,p),ne.endDTS=Math.max(ne.endDTS,A)):G[ce]={startPTS:me,endPTS:P,startDTS:p,endDTS:A,partial:S}},ve.clearElementaryStreamInfo=function(){var ce=this.elementaryStreams;ce[he.AUDIO]=null,ce[he.VIDEO]=null,ce[he.AUDIOVIDEO]=null},ee(Z,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var ce=this.sn;typeof ce!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&f.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),ce=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,ce)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,$.isFiniteNumber)(this.programDateTime))return null;var ce=(0,$.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*ce}},{key:"encrypted",get:function(){var ce;return!((ce=this.decryptdata)===null||ce===void 0||!ce.keyFormat||!this.decryptdata.uri)}}]),Z}(oe),ie=function(te){function Z(ve,ce,me,P,p){var A;(A=te.call(this,me)||this).fragOffset=0,A.duration=0,A.gap=!1,A.independent=!1,A.relurl=void 0,A.fragment=void 0,A.index=void 0,A.stats=new b.LoadStats,A.duration=ve.decimalFloatingPoint("DURATION"),A.gap=ve.bool("GAP"),A.independent=ve.bool("INDEPENDENT"),A.relurl=ve.enumeratedString("URI"),A.fragment=ce,A.index=P;var S=ve.enumeratedString("BYTERANGE");return S&&A.setByteRange(S,p),p&&(A.fragOffset=p.fragOffset+p.duration),A}return Q(Z,te),ee(Z,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var ve=this.elementaryStreams;return!!(ve.audio||ve.video||ve.audiovideo)}}]),Z}(oe)},960:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{LevelKey:()=>F});var he=H(945);function $(f,C){for(var b=0;b<C.length;b++){var Q=C[b];Q.enumerable=Q.enumerable||!1,Q.configurable=!0,"value"in Q&&(Q.writable=!0),Object.defineProperty(f,Q.key,Q)}}var F=function(){function f(Q,B){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=B?(0,he.buildAbsoluteURL)(Q,B,{alwaysNormalize:!0}):Q}var C,b;return f.fromURL=function(Q,B){return new f(Q,B)},f.fromURI=function(Q){return new f(Q)},C=f,(b=[{key:"uri",get:function(){return this._uri}}])&&$(C.prototype,b),Object.defineProperty(C,"prototype",{writable:!1}),f}()},408:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{LoadStats:()=>he});var he=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{MAX_SAFE_INTEGER:()=>$,isFiniteNumber:()=>he});var he=Number.isFinite||function(F){return typeof F=="number"&&isFinite(F)},$=Number.MAX_SAFE_INTEGER||9007199254740991},524:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{default:()=>te,flushTextTrackMetadataCueSamples:()=>ve,flushTextTrackUserdataCueSamples:()=>ce,normalizePts:()=>Z});var he=H(965);const $=function(){function p(){}return p.getSilentFrame=function(A,S){if(A==="mp4a.40.2"){if(S===1)return new Uint8Array([0,200,0,128,35,128]);if(S===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(S===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(S===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(S===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(S===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(S===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},p}();var F=Math.pow(2,32)-1,f=function(){function p(){}return p.init=function(){var A;for(A in p.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},p.types)p.types.hasOwnProperty(A)&&(p.types[A]=[A.charCodeAt(0),A.charCodeAt(1),A.charCodeAt(2),A.charCodeAt(3)]);var S=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),G=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);p.HDLR_TYPES={video:S,audio:G};var ne=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),se=new Uint8Array([0,0,0,0,0,0,0,0]);p.STTS=p.STSC=p.STCO=se,p.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),p.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),p.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),p.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var k=new Uint8Array([105,115,111,109]),N=new Uint8Array([97,118,99,49]),M=new Uint8Array([0,0,0,1]);p.FTYP=p.box(p.types.ftyp,k,M,k,N),p.DINF=p.box(p.types.dinf,p.box(p.types.dref,ne))},p.box=function(A){for(var S=8,G=arguments.length,ne=new Array(G>1?G-1:0),se=1;se<G;se++)ne[se-1]=arguments[se];for(var k=ne.length,N=k;k--;)S+=ne[k].byteLength;var M=new Uint8Array(S);for(M[0]=S>>24&255,M[1]=S>>16&255,M[2]=S>>8&255,M[3]=255&S,M.set(A,4),k=0,S=8;k<N;k++)M.set(ne[k],S),S+=ne[k].byteLength;return M},p.hdlr=function(A){return p.box(p.types.hdlr,p.HDLR_TYPES[A])},p.mdat=function(A){return p.box(p.types.mdat,A)},p.mdhd=function(A,S){S*=A;var G=Math.floor(S/(F+1)),ne=Math.floor(S%(F+1));return p.box(p.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,255&A,G>>24,G>>16&255,G>>8&255,255&G,ne>>24,ne>>16&255,ne>>8&255,255&ne,85,196,0,0]))},p.mdia=function(A){return p.box(p.types.mdia,p.mdhd(A.timescale,A.duration),p.hdlr(A.type),p.minf(A))},p.mfhd=function(A){return p.box(p.types.mfhd,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,255&A]))},p.minf=function(A){return A.type==="audio"?p.box(p.types.minf,p.box(p.types.smhd,p.SMHD),p.DINF,p.stbl(A)):p.box(p.types.minf,p.box(p.types.vmhd,p.VMHD),p.DINF,p.stbl(A))},p.moof=function(A,S,G){return p.box(p.types.moof,p.mfhd(A),p.traf(G,S))},p.moov=function(A){for(var S=A.length,G=[];S--;)G[S]=p.trak(A[S]);return p.box.apply(null,[p.types.moov,p.mvhd(A[0].timescale,A[0].duration)].concat(G).concat(p.mvex(A)))},p.mvex=function(A){for(var S=A.length,G=[];S--;)G[S]=p.trex(A[S]);return p.box.apply(null,[p.types.mvex].concat(G))},p.mvhd=function(A,S){S*=A;var G=Math.floor(S/(F+1)),ne=Math.floor(S%(F+1)),se=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,255&A,G>>24,G>>16&255,G>>8&255,255&G,ne>>24,ne>>16&255,ne>>8&255,255&ne,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return p.box(p.types.mvhd,se)},p.sdtp=function(A){var S,G,ne=A.samples||[],se=new Uint8Array(4+ne.length);for(S=0;S<ne.length;S++)G=ne[S].flags,se[S+4]=G.dependsOn<<4|G.isDependedOn<<2|G.hasRedundancy;return p.box(p.types.sdtp,se)},p.stbl=function(A){return p.box(p.types.stbl,p.stsd(A),p.box(p.types.stts,p.STTS),p.box(p.types.stsc,p.STSC),p.box(p.types.stsz,p.STSZ),p.box(p.types.stco,p.STCO))},p.avc1=function(A){var S,G,ne,se=[],k=[];for(S=0;S<A.sps.length;S++)ne=(G=A.sps[S]).byteLength,se.push(ne>>>8&255),se.push(255&ne),se=se.concat(Array.prototype.slice.call(G));for(S=0;S<A.pps.length;S++)ne=(G=A.pps[S]).byteLength,k.push(ne>>>8&255),k.push(255&ne),k=k.concat(Array.prototype.slice.call(G));var N=p.box(p.types.avcC,new Uint8Array([1,se[3],se[4],se[5],255,224|A.sps.length].concat(se).concat([A.pps.length]).concat(k))),M=A.width,V=A.height,_=A.pixelRatio[0],ge=A.pixelRatio[1];return p.box(p.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,M>>8&255,255&M,V>>8&255,255&V,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),N,p.box(p.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),p.box(p.types.pasp,new Uint8Array([_>>24,_>>16&255,_>>8&255,255&_,ge>>24,ge>>16&255,ge>>8&255,255&ge])))},p.esds=function(A){var S=A.config.length;return new Uint8Array([0,0,0,0,3,23+S,0,1,0,4,15+S,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([S]).concat(A.config).concat([6,1,2]))},p.mp4a=function(A){var S=A.samplerate;return p.box(p.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,S>>8&255,255&S,0,0]),p.box(p.types.esds,p.esds(A)))},p.mp3=function(A){var S=A.samplerate;return p.box(p.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,S>>8&255,255&S,0,0]))},p.stsd=function(A){return A.type==="audio"?A.segmentCodec==="mp3"&&A.codec==="mp3"?p.box(p.types.stsd,p.STSD,p.mp3(A)):p.box(p.types.stsd,p.STSD,p.mp4a(A)):p.box(p.types.stsd,p.STSD,p.avc1(A))},p.tkhd=function(A){var S=A.id,G=A.duration*A.timescale,ne=A.width,se=A.height,k=Math.floor(G/(F+1)),N=Math.floor(G%(F+1));return p.box(p.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,255&S,0,0,0,0,k>>24,k>>16&255,k>>8&255,255&k,N>>24,N>>16&255,N>>8&255,255&N,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ne>>8&255,255&ne,0,0,se>>8&255,255&se,0,0]))},p.traf=function(A,S){var G=p.sdtp(A),ne=A.id,se=Math.floor(S/(F+1)),k=Math.floor(S%(F+1));return p.box(p.types.traf,p.box(p.types.tfhd,new Uint8Array([0,0,0,0,ne>>24,ne>>16&255,ne>>8&255,255&ne])),p.box(p.types.tfdt,new Uint8Array([1,0,0,0,se>>24,se>>16&255,se>>8&255,255&se,k>>24,k>>16&255,k>>8&255,255&k])),p.trun(A,G.length+16+20+8+16+8+8),G)},p.trak=function(A){return A.duration=A.duration||4294967295,p.box(p.types.trak,p.tkhd(A),p.mdia(A))},p.trex=function(A){var S=A.id;return p.box(p.types.trex,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},p.trun=function(A,S){var G,ne,se,k,N,M,V=A.samples||[],_=V.length,ge=12+16*_,pe=new Uint8Array(ge);for(S+=8+ge,pe.set([A.type==="video"?1:0,0,15,1,_>>>24&255,_>>>16&255,_>>>8&255,255&_,S>>>24&255,S>>>16&255,S>>>8&255,255&S],0),G=0;G<_;G++)se=(ne=V[G]).duration,k=ne.size,N=ne.flags,M=ne.cts,pe.set([se>>>24&255,se>>>16&255,se>>>8&255,255&se,k>>>24&255,k>>>16&255,k>>>8&255,255&k,N.isLeading<<2|N.dependsOn,N.isDependedOn<<6|N.hasRedundancy<<4|N.paddingValue<<1|N.isNonSync,61440&N.degradPrio,15&N.degradPrio,M>>>24&255,M>>>16&255,M>>>8&255,255&M],12+16*G);return p.box(p.types.trun,pe)},p.initSegment=function(A){p.types||p.init();var S=p.moov(A),G=new Uint8Array(p.FTYP.byteLength+S.byteLength);return G.set(p.FTYP),G.set(S,p.FTYP.byteLength),G},p}();f.types=void 0,f.HDLR_TYPES=void 0,f.STTS=void 0,f.STSC=void 0,f.STCO=void 0,f.STSZ=void 0,f.VMHD=void 0,f.SMHD=void 0,f.STSD=void 0,f.FTYP=void 0,f.DINF=void 0;const C=f;var b=H(851),Q=H(973),B=H(93),U=H(308),ee=H(673);function oe(){return oe=Object.assign?Object.assign.bind():function(p){for(var A=1;A<arguments.length;A++){var S=arguments[A];for(var G in S)Object.prototype.hasOwnProperty.call(S,G)&&(p[G]=S[G])}return p},oe.apply(this,arguments)}var le=null,ie=null,te=function(){function p(S,G,ne,se){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=S,this.config=G,this.typeSupported=ne,this.ISGenerated=!1,le===null){var k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);le=k?parseInt(k[1]):0}if(ie===null){var N=navigator.userAgent.match(/Safari\/(\d+)/i);ie=N?parseInt(N[1]):0}}var A=p.prototype;return A.destroy=function(){},A.resetTimeStamp=function(S){B.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=S},A.resetNextTimestamp=function(){B.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},A.resetInitSegment=function(){B.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},A.getVideoStartPts=function(S){var G=!1,ne=S.reduce(function(se,k){var N=k.pts-se;return N<-4294967296?(G=!0,Z(se,k.pts)):N>0?se:k.pts},S[0].pts);return G&&B.logger.debug("PTS rollover detected"),ne},A.remux=function(S,G,ne,se,k,N,M,V){var _,ge,pe,Te,ke,J,De=k,Re=k,Ke=S.pid>-1,Ie=G.pid>-1,we=G.samples.length,Me=S.samples.length>0,Pe=M&&we>0||we>1;if((!Ke||Me)&&(!Ie||Pe)||this.ISGenerated||M){this.ISGenerated||(pe=this.generateIS(S,G,k));var Ye,Ve=this.isVideoContiguous,Fe=-1;if(Pe&&(Fe=function(Ze){for(var ht=0;ht<Ze.length;ht++)if(Ze[ht].key)return ht;return-1}(G.samples),!Ve&&this.config.forceKeyFrameOnDiscontinuity))if(J=!0,Fe>0){B.logger.warn("[mp4-remuxer]: Dropped "+Fe+" out of "+we+" video samples due to a missing keyframe");var Je=this.getVideoStartPts(G.samples);G.samples=G.samples.slice(Fe),G.dropped+=Fe,Ye=Re+=(G.samples[0].pts-Je)/G.inputTimeScale}else Fe===-1&&(B.logger.warn("[mp4-remuxer]: No keyframe found out of "+we+" video samples"),J=!1);if(this.ISGenerated){if(Me&&Pe){var $e=this.getVideoStartPts(G.samples),ot=(Z(S.samples[0].pts,$e)-$e)/G.inputTimeScale;De+=Math.max(0,ot),Re+=Math.max(0,-ot)}if(Me){if(S.samplerate||(B.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),pe=this.generateIS(S,G,k)),ge=this.remuxAudio(S,De,this.isAudioContiguous,N,Ie||Pe||V===U.PlaylistLevelType.AUDIO?Re:void 0),Pe){var rt=ge?ge.endPTS-ge.startPTS:0;G.inputTimeScale||(B.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),pe=this.generateIS(S,G,k)),_=this.remuxVideo(G,Re,Ve,rt)}}else Pe&&(_=this.remuxVideo(G,Re,Ve,0));_&&(_.firstKeyFrame=Fe,_.independent=Fe!==-1,_.firstKeyFramePTS=Ye)}}return this.ISGenerated&&(ne.samples.length&&(ke=ve(ne,k,this._initPTS,this._initDTS)),se.samples.length&&(Te=ce(se,k,this._initPTS))),{audio:ge,video:_,initSegment:pe,independent:J,text:Te,id3:ke}},A.generateIS=function(S,G,ne){var se,k,N,M=S.samples,V=G.samples,_=this.typeSupported,ge={},pe=!(0,he.isFiniteNumber)(this._initPTS),Te="audio/mp4";if(pe&&(se=k=1/0),S.config&&M.length&&(S.timescale=S.samplerate,S.segmentCodec==="mp3"&&(_.mpeg?(Te="audio/mpeg",S.codec=""):_.mp3&&(S.codec="mp3")),ge.audio={id:"audio",container:Te,codec:S.codec,initSegment:S.segmentCodec==="mp3"&&_.mpeg?new Uint8Array(0):C.initSegment([S]),metadata:{channelCount:S.channelCount}},pe&&(N=S.inputTimeScale,se=k=M[0].pts-Math.round(N*ne))),G.sps&&G.pps&&V.length&&(G.timescale=G.inputTimeScale,ge.video={id:"main",container:"video/mp4",codec:G.codec,initSegment:C.initSegment([G]),metadata:{width:G.width,height:G.height}},pe)){N=G.inputTimeScale;var ke=this.getVideoStartPts(V),J=Math.round(N*ne);k=Math.min(k,Z(V[0].dts,ke)-J),se=Math.min(se,ke-J)}if(Object.keys(ge).length)return this.ISGenerated=!0,pe&&(this._initPTS=se,this._initDTS=k),{tracks:ge,initPTS:se,timescale:N}},A.remuxVideo=function(S,G,ne,se){var k,N,M=S.inputTimeScale,V=S.samples,_=[],ge=V.length,pe=this._initPTS,Te=this.nextAvcDts,ke=8,J=this.videoSampleDuration,De=Number.POSITIVE_INFINITY,Re=Number.NEGATIVE_INFINITY,Ke=!1;ne&&Te!==null||(Te=G*M-(V[0].pts-Z(V[0].dts,V[0].pts)));for(var Ie=0;Ie<ge;Ie++){var we=V[Ie];we.pts=Z(we.pts-pe,Te),we.dts=Z(we.dts-pe,Te),we.dts<V[Ie>0?Ie-1:Ie].dts&&(Ke=!0)}Ke&&V.sort(function(Lt,pt){var Ut=Lt.dts-pt.dts,It=Lt.pts-pt.pts;return Ut||It}),k=V[0].dts;var Me=V[V.length-1].dts-k,Pe=Me?Math.round(Me/(ge-1)):J||S.inputTimeScale/30;if(ne){var Ye=k-Te,Ve=Ye>Pe,Fe=Ye<-1;if((Ve||Fe)&&(Ve?B.logger.warn("AVC: "+(0,ee.toMsFromMpegTsClock)(Ye,!0)+" ms ("+Ye+"dts) hole between fragments detected, filling it"):B.logger.warn("AVC: "+(0,ee.toMsFromMpegTsClock)(-Ye,!0)+" ms ("+Ye+"dts) overlapping between fragments detected"),!Fe||Te>V[0].pts)){k=Te;var Je=V[0].pts-Ye;V[0].dts=k,V[0].pts=Je,B.logger.log("Video: First PTS/DTS adjusted: "+(0,ee.toMsFromMpegTsClock)(Je,!0)+"/"+(0,ee.toMsFromMpegTsClock)(k,!0)+", delta: "+(0,ee.toMsFromMpegTsClock)(Ye,!0)+" ms")}}k=Math.max(0,k);for(var $e=0,ot=0,rt=0;rt<ge;rt++){for(var Ze=V[rt],ht=Ze.units,it=ht.length,lt=0,Et=0;Et<it;Et++)lt+=ht[Et].data.length;ot+=lt,$e+=it,Ze.length=lt,Ze.dts=Math.max(Ze.dts,k),De=Math.min(Ze.pts,De),Re=Math.max(Ze.pts,Re)}N=V[ge-1].dts;var ft,Tt=ot+4*$e+8;try{ft=new Uint8Array(Tt)}catch{return void this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:Q.ErrorTypes.MUX_ERROR,details:Q.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Tt,reason:"fail allocating video mdat "+Tt})}var St=new DataView(ft.buffer);St.setUint32(0,Tt),ft.set(C.types.mdat,4);for(var bt=!1,w=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,T=Number.NEGATIVE_INFINITY,E=0;E<ge;E++){for(var R=V[E],O=R.units,x=0,Y=0,ae=O.length;Y<ae;Y++){var z=O[Y],de=z.data,Se=z.data.byteLength;St.setUint32(ke,Se),ke+=4,ft.set(de,ke),ke+=Se,x+=4+Se}var ye=void 0;if(E<ge-1)J=V[E+1].dts-R.dts,ye=V[E+1].pts-R.pts;else{var be=this.config,Oe=E>0?R.dts-V[E-1].dts:Pe;if(ye=E>0?R.pts-V[E-1].pts:Pe,be.stretchShortVideoTrack&&this.nextAudioPts!==null){var He=Math.floor(be.maxBufferHole*M),Le=(se?De+se*M:this.nextAudioPts)-R.pts;Le>He?((J=Le-Oe)<0?J=Oe:bt=!0,B.logger.log("[mp4-remuxer]: It is approximately "+Le/90+" ms to the next segment; using duration "+J/90+" ms for the last video frame.")):J=Oe}else J=Oe}var ze=Math.round(R.pts-R.dts);w=Math.min(w,J),g=Math.max(g,J),L=Math.min(L,ye),T=Math.max(T,ye),_.push(new me(R.key,J,x,ze))}if(_.length){if(le){if(le<70){var dt=_[0].flags;dt.dependsOn=2,dt.isNonSync=0}}else if(ie&&T-L<g-w&&Pe/g<.025&&_[0].cts===0){B.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var nt=k,et=0,gt=_.length;et<gt;et++){var xe=nt+_[et].duration,ct=nt+_[et].cts;if(et<gt-1){var Ct=xe+_[et+1].cts;_[et].duration=Ct-ct}else _[et].duration=et?_[et-1].duration:Pe;_[et].cts=0,nt=xe}}}J=bt||!J?Pe:J,this.nextAvcDts=Te=N+J,this.videoSampleDuration=J,this.isVideoContiguous=!0;var ut={data1:C.moof(S.sequenceNumber++,k,oe({},S,{samples:_})),data2:ft,startPTS:De/M,endPTS:(Re+J)/M,startDTS:k/M,endDTS:Te/M,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:S.dropped};return S.samples=[],S.dropped=0,ut},A.remuxAudio=function(S,G,ne,se,k){var N=S.inputTimeScale,M=N/(S.samplerate?S.samplerate:N),V=S.segmentCodec==="aac"?1024:1152,_=V*M,ge=this._initPTS,pe=S.segmentCodec==="mp3"&&this.typeSupported.mpeg,Te=[],ke=k!==void 0,J=S.samples,De=pe?0:8,Re=this.nextAudioPts||-1,Ke=G*N;if(this.isAudioContiguous=ne=ne||J.length&&Re>0&&(se&&Math.abs(Ke-Re)<9e3||Math.abs(Z(J[0].pts-ge,Ke)-Re)<20*_),J.forEach(function(Y){Y.pts=Z(Y.pts-ge,Ke)}),!ne||Re<0){if(J=J.filter(function(Y){return Y.pts>=0}),!J.length)return;Re=k===0?0:se&&!ke?Math.max(0,Ke):J[0].pts}if(S.segmentCodec==="aac")for(var Ie=this.config.maxAudioFramesDrift,we=0,Me=Re;we<J.length;we++){var Pe=J[we],Ye=Pe.pts,Ve=Ye-Me,Fe=Math.abs(1e3*Ve/N);if(Ve<=-Ie*_&&ke)we===0&&(B.logger.warn("Audio frame @ "+(Ye/N).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Ve/N)+" ms."),this.nextAudioPts=Re=Me=Ye);else if(Ve>=Ie*_&&Fe<1e4&&ke){var Je=Math.round(Ve/_);(Me=Ye-Je*_)<0&&(Je--,Me+=_),we===0&&(this.nextAudioPts=Re=Me),B.logger.warn("[mp4-remuxer]: Injecting "+Je+" audio frame @ "+(Me/N).toFixed(3)+"s due to "+Math.round(1e3*Ve/N)+" ms gap.");for(var $e=0;$e<Je;$e++){var ot=Math.max(Me,0),rt=$.getSilentFrame(S.manifestCodec||S.codec,S.channelCount);rt||(B.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),rt=Pe.unit.subarray()),J.splice(we,0,{unit:rt,pts:ot}),Me+=_,we++}}Pe.pts=Me,Me+=_}for(var Ze,ht=null,it=null,lt=0,Et=J.length;Et--;)lt+=J[Et].unit.byteLength;for(var ft=0,Tt=J.length;ft<Tt;ft++){var St=J[ft],bt=St.unit,w=St.pts;if(it!==null)Te[ft-1].duration=Math.round((w-it)/M);else{if(ne&&S.segmentCodec==="aac"&&(w=Re),ht=w,!(lt>0))return;lt+=De;try{Ze=new Uint8Array(lt)}catch{return void this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:Q.ErrorTypes.MUX_ERROR,details:Q.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:lt,reason:"fail allocating audio mdat "+lt})}pe||(new DataView(Ze.buffer).setUint32(0,lt),Ze.set(C.types.mdat,4))}Ze.set(bt,De);var L=bt.byteLength;De+=L,Te.push(new me(!0,V,L,0)),it=w}var g=Te.length;if(g){var T=Te[Te.length-1];this.nextAudioPts=Re=it+M*T.duration;var E=pe?new Uint8Array(0):C.moof(S.sequenceNumber++,ht/M,oe({},S,{samples:Te}));S.samples=[];var R=ht/N,O=Re/N,x={data1:E,data2:Ze,startPTS:R,endPTS:O,startDTS:R,endDTS:O,type:"audio",hasAudio:!0,hasVideo:!1,nb:g};return this.isAudioContiguous=!0,x}},A.remuxEmptyAudio=function(S,G,ne,se){var k=S.inputTimeScale,N=k/(S.samplerate?S.samplerate:k),M=this.nextAudioPts,V=(M!==null?M:se.startDTS*k)+this._initDTS,_=se.endDTS*k+this._initDTS,ge=1024*N,pe=Math.ceil((_-V)/ge),Te=$.getSilentFrame(S.manifestCodec||S.codec,S.channelCount);if(B.logger.warn("[mp4-remuxer]: remux empty Audio"),Te){for(var ke=[],J=0;J<pe;J++){var De=V+J*ge;ke.push({unit:Te,pts:De,dts:De})}return S.samples=ke,this.remuxAudio(S,G,ne,!1)}B.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},p}();function Z(p,A){var S;if(A===null)return p;for(S=A<p?-8589934592:8589934592;Math.abs(p-A)>4294967296;)p+=S;return p}function ve(p,A,S,G){var ne=p.samples.length;if(ne){for(var se=p.inputTimeScale,k=0;k<ne;k++){var N=p.samples[k];N.pts=Z(N.pts-S,A*se)/se,N.dts=Z(N.dts-G,A*se)/se}var M=p.samples;return p.samples=[],{samples:M}}}function ce(p,A,S){var G=p.samples.length;if(G){for(var ne=p.inputTimeScale,se=0;se<G;se++){var k=p.samples[se];k.pts=Z(k.pts-S,A*ne)/ne}p.samples.sort(function(M,V){return M.pts-V.pts});var N=p.samples;return p.samples=[],{samples:N}}}var me=function(p,A,S,G){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=A,this.size=S,this.cts=G,this.flags=new P(p)},P=function(p){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=p?2:1,this.isNonSync=p?0:1}},856:(je,Ee,H)=>{var he;H.r(Ee),H.d(Ee,{MetadataSchema:()=>he}),function($){$.audioId3="org.id3",$.dateRange="com.apple.quicktime.HLS",$.emsg="https://aomedia.org/emsg/ID3"}(he||(he={}))},308:(je,Ee,H)=>{var he,$;H.r(Ee),H.d(Ee,{PlaylistContextType:()=>he,PlaylistLevelType:()=>$}),function(F){F.MANIFEST="manifest",F.LEVEL="level",F.AUDIO_TRACK="audioTrack",F.SUBTITLE_TRACK="subtitleTrack"}(he||(he={})),function(F){F.MAIN="main",F.AUDIO="audio",F.SUBTITLE="subtitle"}($||($={}))},93:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{enableLogs:()=>C,logger:()=>b});var he=function(){},$={trace:he,debug:he,log:he,warn:he,info:he,error:he},F=$;function f(Q){var B=self.console[Q];return B?B.bind(self.console,"["+Q+"] >"):he}function C(Q,B){if(self.console&&Q===!0||typeof Q=="object"){(function(U){for(var ee=arguments.length,oe=new Array(ee>1?ee-1:0),le=1;le<ee;le++)oe[le-1]=arguments[le];oe.forEach(function(ie){F[ie]=U[ie]?U[ie].bind(U):f(ie)})})(Q,"debug","log","info","warn","error");try{F.log('Debug logs enabled for "'+B+'"')}catch{F=$}}else F=$}var b=$},63:(je,Ee,H)=>{H.r(Ee),H.d(Ee,{RemuxerTrackIdConfig:()=>b,appendUint8Array:()=>p,bin2str:()=>Q,computeRawDurationFromSamples:()=>ce,discardEPB:()=>ne,findBox:()=>le,getDuration:()=>ve,getStartDTS:()=>Z,offsetStartDTS:()=>me,parseEmsg:()=>se,parseInitSegment:()=>te,parseSEIMessageFromNALu:()=>G,parseSamples:()=>A,parseSegmentIndex:()=>ie,readSint32:()=>ee,readUint16:()=>B,readUint32:()=>U,segmentValidRange:()=>P,writeUint32:()=>oe});var he=H(145),$=H(923),F=H(181),f=Math.pow(2,32)-1,C=[].push,b={video:1,audio:2,id3:3,text:4};function Q(k){return String.fromCharCode.apply(null,k)}function B(k,N){var M=k[N]<<8|k[N+1];return M<0?65536+M:M}function U(k,N){var M=ee(k,N);return M<0?4294967296+M:M}function ee(k,N){return k[N]<<24|k[N+1]<<16|k[N+2]<<8|k[N+3]}function oe(k,N,M){k[N]=M>>24,k[N+1]=M>>16&255,k[N+2]=M>>8&255,k[N+3]=255&M}function le(k,N){var M=[];if(!N.length)return M;for(var V=k.byteLength,_=0;_<V;){var ge=U(k,_),pe=ge>1?_+ge:V;if(Q(k.subarray(_+4,_+8))===N[0])if(N.length===1)M.push(k.subarray(_+8,pe));else{var Te=le(k.subarray(_+8,pe),N.slice(1));Te.length&&C.apply(M,Te)}_=pe}return M}function ie(k){var N=[],M=k[0],V=8,_=U(k,V);V+=4,V+=M===0?8:16,V+=2;var ge=k.length+0,pe=B(k,V);V+=2;for(var Te=0;Te<pe;Te++){var ke=V,J=U(k,ke);ke+=4;var De=2147483647&J;if((2147483648&J)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Re=U(k,ke);ke+=4,N.push({referenceSize:De,subsegmentDuration:Re,info:{duration:Re/_,start:ge,end:ge+De-1}}),ge+=De,V=ke+=4}return{earliestPresentationTime:0,timescale:_,version:M,referencesCount:pe,references:N}}function te(k){for(var N=[],M=le(k,["moov","trak"]),V=0;V<M.length;V++){var _=M[V],ge=le(_,["tkhd"])[0];if(ge){var pe=ge[0],Te=pe===0?12:20,ke=U(ge,Te),J=le(_,["mdia","mdhd"])[0];if(J){var De=U(J,Te=(pe=J[0])===0?12:20),Re=le(_,["mdia","hdlr"])[0];if(Re){var Ke=Q(Re.subarray(8,12)),Ie={soun:$.ElementaryStreamTypes.AUDIO,vide:$.ElementaryStreamTypes.VIDEO}[Ke];if(Ie){var we=le(_,["mdia","minf","stbl","stsd"])[0],Me=void 0;we&&(Me=Q(we.subarray(12,16))),N[ke]={timescale:De,type:Ie},N[Ie]={timescale:De,id:ke,codec:Me}}}}}}return le(k,["moov","mvex","trex"]).forEach(function(Pe){var Ye=U(Pe,4),Ve=N[Ye];Ve&&(Ve.default={duration:U(Pe,12),flags:U(Pe,20)})}),N}function Z(k,N){return le(N,["moof","traf"]).reduce(function(M,V){var _=le(V,["tfdt"])[0],ge=_[0],pe=le(V,["tfhd"]).reduce(function(Te,ke){var J=U(ke,4),De=k[J];if(De){var Re=U(_,4);ge===1&&(Re*=Math.pow(2,32),Re+=U(_,8));var Ke=Re/(De.timescale||9e4);if(isFinite(Ke)&&(Te===null||Ke<Te))return Ke}return Te},null);return pe!==null&&isFinite(pe)&&(M===null||pe<M)?pe:M},null)||0}function ve(k,N){for(var M=0,V=0,_=0,ge=le(k,["moof","traf"]),pe=0;pe<ge.length;pe++){var Te=ge[pe],ke=le(Te,["tfhd"])[0],J=N[U(ke,4)];if(J){var De=J.default,Re=U(ke,0)|(De==null?void 0:De.flags),Ke=De==null?void 0:De.duration;8&Re&&(Ke=U(ke,2&Re?12:8));for(var Ie=J.timescale||9e4,we=le(Te,["trun"]),Me=0;Me<we.length;Me++)!(M=ce(we[Me]))&&Ke&&(M=Ke*U(we[Me],4)),J.type===$.ElementaryStreamTypes.VIDEO?V+=M/Ie:J.type===$.ElementaryStreamTypes.AUDIO&&(_+=M/Ie)}}if(V===0&&_===0){for(var Pe=0,Ye=le(k,["sidx"]),Ve=0;Ve<Ye.length;Ve++){var Fe=ie(Ye[Ve]);Fe!=null&&Fe.references&&(Pe+=Fe.references.reduce(function(Je,$e){return Je+$e.info.duration||0},0))}return Pe}return V||_}function ce(k){var N=U(k,0),M=8;1&N&&(M+=4),4&N&&(M+=4);for(var V=0,_=U(k,4),ge=0;ge<_;ge++)256&N&&(V+=U(k,M),M+=4),512&N&&(M+=4),1024&N&&(M+=4),2048&N&&(M+=4);return V}function me(k,N,M){le(N,["moof","traf"]).forEach(function(V){le(V,["tfhd"]).forEach(function(_){var ge=U(_,4),pe=k[ge];if(pe){var Te=pe.timescale||9e4;le(V,["tfdt"]).forEach(function(ke){var J=ke[0],De=U(ke,4);if(J===0)De-=M*Te,oe(ke,4,De=Math.max(De,0));else{De*=Math.pow(2,32),De+=U(ke,8),De-=M*Te,De=Math.max(De,0);var Re=Math.floor(De/(f+1)),Ke=Math.floor(De%(f+1));oe(ke,4,Re),oe(ke,8,Ke)}})}})})}function P(k){var N={valid:null,remainder:null},M=le(k,["moof"]);if(!M)return N;if(M.length<2)return N.remainder=k,N;var V=M[M.length-1];return N.valid=(0,he.sliceUint8)(k,0,V.byteOffset-8),N.remainder=(0,he.sliceUint8)(k,V.byteOffset-8),N}function p(k,N){var M=new Uint8Array(k.length+N.length);return M.set(k),M.set(N,k.length),M}function A(k,N){var M=[],V=N.samples,_=N.timescale,ge=N.id,pe=!1;return le(V,["moof"]).map(function(Te){var ke=Te.byteOffset-8;le(Te,["traf"]).map(function(J){var De=le(J,["tfdt"]).map(function(Re){var Ke=Re[0],Ie=U(Re,4);return Ke===1&&(Ie*=Math.pow(2,32),Ie+=U(Re,8)),Ie/_})[0];return De!==void 0&&(k=De),le(J,["tfhd"]).map(function(Re){var Ke=U(Re,4),Ie=16777215&U(Re,0),we=0,Me=(16&Ie)!=0,Pe=0,Ye=(32&Ie)!=0,Ve=8;Ke===ge&&(1&Ie&&(Ve+=8),2&Ie&&(Ve+=4),8&Ie&&(we=U(Re,Ve),Ve+=4),Me&&(Pe=U(Re,Ve),Ve+=4),Ye&&(Ve+=4),N.type==="video"&&(pe=function(Fe){if(!Fe)return!1;var Je=Fe.indexOf("."),$e=Je<0?Fe:Fe.substring(0,Je);return $e==="hvc1"||$e==="hev1"||$e==="dvh1"||$e==="dvhe"}(N.codec)),le(J,["trun"]).map(function(Fe){var Je=Fe[0],$e=16777215&U(Fe,0),ot=(1&$e)!=0,rt=0,Ze=(4&$e)!=0,ht=(256&$e)!=0,it=0,lt=(512&$e)!=0,Et=0,ft=(1024&$e)!=0,Tt=(2048&$e)!=0,St=0,bt=U(Fe,4),w=8;ot&&(rt=U(Fe,w),w+=4),Ze&&(w+=4);for(var L=rt+ke,g=0;g<bt;g++){if(ht?(it=U(Fe,w),w+=4):it=we,lt?(Et=U(Fe,w),w+=4):Et=Pe,ft&&(w+=4),Tt&&(St=Je===0?U(Fe,w):ee(Fe,w),w+=4),N.type===$.ElementaryStreamTypes.VIDEO)for(var T=0;T<Et;){var E=U(V,L);S(pe,V[L+=4])&&G(V.subarray(L,L+E),pe?2:1,k+St/_,M),L+=E,T+=E+4}k+=it/_}}))})})}),M}function S(k,N){if(k){var M=N>>1&63;return M===39||M===40}return(31&N)==6}function G(k,N,M,V){var _=ne(k),ge=0;ge+=N;for(var pe=0,Te=0,ke=!1,J=0;ge<_.length;){pe=0;do{if(ge>=_.length)break;pe+=J=_[ge++]}while(J===255);Te=0;do{if(ge>=_.length)break;Te+=J=_[ge++]}while(J===255);var De=_.length-ge;if(!ke&&pe===4&&ge<_.length){if(ke=!0,_[ge++]===181){var Re=B(_,ge);if(ge+=2,Re===49){var Ke=U(_,ge);if(ge+=4,Ke===1195456820){var Ie=_[ge++];if(Ie===3){var we=_[ge++],Me=64&we,Pe=Me?2+3*(31&we):0,Ye=new Uint8Array(Pe);if(Me){Ye[0]=we;for(var Ve=1;Ve<Pe;Ve++)Ye[Ve]=_[ge++]}V.push({type:Ie,payloadType:pe,pts:M,bytes:Ye})}}}}}else if(pe===5&&Te<De){if(ke=!0,Te>16){for(var Fe=[],Je=0;Je<16;Je++){var $e=_[ge++].toString(16);Fe.push($e.length==1?"0"+$e:$e),Je!==3&&Je!==5&&Je!==7&&Je!==9||Fe.push("-")}for(var ot=Te-16,rt=new Uint8Array(ot),Ze=0;Ze<ot;Ze++)rt[Ze]=_[ge++];V.push({payloadType:pe,pts:M,uuid:Fe.join(""),userData:(0,F.utf8ArrayToStr)(rt),userDataBytes:rt})}}else if(Te<De)ge+=Te;else if(Te>De)break}}function ne(k){for(var N=k.byteLength,M=[],V=1;V<N-2;)k[V]===0&&k[V+1]===0&&k[V+2]===3?(M.push(V+2),V+=2):V++;if(M.length===0)return k;var _=N-M.length,ge=new Uint8Array(_),pe=0;for(V=0;V<_;pe++,V++)pe===M[0]&&(pe++,M.shift()),ge[V]=k[pe];return ge}function se(k){var N=k[0],M="",V="",_=0,ge=0,pe=0,Te=0,ke=0,J=0;if(N===0){for(;Q(k.subarray(J,J+1))!=="\0";)M+=Q(k.subarray(J,J+1)),J+=1;for(M+=Q(k.subarray(J,J+1)),J+=1;Q(k.subarray(J,J+1))!=="\0";)V+=Q(k.subarray(J,J+1)),J+=1;V+=Q(k.subarray(J,J+1)),J+=1,_=U(k,12),ge=U(k,16),Te=U(k,20),ke=U(k,24),J=28}else if(N===1){_=U(k,J+=4);var De=U(k,J+=4),Re=U(k,J+=4);for(J+=4,pe=Math.pow(2,32)*De+Re,Number.isSafeInteger(pe)||(pe=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Te=U(k,J),ke=U(k,J+=4),J+=4;Q(k.subarray(J,J+1))!=="\0";)M+=Q(k.subarray(J,J+1)),J+=1;for(M+=Q(k.subarray(J,J+1)),J+=1;Q(k.subarray(J,J+1))!=="\0";)V+=Q(k.subarray(J,J+1)),J+=1;V+=Q(k.subarray(J,J+1)),J+=1}return{schemeIdUri:M,value:V,timeScale:_,presentationTime:pe,presentationTimeDelta:ge,eventDuration:Te,id:ke,payload:k.subarray(J,k.byteLength)}}},673:(je,Ee,H)=>{function he(C,b,Q,B){Q===void 0&&(Q=1),B===void 0&&(B=!1);var U=C*b*Q;return B?Math.round(U):U}function $(C,b,Q,B){return Q===void 0&&(Q=1),B===void 0&&(B=!1),he(C,b,1/Q,B)}function F(C,b){return b===void 0&&(b=!1),he(C,1e3,11111111111111112e-21,b)}function f(C,b){return b===void 0&&(b=1),he(C,9e4,1/b)}H.r(Ee),H.d(Ee,{toMpegTsClockFromTimescale:()=>f,toMsFromMpegTsClock:()=>F,toTimescaleFromBase:()=>he,toTimescaleFromScale:()=>$})},145:(je,Ee,H)=>{function he($,F,f){return Uint8Array.prototype.slice?$.slice(F,f):new Uint8Array(Array.prototype.slice.call($,F,f))}H.r(Ee),H.d(Ee,{sliceUint8:()=>he})},729:je=>{var Ee=Object.prototype.hasOwnProperty,H="~";function he(){}function $(b,Q,B){this.fn=b,this.context=Q,this.once=B||!1}function F(b,Q,B,U,ee){if(typeof B!="function")throw new TypeError("The listener must be a function");var oe=new $(B,U||b,ee),le=H?H+Q:Q;return b._events[le]?b._events[le].fn?b._events[le]=[b._events[le],oe]:b._events[le].push(oe):(b._events[le]=oe,b._eventsCount++),b}function f(b,Q){--b._eventsCount==0?b._events=new he:delete b._events[Q]}function C(){this._events=new he,this._eventsCount=0}Object.create&&(he.prototype=Object.create(null),new he().__proto__||(H=!1)),C.prototype.eventNames=function(){var b,Q,B=[];if(this._eventsCount===0)return B;for(Q in b=this._events)Ee.call(b,Q)&&B.push(H?Q.slice(1):Q);return Object.getOwnPropertySymbols?B.concat(Object.getOwnPropertySymbols(b)):B},C.prototype.listeners=function(b){var Q=H?H+b:b,B=this._events[Q];if(!B)return[];if(B.fn)return[B.fn];for(var U=0,ee=B.length,oe=new Array(ee);U<ee;U++)oe[U]=B[U].fn;return oe},C.prototype.listenerCount=function(b){var Q=H?H+b:b,B=this._events[Q];return B?B.fn?1:B.length:0},C.prototype.emit=function(b,Q,B,U,ee,oe){var le=H?H+b:b;if(!this._events[le])return!1;var ie,te,Z=this._events[le],ve=arguments.length;if(Z.fn){switch(Z.once&&this.removeListener(b,Z.fn,void 0,!0),ve){case 1:return Z.fn.call(Z.context),!0;case 2:return Z.fn.call(Z.context,Q),!0;case 3:return Z.fn.call(Z.context,Q,B),!0;case 4:return Z.fn.call(Z.context,Q,B,U),!0;case 5:return Z.fn.call(Z.context,Q,B,U,ee),!0;case 6:return Z.fn.call(Z.context,Q,B,U,ee,oe),!0}for(te=1,ie=new Array(ve-1);te<ve;te++)ie[te-1]=arguments[te];Z.fn.apply(Z.context,ie)}else{var ce,me=Z.length;for(te=0;te<me;te++)switch(Z[te].once&&this.removeListener(b,Z[te].fn,void 0,!0),ve){case 1:Z[te].fn.call(Z[te].context);break;case 2:Z[te].fn.call(Z[te].context,Q);break;case 3:Z[te].fn.call(Z[te].context,Q,B);break;case 4:Z[te].fn.call(Z[te].context,Q,B,U);break;default:if(!ie)for(ce=1,ie=new Array(ve-1);ce<ve;ce++)ie[ce-1]=arguments[ce];Z[te].fn.apply(Z[te].context,ie)}}return!0},C.prototype.on=function(b,Q,B){return F(this,b,Q,B,!1)},C.prototype.once=function(b,Q,B){return F(this,b,Q,B,!0)},C.prototype.removeListener=function(b,Q,B,U){var ee=H?H+b:b;if(!this._events[ee])return this;if(!Q)return f(this,ee),this;var oe=this._events[ee];if(oe.fn)oe.fn!==Q||U&&!oe.once||B&&oe.context!==B||f(this,ee);else{for(var le=0,ie=[],te=oe.length;le<te;le++)(oe[le].fn!==Q||U&&!oe[le].once||B&&oe[le].context!==B)&&ie.push(oe[le]);ie.length?this._events[ee]=ie.length===1?ie[0]:ie:f(this,ee)}return this},C.prototype.removeAllListeners=function(b){var Q;return b?(Q=H?H+b:b,this._events[Q]&&f(this,Q)):(this._events=new he,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=H,C.EventEmitter=C,je.exports=C},945:function(je){var Ee,H,he,$,F;Ee=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,H=/^(?=([^\/?#]*))\1([^]*)$/,he=/(?:\/|^)\.(?=\/)/g,$=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,F={buildAbsoluteURL:function(f,C,b){if(b=b||{},f=f.trim(),!(C=C.trim())){if(!b.alwaysNormalize)return f;var Q=F.parseURL(f);if(!Q)throw new Error("Error trying to parse base URL.");return Q.path=F.normalizePath(Q.path),F.buildURLFromParts(Q)}var B=F.parseURL(C);if(!B)throw new Error("Error trying to parse relative URL.");if(B.scheme)return b.alwaysNormalize?(B.path=F.normalizePath(B.path),F.buildURLFromParts(B)):C;var U=F.parseURL(f);if(!U)throw new Error("Error trying to parse base URL.");if(!U.netLoc&&U.path&&U.path[0]!=="/"){var ee=H.exec(U.path);U.netLoc=ee[1],U.path=ee[2]}U.netLoc&&!U.path&&(U.path="/");var oe={scheme:U.scheme,netLoc:B.netLoc,path:null,params:B.params,query:B.query,fragment:B.fragment};if(!B.netLoc&&(oe.netLoc=U.netLoc,B.path[0]!=="/"))if(B.path){var le=U.path,ie=le.substring(0,le.lastIndexOf("/")+1)+B.path;oe.path=F.normalizePath(ie)}else oe.path=U.path,B.params||(oe.params=U.params,B.query||(oe.query=U.query));return oe.path===null&&(oe.path=b.alwaysNormalize?F.normalizePath(B.path):B.path),F.buildURLFromParts(oe)},parseURL:function(f){var C=Ee.exec(f);return C?{scheme:C[1]||"",netLoc:C[2]||"",path:C[3]||"",params:C[4]||"",query:C[5]||"",fragment:C[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(he,"");f.length!==(f=f.replace($,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}},je.exports=F}},_t={};function mt(je){var Ee=_t[je];if(Ee!==void 0)return Ee.exports;var H=_t[je]={exports:{}};return Nt[je].call(H.exports,H,H.exports,mt),H.exports}mt.m=Nt,mt.n=je=>{var Ee=je&&je.__esModule?()=>je.default:()=>je;return mt.d(Ee,{a:Ee}),Ee},mt.d=(je,Ee)=>{for(var H in Ee)mt.o(Ee,H)&&!mt.o(je,H)&&Object.defineProperty(je,H,{enumerable:!0,get:Ee[H]})},mt.o=(je,Ee)=>Object.prototype.hasOwnProperty.call(je,Ee),mt.r=je=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(je,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(je,"__esModule",{value:!0})};var $t=mt(817);return $t.default})())})(Un);const Bn=Fn(yr),Kn=Nn({__proto__:null,default:Bn},[yr]);export{Kn as h};
